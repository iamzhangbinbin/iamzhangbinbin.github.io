
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="张彬彬的个人技术博客">
      
      
        <meta name="author" content="张彬彬">
      
      
        <link rel="canonical" href="https://iamzhangbinbin.github.io/MM32%20Guide/MM32%20LIN/MM32%20LIN/">
      
      
        <link rel="prev" href="../../MM32%20Timer/MM32%20Timer/">
      
      
        <link rel="next" href="../../../Python%E7%AC%94%E8%AE%B0/">
      
      
      <link rel="icon" href="../../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>MM32 LIN - 张彬彬的杂货铺</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#mm32-lin" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="张彬彬的杂货铺" class="md-header__button md-logo" aria-label="张彬彬的杂货铺" data-md-component="logo">
      
  <img src="../../../img/zahuopu.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            张彬彬的杂货铺
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              MM32 LIN
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="indigo"  aria-label="切换至夜间模式"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="切换至夜间模式" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="切换至日间模式"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="切换至日间模式" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="分享" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/iamzhangbinbin/iamzhangbinbin.github.io" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    I'mZhangBinbin
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../MCU%E5%BC%80%E5%8F%91%E6%94%AF%E6%8C%81/" class="md-tabs__link">
          
  
  
    
  
  MCU开发支持

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
    
  
  MM32 Guide

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../Python%E7%AC%94%E8%AE%B0/" class="md-tabs__link">
          
  
  
    
  
  Python笔记

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E5%BC%80%E6%BA%90%E8%BD%AF%E4%BB%B6%E7%A7%BB%E6%A4%8D/" class="md-tabs__link">
          
  
  
    
  
  开源软件移植

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E6%A0%87%E5%87%86%E4%B8%8E%E8%AE%A4%E8%AF%81/" class="md-tabs__link">
          
  
  
    
  
  标准与认证

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../USB%E5%85%A5%E9%97%A8/" class="md-tabs__link">
          
  
  
    
  
  USB入门

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../CAN%E5%85%A5%E9%97%A8/" class="md-tabs__link">
          
  
  
    
  
  CAN入门

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../ENET%E5%85%A5%E9%97%A8/" class="md-tabs__link">
          
  
  
    
  
  ENET入门

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../blog/" class="md-tabs__link">
          
  
  
    
  
  博客

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../.." class="md-tabs__link">
          
  
  
    
  
  About

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="张彬彬的杂货铺" class="md-nav__button md-logo" aria-label="张彬彬的杂货铺" data-md-component="logo">
      
  <img src="../../../img/zahuopu.png" alt="logo">

    </a>
    张彬彬的杂货铺
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/iamzhangbinbin/iamzhangbinbin.github.io" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    I'mZhangBinbin
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../MCU%E5%BC%80%E5%8F%91%E6%94%AF%E6%8C%81/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    MCU开发支持
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    MM32 Guide
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            MM32 Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MM32%20Flash/MM32%20Flash/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MM32 Flash
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MM32%20ADC/MM32%20ADC/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MM32 ADC
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MM32%20MDPWM/MM32%20MDPWM/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MM32 MDPWM
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MM32%20FSMC/MM32%20FSMC/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MM32 FSMC
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MM32%20Timer/MM32%20Timer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MM32 Timer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    MM32 LIN
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    MM32 LIN
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lin" class="md-nav__link">
    <span class="md-ellipsis">
      LIN 是什么
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LIN 是什么">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lin-clusternode" class="md-nav__link">
    <span class="md-ellipsis">
      LIN 子网(Cluster)与节点(Node)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      主/从机节点与主/从机任务
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lin_1" class="md-nav__link">
    <span class="md-ellipsis">
      LIN 的特点
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lin_2" class="md-nav__link">
    <span class="md-ellipsis">
      LIN 协议层
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LIN 协议层">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      帧的结构
    </span>
  </a>
  
    <nav class="md-nav" aria-label="帧的结构">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#break-field" class="md-nav__link">
    <span class="md-ellipsis">
      同步间隔段(Break Field)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sync-byte-field" class="md-nav__link">
    <span class="md-ellipsis">
      同步段(Sync Byte Field)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#idprotected-identifier-field" class="md-nav__link">
    <span class="md-ellipsis">
      受保护ID段(Protected Identifier Field)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-field" class="md-nav__link">
    <span class="md-ellipsis">
      数据段(Data Field)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checksum-field" class="md-nav__link">
    <span class="md-ellipsis">
      校验和段(Checksum Field)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      帧传输时间的计算
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      帧在总线上的传输波形
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      帧的类型
    </span>
  </a>
  
    <nav class="md-nav" aria-label="帧的类型">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#unconditional-frame" class="md-nav__link">
    <span class="md-ellipsis">
      无条件帧(Unconditional Frame)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-triggered-frame" class="md-nav__link">
    <span class="md-ellipsis">
      事件触发帧(Event Triggered Frame)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sporadic-frame" class="md-nav__link">
    <span class="md-ellipsis">
      偶发帧(Sporadic Frame)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diagnostic-frame" class="md-nav__link">
    <span class="md-ellipsis">
      诊断帧(Diagnostic Frame)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reserved-frame" class="md-nav__link">
    <span class="md-ellipsis">
      保留帧(Reserved Frame)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#schedule" class="md-nav__link">
    <span class="md-ellipsis">
      进度表(Schedule)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#state-machine" class="md-nav__link">
    <span class="md-ellipsis">
      状态机(State Machine)实现
    </span>
  </a>
  
    <nav class="md-nav" aria-label="状态机(State Machine)实现">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      主机任务的状态机
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      从机任务的状态机
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      网络管理
    </span>
  </a>
  
    <nav class="md-nav" aria-label="网络管理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      唤醒
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      休眠
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      状态管理
    </span>
  </a>
  
    <nav class="md-nav" aria-label="状态管理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      网络报告
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      节点内部报告
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      帧收发的硬件实现
    </span>
  </a>
  
    <nav class="md-nav" aria-label="帧收发的硬件实现">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      组成
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lin_3" class="md-nav__link">
    <span class="md-ellipsis">
      LIN 的硬件特点
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      协议控制器
    </span>
  </a>
  
    <nav class="md-nav" aria-label="协议控制器">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      实现方案
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      总线收发器
    </span>
  </a>
  
    <nav class="md-nav" aria-label="总线收发器">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      实现方案
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lin_4" class="md-nav__link">
    <span class="md-ellipsis">
      LIN 总线
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      时钟源
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#emi" class="md-nav__link">
    <span class="md-ellipsis">
      EMI 及其控制
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      设计电路时的注意事项
    </span>
  </a>
  
    <nav class="md-nav" aria-label="设计电路时的注意事项">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      工作环境对时钟的影响
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      端接阻抗和总线负载
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#esd" class="md-nav__link">
    <span class="md-ellipsis">
      ESD 防护
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      兼容性
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../Python%E7%AC%94%E8%AE%B0/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Python笔记
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../%E5%BC%80%E6%BA%90%E8%BD%AF%E4%BB%B6%E7%A7%BB%E6%A4%8D/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    开源软件移植
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../%E6%A0%87%E5%87%86%E4%B8%8E%E8%AE%A4%E8%AF%81/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    标准与认证
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../USB%E5%85%A5%E9%97%A8/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    USB入门
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../CAN%E5%85%A5%E9%97%A8/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    CAN入门
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../ENET%E5%85%A5%E9%97%A8/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    ENET入门
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../blog/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    博客
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../.." class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    About
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="mm32-lin">MM32 LIN 介绍<a class="headerlink" href="#mm32-lin" title="Permanent link">&para;</a></h1>
<h2 id="lin">LIN 是什么<a class="headerlink" href="#lin" title="Permanent link">&para;</a></h2>
<p>LIN 是 Local Interconnect Network 的缩写，是基于 UART/SCI(Universal Asynchronous Receiver-Transmitter / Serial Communication Interface，通用异步收发器/串行通信接口)的低成本串行通信协议。可用于汽车、家电、办公设备等多种领域。</p>
<p>1996 年， Volvo 和 Volcano 通讯(VCT)为 Volvo S80 系列开发了一种基于 UART/SCI 的协议，即 Volcano Lite。1997 年， Motorola 与 Volvo 和 VCT 合作，帮助它们改进 Volcano Lite 协议以满足各种不同需求(比如无需晶振的从机设备自动同步)，并制定可以支持各种半导体产品的开放标准。 1998 年 12 月， Audi、 BMW、 Daimler Chrysler 和 Volkswagen 也加入进来，由此形成了 LIN 协会(http://www.lin-subbus.org)。开发 LIN 标准的目的在于适应分层次车内网络在低端(速度和可靠性要求不高、低成本的场合)的需求。 </p>
<p>LIN 经历了几个版本的发布和更新，如表 1.1 所示。</p>
<p><img alt="alt text" src="../image.png" /></p>
<p>图 1.1 为 LIN 在汽车中的应用，主要用于车身系统。</p>
<p><img alt="alt text" src="../image-1.png" /></p>
<h3 id="lin-clusternode">LIN 子网(Cluster)与节点(Node)<a class="headerlink" href="#lin-clusternode" title="Permanent link">&para;</a></h3>
<p><img alt="alt text" src="../image-2.png" /></p>
<p>图 1.2 为一典型的车载 LIN 通信子网(注 1)，黄色方块为 LIN 的从机节点，蓝色方块为 LIN 的主机节点，一个节点即一个 LIN 接口(注 2)。 LIN 网络与主干线 CAN(Controller Area Network，控制器局域网)总线相连时，需要加入 CAN-LIN 网关，一般由主机节点来充当。 LIN 与上层网络相连时的示意图参照图 1.3。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol>
<li>由于 LIN 网络在汽车中一般不独立存在，经常与上层网络(如 CAN)相连，因此子网的概念是相对于上层网络而言。在不强调与上层网络相连的情况下，后面也称作 LIN 网络。  </li>
<li>一个节点不一定对应一个 ECU(Electronic Control Unit，电子控制单元)，因为一个 ECU 可能提供多个 LIN 接口，并且这些接口可能连接到不同的 LIN 通信子网中。</li>
</ol>
</div>
<p><img alt="alt text" src="../image-3.png" /></p>
<p>节点可以抽象为如图 1.4 所示。</p>
<p><img alt="alt text" src="../image-4.png" /></p>
<p>节点应用层向下层传输信号和消息。信号和消息位于帧中的数据段，是节点向其他节点传达的实质信息。它们之间的区别在于信号封装于信号携带帧 (帧 ID 范围在 0x00～0x3B 之间，参照 3.1.3 节表 3.1)中，用于在运行状态传递上层发生的事件，如温度传感器的测量结果等。消息封装于诊断帧(帧 ID 为 0x3C 或 0x3D， 参照 3.1.3 节表 3.1)中，是有固定格式、最大长度不超过 4095 字节的信息，例如后面介绍的服务请求。应用程序通过信号处理实现信号的传递，通过传输层实现消息的传递。</p>
<h3 id="_1">主/从机节点与主/从机任务<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h3>
<p>LIN 的拓扑结构为单线总线，应用了单一主机多从机的概念。总线电平为 12V，传输位速率(Bitrate)最高为 20kbps。由于物理层限制，一个 LIN 网络最多可以连接 16 个节点，典型应用一般都在 12 个节点以下，主机节点有且只有一个，从机节点有 1 到 15 个。</p>
<p>主机节点(Master Node)包含主机任务(Master Task)和从机任务(Slave Task)，从机节点(Slave Node)只包含从机任务，如图 1.5 所示。</p>
<p><img alt="alt text" src="../image-5.png" /></p>
<p>主机任务负责：</p>
<ul>
<li>调度总线上帧的传输次序；</li>
<li>监测数据，处理错误；</li>
<li>作为标准时钟参考；</li>
<li>接收从机节点发出的总线唤醒命令。</li>
</ul>
<p>从机任务不能够主动发送数据，需要接收主机发送的帧头(帧的起始部分，参照 3.1 节的图 3.1)，根据帧头所包含的信息(这里指帧 ID，详细内容参照 3.1.3 节)判断：</p>
<ul>
<li>发送应答(帧中除帧头外剩下的部分，参照 3.1 节的图 3.1)；</li>
<li>接收应答；</li>
<li>既不接收也不发送应答。</li>
</ul>
<h2 id="lin_1">LIN 的特点<a class="headerlink" href="#lin_1" title="Permanent link">&para;</a></h2>
<p>LIN 具有以下特点：</p>
<ul>
<li>网络由一个主机节点和多个从机节点构成。</li>
<li>使用 LIN 可以大幅度的削减成本，表现在以下方面：<ul>
<li>开放型规范：规范可以免费从官方网站获得。</li>
<li>硬件成本削减：基于普通 UART/SCI 接口的低成本硬件实现，无需单独的硬件模块支持；从机节点无需高精度时钟就可以完成自同步；总线为一根单线电缆。</li>
<li>装配成本削减： LIN 采用了工作流(Work Flow)和现成节点(Off-the-shelf Node)的概念，将网络装配标准化，并可通过 LIN 传输层进行再配置。</li>
<li>缩短软件开发周期： LIN 协议将 API(Application Programming Interface，应用编程接口)标准化。</li>
</ul>
</li>
<li>信号传输具有确定性，传播时间可以提前计算出，参照 3.1.6 节。</li>
<li>LIN 具有可预测的 EMC(ElectroMagnetic Compatibility，电磁兼容性)性能，参照 4.7 节。为了限制 EMI(ElectroMagnetic Interference，电磁干扰)强度， LIN 协议规定最大位速率为 20kbps。</li>
<li>LIN 提供信号处理、配置、识别和诊断四项功能，参照 5.2.1 节的图 5.2。</li>
</ul>
<h2 id="lin_2">LIN 协议层<a class="headerlink" href="#lin_2" title="Permanent link">&para;</a></h2>
<p>本章内容介绍了帧、进度表、主/从机的状态机实现、 LIN 网络的休眠(Sleep)/唤醒(Wakeup)和状态管理等，对应着 LIN 规范的以下部分：  </p>
<ul>
<li>LIN Protocol Specification</li>
</ul>
<h3 id="_2">帧的结构<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<p>帧(Frame)包含帧头(Header)和应答(Response)两部分。主机任务负责发送帧头；从机任务接收帧头并对帧头所包含信息进行解析，然后决定是发送应答，还是接收应答，还是不作任何反应。帧在总线上的传输如图 3.1 所示。</p>
<p><img alt="alt text" src="../image-6.png" /></p>
<p>帧头包括同步间隔段、同步段以及 PID(Protected Identifier，受保护ID)段，应答包括数据段和校验和段，如图 3.2 所示，其中值“0”为显性电平(Dominant)，值“1”为隐性电平(Recessive)，总线上实行“线-与”： 当总线上有大于等于一个节点发送显性电平时，总线呈显性电平；所有的节点都发送隐性电平或不发送信息(不发送任何信息时总线默认呈隐性电平)时，总线才呈现隐性电平，即显性电平起主导作用。图中帧间隔为帧之间的间隔；应答间隔为帧头和应答之间的间隔；字节间间隔包括同步段和受保护 ID 段之间的间隔、数据段各字节间之间的间隔以及数据段最后一个字节和校验和段之间的间隔。下面对帧头和应答的各部分进行详细说明。</p>
<p><img alt="alt text" src="../image-7.png" /></p>
<h4 id="break-field">同步间隔段(Break Field)<a class="headerlink" href="#break-field" title="Permanent link">&para;</a></h4>
<p>同步间隔段由同步间隔(Break)和同步间隔段间隔符(Break Delimiter)构成，如图3.3所示。同步间隔是至少(注1)持续 13 位(以主机节点的位速率为准)的显性电平，由于帧中的所有间隔或总线空闲时都应保持隐性电平，并且帧中的任何其它字段都不会发出大于 9 位的显性电平，因此同步间隔可以标志一个帧的开始。同步间隔段的间隔符是至少持续 1 位的隐性电平。</p>
<p><img alt="alt text" src="../image-8.png" /></p>
<p>从机任务接收帧头的同步间隔段时，以该从机任务所在节点的位速率为准，当检测总线上出现持续 11 位(注2)的显性电平时，认为是帧的开始。当从机节点使用精度较高的时钟时，识别阈值可以选择 9.5 位(注 3)。</p>
<p>协议没有规定同步间隔段的发送和检测方法。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol>
<li>发送显性电平的下限为 13 位，上限应保证帧的最大传输时间THeader_Maximum(参照 3.1.6 节)在规定范围之内。  </li>
<li>参照 4.6 节的表 4.3，当从机节点选择的时钟(精度不高的时钟)在容限范围内(±14%)时， (13 - 11.18) / 13 = 14%，即是说当处于最差情况下(时钟相差 14%)时，从机任务按照自身时钟测量的主机节点发送的 13 位显性电平不会低于 11.18 位，若识别阈值高于 11.18 位，那么当选用 14%的时钟时，就会出现主机发送同步间隔，而从机检测不到的情形。由于在除同步间隔段以外，帧中任何其余部分都不会发送超过 9 位的显性电平(可以参照本章后面几节的内容)， (10.26 - 9) / 9 = 14%，即是说判断阈值必须大于 10.26 位，否则可能把帧中其余部分误判作为同步间隔段。综上，识别阈值为 11 位显性电平。  </li>
<li>参照 4.6 节的表 4.3，当从机节点选择的时钟(精度较高的时钟)在容限范围内(±1. 5%)时，按照上面注 2 的计算，识别阈值应在 9.135 位(由(9.135 - 9) / 9 = 1.5%计算而来)到 12.805 位(由(13 – 12.805) / 13 = 1.5%计算而来)之间。 具体设定阈值会随着所选时钟的精度， 取值范围在 9.135 位到 12.805 位之间浮动。</li>
</ol>
</div>
<h4 id="sync-byte-field">同步段(Sync Byte Field)<a class="headerlink" href="#sync-byte-field" title="Permanent link">&para;</a></h4>
<p>在介绍同步段之前，首先介绍一下字节域(Byte Field)的概念，字节域包括 1 位起始位(Start Bit，显性) + 8 位数据位 + 1 位停止位(Stop Bit，隐性)，是一种标准 UART 数据传输格式，如图 3.4 所示。在 LIN 的一帧当中，除了上一节讲述的同步间隔段，后面的各段都是通过字节域的格式传输的。在 LIN 帧中，数据传输都是先发送 LSB(Least Significant Bit，最低有效位)，最后发送 MSB(Most Significant Bit，最高有效位)。</p>
<p><img alt="alt text" src="../image-9.png" /></p>
<p>LIN 同步以下降沿为判断标志，采用字节 0x55(转换为二进制为 01010101b)。同步段的字节域如图 3.5 所示。</p>
<p><img alt="alt text" src="../image-10.png" /></p>
<p>从机节点可以不采用精度高的时钟，而采用片上振荡器等精度和成本相对较低的时钟，由此带来的与主机节点时钟产生的偏差，需要通过同步段进行调整，调整的结果是使从机节点数据的位速率与主机节点一致。同步段用于同步的基准时钟为主机节点的时钟。从机节点通过接收主机节点发出的同步段，计算出主机节点位速率，根据计算结果对自身的位速率重新作调整。计算公式如下：</p>
<p><img alt="alt text" src="../image-11.png" /></p>
<p>通过计算，可以得到主机节点实际传输 1 位所用的时间，即位速率。</p>
<h4 id="idprotected-identifier-field">受保护ID段(Protected Identifier Field)<a class="headerlink" href="#idprotected-identifier-field" title="Permanent link">&para;</a></h4>
<p>受保护 ID 段的前 6 位叫作帧 ID(Frame ID)，加上两个奇偶校验位后称作受保护 ID。如图 3.6 所示。</p>
<p><img alt="alt text" src="../image-12.png" /></p>
<p>帧 ID 的范围在 0x00～0x3F 之间，共 64 个。帧 ID 标识了帧的类别和目的地。从机任务对于帧头作出的反应(接收/发送/忽略应答部分)都是依据帧 ID 判断的。如果帧 ID 传输错误，将会导致信号无法正确到达目的地，因此引入奇偶校验位。校验公式如下，其中“⊕”代表“异或”运算， “¬”代表“取非”运算。</p>
<p>P0 = ID0 ⊕ ID1 ⊕ ID2 ⊕ ID4  <br />
P1 = ¬(ID1 ⊕ ID3 ⊕ ID4 ⊕ ID5)</p>
<p>由公式可以看出， PID 不会出现全 0 或全 1 的情况，因此，如果从机节点收到了“0xFF”或“0x00”，可判断为传输错误。</p>
<p>依据帧 ID 不同将帧进行分类，如表 3.1 所示，对各种类型的详细说明参照 3.2 节。</p>
<p><img alt="alt text" src="../image-13.png" /></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol>
<li>从机应答帧是一个完整的帧，与帧结构中的“应答”(帧的一部分)不同，注意区别。</li>
</ol>
</div>
<h4 id="data-field">数据段(Data Field)<a class="headerlink" href="#data-field" title="Permanent link">&para;</a></h4>
<p>节点发送的数据位于数据段，包含 1 到 8 个字节(注 1)，先发送编号最低的字节 DATA1，编号依次增加，如图 3.7 所示。</p>
<p>数据段包含了两种数据类型，信号(Signal)和诊断消息(Diagnostic messages)。</p>
<p>信号(Signal)由信号携带帧传递，一个帧 ID 对应的数据段可能包含一个或多个信号。信号更新时要保证其完整性，不能只更新一部分。一个信号通常由一个固定的节点发出，此节点称为该信号的发布节点(Publisher)；其余的一个或多个节点接收，它们称为信号的收听节点(Subscriber)(注 2)。</p>
<p>诊断消息(Diagnostic message)由诊断帧传递，对消息内容的解析由数据自身和节点状态决定。</p>
<p><img alt="alt text" src="../image-14.png" /></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol>
<li>协议没有规定帧中的哪一部分显示数据长度码的信息，数据的内容和长度是由系统设计者根据帧 ID 事先约定好的。   </li>
<li>总线上的数据是以广播形式被发送到总线上的，任何节点均能接收，但并非所有信号对每个节点都有用。收听节点接收帧的应答是因为该节点的应用层会使用这些信号，而对于其余节点，由于用不到这些信号，所以没有必要作接收处理，将忽略帧的应答部分。发布和收听由哪个节点进行完全根据应用层的需要由软件或配置工具实现。一般情况下，对于一个帧中的应答，总线上只存在一个发布节点，否则就会出现错误。事件触发帧例外，可能存在零个、一个或多个发布节点，参照 3.2.2 节。</li>
</ol>
</div>
<h4 id="checksum-field">校验和段(Checksum Field)<a class="headerlink" href="#checksum-field" title="Permanent link">&para;</a></h4>
<p>校验和段是对帧中所传输的内容进行校验，如图 3.8 所示。</p>
<p><img alt="alt text" src="../image-15.png" /></p>
<p>校验和分为标准型校验和(Classic Checksum)及增强型校验和(Enhanced Checksum)，如表 3.2 所示。</p>
<p><img alt="alt text" src="../image-16.png" /></p>
<p>采用标准型校验和还是增强型校验和由主机节点管理，发布节点和各收听节点根据帧 ID 来判断采用哪种校验和。</p>
<p>校验方法为将校验对象的各字节作带进位二进制加法(每当结果大于等于 256 时就减去 255)，并将所得最终的和逐位取反，以该结果作为要发送的校验和。接收方根据校验和类型，对接收数据作相同的带进位二进制加法，最终的和不取反，并将该和与接收到的校验和作加法，如果结果为 0xFF，则校验和无误，这在一定程度上保证了数据传输的正确性。</p>
<p>例如：采用标准型校验和， Data1 = 0x4A， Data2 = 0x55， Data3 = 0x93， Data4 = 0xE5，计算方法如表 3.3 所示：</p>
<p><img alt="alt text" src="../image-17.png" /></p>
<h4 id="_3">帧传输时间的计算<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h4>
<p>帧(有关帧的结构参照 3.1 节的图 3.2)在总线上传输的时间计算如表 3.4 所示。其中， TFrame_Maximum为帧在总线上传输的最大时间； THeader_Maximum为帧头在总线上传输的最大时间； TResponse_Maximum为应答在总线上传输的最大时间； THeader_Nominal为帧头额定传输时间：同步间隔段(包含同步间隔和同步间隔段间隔符)的最小传输时间 + 同步段传输时间 + 受保护ID段传输时间；帧头的余量THeader_Rest包含字节间间隔，规定为帧头额定传输时间的 0.4 倍； TResponse_Nominal为应答额定传输时间：数据段传输时间 + 校验和段传输时间；应答的余量TResponse_Rest包含应答间隔以及字节间间隔，规定为应答额定传输时间的 0.4 倍； Ndata表示数据段包含N个字节。</p>
<p><img alt="alt text" src="../image-18.png" /></p>
<h4 id="_4">帧在总线上的传输波形<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h4>
<p>帧在总线上的传输波形示例如图 3.9 所示。</p>
<p><img alt="alt text" src="../image-19.png" /> <br />
<img alt="alt text" src="../image-20.png" /></p>
<h3 id="_5">帧的类型<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<p>下面对 3.1.3 节表 3.1“帧的类型”中各种帧进行详细说明。</p>
<h4 id="unconditional-frame">无条件帧(Unconditional Frame)<a class="headerlink" href="#unconditional-frame" title="Permanent link">&para;</a></h4>
<p>无条件帧是具有单一发布节点，无论信号是否发生变化，帧头都被无条件应答的帧。</p>
<p>无条件帧在主机任务分配给它的固定的帧时隙(参照 3.3 节)中传输。总线上一旦有帧头发送出去，必须有从机任务作应答(即无条件发送应答)，如图 3.10 所示，其中列出的帧 ID 的值只是为了举例说明，协议并未强制规定。</p>
<p><img alt="alt text" src="../image-21.png" /></p>
<p>帧 ID = 0x30 应答部分的发布节点为从机节点 1，收听节点为主机节点。典型应用如从机节点 1 向主机节点报告自身某信号的状态。</p>
<p>帧 ID = 0x31 应答部分的发布节点为主机节点，收听节点为从机节点 1 和从机节点 2。典型应用如主机节点向从机节点发布信息。</p>
<p>帧 ID = 0x32 应答部分的发布节点为从机节点 2，收听节点为从机节点 1。典型应用如从机节点之间彼此通信。</p>
<h4 id="event-triggered-frame">事件触发帧(Event Triggered Frame)<a class="headerlink" href="#event-triggered-frame" title="Permanent link">&para;</a></h4>
<p>事件触发帧是主机节点在一个帧时隙(参照 3.3 节)中查询各从机节点的信号是否发生变化时使用的帧，当存在多个发布节点时，通过冲突解决进度表(参照 3.3 节)来解决冲突。</p>
<p>当从机节点信号发生变化的频率较低时，主机任务一次次地轮询各个信号会占用一定的带宽。为了减小带宽的占用，引入了事件触发帧的概念。</p>
<p>事件触发帧的典型应用就是轮询四个车门的开关情况。与其利用无条件帧每个车门轮询一遍，不如同时对四个车门进行询问，如果其中一个车门打开了(事件发生)，该车门要对询问作应答，即事件触发的含义。这样做可以减小带宽，但同时会导致两种现象，其一就是没有车门被打开，即无节点应答——事件触发帧允许一帧中只有帧头无应答；另外一种情况就是冲突，即同时有大于等于两个车门被打开，对该问题同时作答——事件触发帧允许两个以上的节点对帧头作应答而不视为错误。当发生冲突时，主机节点需要重新作轮询，这样会增加一些响应时间，但由于事件触发帧本身就用来处理低概率事件，总的来说还是节省了带宽。</p>
<p>原先用作轮询的无条件帧，称为与该事件触发帧关联的无条件帧，即事件触发帧的应答部分是与其关联的无条件帧所提供的应答。当发生冲突时，需要立刻中断当前的进度表(参照 3.3 节)，启动冲突解决进度表(Collision Resolving Schedule)，重新调用这些关联的无条件帧。其中，冲突解决进度表要求包含所有的关联的无条件帧。图 3.11 示例描述了事件触发帧的传输状况。事件触发帧的帧 ID 为 0x10，与其关联的两个无条件帧的帧 ID 分别是 0x11 和 0x12，这些帧 ID 的值只是为了举例说明，协议并未强制规定。</p>
<p><img alt="alt text" src="../image-22.png" /></p>
<p>与事件触发帧关联的多个无条件帧需要满足以下 5 个条件：</p>
<ul>
<li>数据段包含的数据字节数等长；</li>
<li>使用相同的校验和类型；</li>
<li>数据段的第一个字节为该无条件帧的受保护 ID，这样才能够知道应答是哪个关联的无条件帧发送出来的；</li>
<li>由不同的从机节点发布；</li>
<li>不能与事件触发帧处于同一个进度表(参照 3.3 节)中。</li>
</ul>
<h4 id="sporadic-frame">偶发帧(Sporadic Frame)<a class="headerlink" href="#sporadic-frame" title="Permanent link">&para;</a></h4>
<p>偶发帧是主机节点在同一帧时隙(参照 3.3 节)中当自身信号发生变化时向总线启动发送的帧。当存在多个关联的应答信号变化时，通过事先设定的优先级来仲裁。</p>
<p>与事件触发帧一样，偶发帧的应答也关联了一组无条件帧。规定偶发帧只能由主机节点作为发布节点。偶发帧的传输可能出现三种状况： </p>
<ul>
<li>当关联的无条件帧没有信号发生变化时，该时隙(参照 3.3 节)保持沉默，如图3.12 第一个帧时隙所示，主机节点连帧头都不需要发送； </li>
<li>当其中一个关联的无条件帧包含的信号发生了变化，则发送该关联的无条件帧的应答部分； </li>
<li>如果有两个或两个关联的无条件帧包含的信号发生了变化，则按照事先规定好的优先级，优先级较高的关联的无条件帧获得发送权，优先级较低的要等到下一个偶发帧的帧头到来时才能发送应答。由于主机节点是唯一的发布节点，所以主机节点事先就知道各个关联信号的优先级别，这样在传输时就不会产生冲突。</li>
</ul>
<p>引入偶发帧的目的在于为进度表(参照 3.3 节)增加一些动态特性——当主机节点的信号发生变化时才有通信发生。事件触发帧和偶发帧反映了帧在不同时机(信号变化或未发生变化)的传输状况，引入它们的目的是为了增加通信的灵活性。</p>
<p><img alt="alt text" src="../image-23.png" /></p>
<h4 id="diagnostic-frame">诊断帧(Diagnostic Frame)<a class="headerlink" href="#diagnostic-frame" title="Permanent link">&para;</a></h4>
<p>诊断帧包括主机请求帧和从机应答帧，主要用于配置、识别和诊断用。主机请求帧(Master Request Frame，MRF)，帧 ID = 0x3C，应答部分的发布节点为主机节点；从机应答帧(Slave Response Frame， SRF)，帧 ID = 0x3D，应答部分的发布节点为从机节点。数据段规定为 8 个字节，一律采用标准型校验和。</p>
<h4 id="reserved-frame">保留帧(Reserved Frame)<a class="headerlink" href="#reserved-frame" title="Permanent link">&para;</a></h4>
<p>保留帧的帧 ID 为 0x3E 和 0x3F，为将来扩展用。</p>
<h3 id="schedule">进度表(Schedule)<a class="headerlink" href="#schedule" title="Permanent link">&para;</a></h3>
<p>进度表是帧的调度表，规定总线上帧的传输次序以及各帧在总线上的传输时间。进度表位于主机节点，主机任务根据应用层需要进行调度。进度表可以有多个，一般情况下，轮到某个进度表执行的时候，从该进度表规定的入口处开始顺序执行，到进度表的最后一个帧时，如果没有新的进度表启动，则返回到当前的进度表第一个帧循环执行；也有可能在执行某个进度表当中发生中断，执行另一个进度表后再返回，如事件触发帧的冲突解决过程就是一个典型的例子，如图 3.13 所示。</p>
<p><img alt="alt text" src="../image-24.png" /></p>
<p>进度表除规定了帧 ID 的传输次序外，还规定了帧时隙(Frame Slot)的大小。帧时隙是进度表规定的一个帧的帧头起始到下一个的帧的帧头起始的时间。每个帧的帧时隙都可以不同，一个帧时隙对应了进度表的一个入口，如图 3.14 所示，其中 i = 1～8。</p>
<p><img alt="alt text" src="../image-25.png" /></p>
<p>其中TFrame_Maximum为帧在总线上传输的最大时间，参照 3.1.6 节的表 3.4。抖动(Jitter)为帧的同步间隔段的下降沿与帧时隙起始时刻相差的时间。时基(Time Base)为LIN子网的最小计时单位，通常设定为 5ms或 10ms。帧时隙必须为时基的整数倍，并且起始于时基的开始时刻(称为时基的节拍(Tick))，切换到另外一个进度表时一定要等到当前帧时隙的结束。</p>
<h3 id="state-machine">状态机(State Machine)实现<a class="headerlink" href="#state-machine" title="Permanent link">&para;</a></h3>
<h4 id="_6">主机任务的状态机<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h4>
<p>当进度表启动后，主机任务依次发送同步间隔段、同步段和受保护 ID 段，如图 3.15 所示。</p>
<p><img alt="alt text" src="../image-26.png" /></p>
<h4 id="_7">从机任务的状态机<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h4>
<p>从机任务负责发布或者接听帧的应答。包括两个状态机：</p>
<ol>
<li>同步间隔段和同步段检查器  </li>
<li>帧处理器  </li>
</ol>
<p>从机任务状态机如表 3.5 所示，其中帧处理的状态机如图 3.16 所示。</p>
<p><img alt="alt text" src="../image-27.png" /></p>
<p><img alt="alt text" src="../image-28.png" /></p>
<h3 id="_8">网络管理<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h3>
<p>网络管理主要指的是网络的休眠和唤醒管理，如图 3.17 所示。</p>
<p><img alt="alt text" src="../image-29.png" /></p>
<h4 id="_9">唤醒<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h4>
<p>当总线处于休眠状态时，主/从机节点都可以向总线上发送唤醒信号，唤醒信号持续 250μs～5ms。其余节点(除发送唤醒信号以外的节点)以大于 150μs 为阈值判定唤醒信号。每个从机节点必须在唤醒信号显性脉冲的结束处算起 100ms 以内准备接收来自主机的命令(帧头)；主机节点也必须被唤醒， 100ms 之内主机节点发送帧头开始通信。主机节点的同步间隔段也可以充当唤醒信号，由于从机节点需要作初始化处理，因此主机节点所发的这个帧有可能不会被正常接收。</p>
<p>如果节点发送出唤醒信号后，在 150ms～250ms 之内没有接收到总线上的任何命令(帧头)，则可以重新发送一次唤醒信号。唤醒信号最多可以发送 3 次， 3 次之后，必须等待至少 1.5s 之后才可以再次发送唤醒信号，如图 3.18 所示。</p>
<p><img alt="alt text" src="../image-30.png" /></p>
<h4 id="_10">休眠<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h4>
<p>总线可以在两种情况下进入休眠：</p>
<p>(1) 利用诊断帧中的主机请求帧 0x3C 作休眠命令，要求数据段的第一个字节为 0x00，其余字节为 0xFF。</p>
<p>休眠命令由主机节点发出，总线上的从机节点只判断数据段的第一个字节，其余字节忽略。从机节点在接收到休眠命令后，不一定要进入低功耗模式，根据应用层需要设置，如图 3.19 所示。</p>
<p><img alt="alt text" src="../image-31.png" /></p>
<p>(2) 当总线静默(没有显性和隐性电平之间的切换)4s～10s 时，节点自动进入休眠状态。</p>
<h3 id="_11">状态管理<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h3>
<p>状态管理是为了检测运行中的错误。错误一旦被发现，根据设计需要采取不同的措施进行排除，一种方法是简单替换掉错误节点，另一种方法是让发生问题的节点进入到自我保护/安全模式(Limp Home Mode)。</p>
<h4 id="_12">网络报告<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h4>
<p>协议强制规定，每个从机节点都要在它发布的某个无条件帧中包含一个长度为一位的标量信号 response_error，向主机节点报告自身状态。主机节点负责接收这个信号并且执行分析，如表 3.6 所示。事件触发帧由于允许总线冲突，需特殊处理。</p>
<p><img alt="alt text" src="../image-32.png" /></p>
<p>LIN 协议并没有标准化错误类型，用户可根据需要自行制定。表 3.7 列出了可能出现的一些错误类型供参考。</p>
<p><img alt="alt text" src="../image-33.png" /></p>
<h4 id="_13">节点内部报告<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h4>
<p>节点自身需要设定两个状态位： Error_in_response 和 Successful_transfer。当发送或接收应答的时候发现错误，将置位 Error_in_response；成功传输则置位 Successful_transfer。节点需要将这两个状态位报告给应用层。</p>
<h2 id="_14">帧收发的硬件实现<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h2>
<p>本章着重介绍与 LIN 帧收发相关的硬件的组成、特点以及应用设计时的注意事项。本章内容对应着 LIN 规范的以下部分：</p>
<ul>
<li>LIN Protocol Specification(部分内容)</li>
<li>LIN Physical Layer Specification</li>
</ul>
<h3 id="_15">组成<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h3>
<p>收发 LIN 帧需要的硬件包括协议控制器(Protocol Controller)、总线收发器(Bus Transceiver)和 LIN 总线三部分，如图 4.1 所示。</p>
<p><img alt="alt text" src="../image-34.png" /></p>
<p>LIN 规范并未限定传输介质的类型和连接器的规格。目前 LIN 网络主要使用铜线作为传输介质，针对铜线的总线收发器也是市场主流。鉴于这种情况，下文如无特别说明，均是针对铜线介质展开。</p>
<h3 id="lin_3">LIN 的硬件特点<a class="headerlink" href="#lin_3" title="Permanent link">&para;</a></h3>
<ul>
<li>单线通信</li>
<li>从机节点无需高精度时钟源</li>
<li>EMI 低而且可控</li>
<li>最高通信速率 20kbps</li>
</ul>
<h3 id="_16">协议控制器<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h3>
<p>协议控制器的主体是一个基于 UART/SCI 的通信控制器，工作方式是半双工。协议控制器既可以使用专用模块实现，也可以用“UART/SCI+定时器”实现。发送时，协议控制器把二进制并行数据转变成高-低电平信号，并按照规定的串行格式(8 数据位， 1 停止位，无校验位)送往总线收发器；接收时，协议控制器把来自总线收发器的高-低电平信号按照同样的串行格式储存下来，然后再将储存结果转换成二进制并行数据。</p>
<p>协议控制器要能产生和识别帧的同步间隔段。如前所述，同步间隔段包含一个低电平脉冲，长度至少为 13 位。发出和识别同步间隔段虽然增加了硬件设计的复杂度，但是从接收方的角度看，这样做能把同步间隔段与普通的数据字节区别开，确保了同步信息的特殊性。</p>
<p>协议控制器要能执行本地唤醒(Local Wakeup)。需要唤醒总线时，协议控制器通过总线收发器向 LIN 总线送出唤醒信号(参照 3.5.1 节)。</p>
<p>协议控制器要能识别总线唤醒(Bus Wakeup)。当收到来自 LIN 总线的唤醒信号时，协议控制器能够正确动作，进入规定的通信状态(注 1)。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol>
<li>例如，主机节点延迟 100ms，然后查询唤醒来源。</li>
</ol>
</div>
<h4 id="_17">实现方案<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h4>
<p>依据硬件资源不同可以分为 3 类： UART/SCI+定时器+外部中断、硬件 LIN(Hardware LIN)和 LIN 模块(LIN Module)，分别面向对成本和性能有不同侧重的应用。</p>
<h3 id="_18">总线收发器<a class="headerlink" href="#_18" title="Permanent link">&para;</a></h3>
<p>总线收发器的主体是一个双向工作的电平转换器，完成协议控制器的高-低电平与 LIN 总线的隐性-显性电平(注 1)之间的转换。显性-隐性电平的定义如表 4.2 所示。</p>
<p><img alt="alt text" src="../image-35.png" /></p>
<p>LIN 规范规定： LIN 总线的电平参考点是总线收发器的电源参考点。为了克服电源波动和参考点漂移的影响， LIN 规范要求总线收发器要能承受±11.5%的电源波动和参考点电平波动，并且能承受电源和参考点之间 8% 的电位差波动。收发双方的电平鉴别门限也设置了较大的冗余度。</p>
<p>总线收发器还包括一些附加的功能，例如总线阻抗匹配、压摆率(Slew-rate)控制等。</p>
<p>此外， LIN 规范要求总线收发器具备这样一种特性：本地节点掉电或工作异常时，不能影响总线上其他节点工作。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol>
<li>“显性-隐性”此处有两个含义，一是突出 LIN 总线“线-与”的本质，二是与协议控制器的“高-低电平”相区别。</li>
</ol>
</div>
<h4 id="_19">实现方案<a class="headerlink" href="#_19" title="Permanent link">&para;</a></h4>
<p>在一些要求不高的场合，可以采用简单的收发器电路，如图 4.2 所示。</p>
<p><img alt="alt text" src="../image-36.png" /></p>
<p>不少半导体厂商提供集成化的总线收发器，这些产品功能完善，环境适应能力强，设计产品时建议优先考虑。</p>
<h3 id="lin_4">LIN 总线<a class="headerlink" href="#lin_4" title="Permanent link">&para;</a></h3>
<p>LIN 总线是衔接所有 LIN 节点的通信介质。</p>
<p>LIN 总线的特征阻抗——尤其是容抗——会影响信号的波形，在设计产品时应予以重视，参照 4.8.2 节。</p>
<p>为汽车电子产品增加 LIN 功能所花费的成本与获得的灵活性相比，往往后者更为显著。汽车上大多数传感器、执行器除至少要接 1 根电源线和 1 根地线外，此外还有一些模拟/数字信号线，这些接口往往存在兼容性的问题。如果采用 LIN 规范，仅用 3 根线(电源、地和 LIN)就可以实现标准化的数字接口。传感器、执行器通过总线连接，汽车结构设计可以更加灵活，线束的数量(重量)不但不会增加，还可能减少。</p>
<h3 id="_20">时钟源<a class="headerlink" href="#_20" title="Permanent link">&para;</a></h3>
<p>LIN 网络的主机节点必须设置较高精度的时钟，而从机节点则不必。换句话说，主机节点是 LIN 网络的时间基准，这保证了位速率的准确性。 LIN 规范规定一个 LIN 网络里只有一个主机节点，这保证了位速率的唯一性。 LIN 规范规定所有通信都由主机节点发起，并在帧头中加入同步段，这就给从机节点提供了主机节点位速率的信息。只要所有从机节点都能在 LIN 通信时与主机节点采用同样的位速率， LIN 网络就能正常工作。这种做法虽然降低了传输效率，但是一方面减少了高精度时钟数量，降低了成本；另一方面不需要仲裁，降低了软硬件设计复杂度。</p>
<p>主机节点、从机节点位速率要满足表 4.3 的要求。</p>
<p><img alt="alt text" src="../image-37.png" /></p>
<p>对表 4.3 的参数说明如下：</p>
<ul>
<li>主机节点、从机节点的位速率必须在使用环境要求的温度范围和电压范围内，优于规定的精度(主机节点是±0.5%，从机节点是±14%)。</li>
<li>同步之前，主机和从机节点的位速率与额定位速率的误差应符合 Ftol_res_master 和 Ftol_res_slave/Ftol_unsync 的要求。主机节点按主机位速率发出同步间隔段，从机节点应可按从机位速率将其解释为长度大于 9～11 位的显性电平(这个宽度必须是帧的其他部分不可能出现的)。这里除了要考虑从机节点对时间的测量误差(取决于时钟精度)，还要考虑从机节点可用位速率与额定位速率的误差，以及 LIN 总线电抗特性造成的传输延迟(固有误差，取决于硬件设计)。</li>
<li>同步之后，从 PID 段到校验和段，通信双方的位速率相对误差不大于±2%(即Ftol_sync 和 Ftol_sl_to_sl)。如果是主机节点与从机节点通信，设 Ftol_res_master 为±0.5%，那么不论从机节点是否利用同步段修正位速率，其位速率相对于额定位速率的误差不能大于 Ftol_sync - Ftol_res_master，即±1.5%。如果是从机节点之间通信，对从机节点各自的位速率误差的要求将高于±1.5%。</li>
</ul>
<h3 id="emi">EMI 及其控制<a class="headerlink" href="#emi" title="Permanent link">&para;</a></h3>
<p>EMI 这里指电磁干扰。对于 LIN 而言， EMI 主要由位速率和压摆率共同决定。位速率决定单位时间内电平变化次数，压摆率决定电平跳变的快慢。单位时间内跳变次数越多，每次跳变持续时间越短，跳变过程包含的谐波成分就越丰富， EMI 也越大；相反，跳变持续时间越长，单位时间跳变次数越少，其谐波成分越少， EMI 也较低。</p>
<p>LIN 可以控制 EMI。这是因为协议控制器可以控制 LIN 总线位速率，总线收发器可以控制压摆率。另外，LIN 协会把 LIN 的最高位速率限制在 20kbps。值得一提的是，这个速度远非 LIN 物理层的极限，而是在数据速率与 EMI 之间权衡的结果。</p>
<h3 id="_21">设计电路时的注意事项<a class="headerlink" href="#_21" title="Permanent link">&para;</a></h3>
<h4 id="_22">工作环境对时钟的影响<a class="headerlink" href="#_22" title="Permanent link">&para;</a></h4>
<p>片上振荡器容易受到环境温度和电源电压的影响，石英晶体容易受到冲击振动的破坏。在选择时钟源时，一定要考虑使用环境的温度范围、电源电压范围和冲击振动情况。在电路板布局时，要让时钟器件尽量避开热源和易受外力冲击的部位。总之，要确保在最恶劣的情况下，也能保证时钟的精度和稳定性。</p>
<p>LIN 的硬件部分应该在-40℃~+125℃的温度范围内保证满足 LIN 规范规定的指标。在电源适应性方面，要能承受±11.5%(注 1)的电压波动。对于汽车电子产品，还要承受汽车电源系统常见的总线短路、负载突降(Load Dump)、电源反接、蓄电池串联(Jump-start)等现象。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol>
<li>LIN 规范 2.1 版将这个指标提高到±11.5%， LIN 规范 1.x 和 2.0 版中，这个指标是±10%。</li>
</ol>
</div>
<h4 id="_23">端接阻抗和总线负载<a class="headerlink" href="#_23" title="Permanent link">&para;</a></h4>
<p>为了实现“线-与”特性， LIN 规范规定了主机节点和从机节点的端接电阻，如表 4.4 所示。端接电阻一端连接 LIN 总线，另一端经串联二极管连接收发器电源，如图 4.3 所示。图中的串联二极管是必须的，当 ECU 的“电池断路”的时候，它可以防止 LIN 总线向 ECU 供电。</p>
<p><img alt="alt text" src="../image-38.png" /></p>
<p><img alt="alt text" src="../image-39.png" /></p>
<p>LIN 子网各节点并联在一起，构成如图 4.4 所示的等效电路。其中，总线负载电阻等于各节点端接电阻的并联等效电阻(总线的电阻通常很小，可以忽略)，总线负载电容等于各节点输入电容和总线分布电容的并联等效电容。总线电阻决定了总线收发器驱动级的功率和通信期间的功耗；总线电容可以很好地吸收周围环境的噪声干扰。总线电阻和总线电容构成的 RC 滤波器还有助于控制压摆率。</p>
<p><img alt="alt text" src="../image-40.png" /></p>
<p>为确保最恶劣情况下正常通信的需要， LIN 规范除了限制节点的端接电阻、电容和时间常数，还规定 LIN 总线长度不超过 40 米，一个 LIN 网络的最大节点数目不超过 16。</p>
<p>应注意，由于端接电阻连接着电源和 LIN 总线，当出现 LIN 总线对地短路时，如果不采取保护措施，会有较大的电流流过端接电阻，产生显著的功耗。</p>
<h4 id="esd">ESD 防护<a class="headerlink" href="#esd" title="Permanent link">&para;</a></h4>
<p>ESD(Electrostatic Discharge)指静电危害，表现为短暂而幅度迅速衰减的高压、大电流放电，由于其瞬间电压可达数千伏，对于工作在干燥的环境或者接地不良的电子产品威胁最严重。</p>
<p>总线收发器最容易受到 ESD 的冲击。 LIN 规范要求总线收发器的电源和地应直接连接到 ECU 的接口处，这就使电源线成为 ESD 侵入的窗口。同样， LIN 总线也可能窜入 ESD。如果处理不当，容易因为放电过程中的高压、大电流烧毁内部器件。</p>
<p>设计时可以采取以下措施：</p>
<ul>
<li>在电源线和地线之间串联电阻和电容；</li>
<li>地线加粗，并与其它大面积接地导体就近，链接低阻抗；</li>
<li>在 LIN 信号线与地线之间并接 ESD 保护器件，例如瞬态电压抑制器件(Transient Voltage Suppressor，TVS)、 RC 滤波器(注 1)等。</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol>
<li>RC 滤波器的截止频率应远高于 LIN 的位速率，否则会影响 LIN 通信波形。</li>
</ol>
</div>
<h4 id="_24">兼容性<a class="headerlink" href="#_24" title="Permanent link">&para;</a></h4>
<p>协议控制器可以用广泛使用的 UART/SCI 来实现。</p>
<p>总线收发器的主要指标符合 ISO 9141 的要求。</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 ZhangBinbin/All Rights Reserved.
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://iamzhangbinbin.github.io/" target="_blank" rel="noopener" title="Wechat" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M385.2 167.6c6.4 0 12.6.3 18.8 1.1C387.4 90.3 303.3 32 207.7 32 100.5 32 13 104.8 13 197.4c0 53.4 29.3 97.5 77.9 131.6l-19.3 58.6 68-34.1c24.4 4.8 43.8 9.7 68.2 9.7 6.2 0 12.1-.3 18.3-.8-4-12.9-6.2-26.6-6.2-40.8-.1-84.9 72.9-154 165.3-154m-104.5-52.9c14.5 0 24.2 9.7 24.2 24.4 0 14.5-9.7 24.2-24.2 24.2-14.8 0-29.3-9.7-29.3-24.2.1-14.7 14.6-24.4 29.3-24.4m-136.4 48.6c-14.5 0-29.3-9.7-29.3-24.2 0-14.8 14.8-24.4 29.3-24.4 14.8 0 24.4 9.7 24.4 24.4 0 14.6-9.6 24.2-24.4 24.2M563 319.4c0-77.9-77.9-141.3-165.4-141.3-92.7 0-165.4 63.4-165.4 141.3S305 460.7 397.6 460.7c19.3 0 38.9-5.1 58.6-9.9l53.4 29.3-14.8-48.6C534 402.1 563 363.2 563 319.4m-219.1-24.5c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.8 0 24.4 9.7 24.4 19.3 0 10-9.7 19.6-24.4 19.6m107.1 0c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.5 0 24.4 9.7 24.4 19.3.1 10-9.9 19.6-24.4 19.6"/></svg>
    </a>
  
    
    
    
    
    <a href="https://iamzhangbinbin.github.io/" target="_blank" rel="noopener" title="telegram" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M248 8C111.033 8 0 119.033 0 256s111.033 248 248 248 248-111.033 248-248S384.967 8 248 8m114.952 168.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.45 10.45 0 0 1 3.53 6.716 43.8 43.8 0 0 1 .417 9.769"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://iamzhangbinbin.github.io/" target="_blank" rel="noopener" title="iamzhangbinbin.github.io" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8l164.9-188.5L26.8 48h145.6l100.5 132.9zm-24.8 373.8h39.1L151.1 88h-42z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://iamzhangbinbin.github.io/" target="_blank" rel="noopener" title="iamzhangbinbin.github.io" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:<z466302@126.com>" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M64 112c-8.8 0-16 7.2-16 16v22.1l172.5 141.6c20.7 17 50.4 17 71.1 0L464 150.1V128c0-8.8-7.2-16-16-16zM48 212.2V384c0 8.8 7.2 16 16 16h384c8.8 0 16-7.2 16-16V212.2L322 328.8c-38.4 31.5-93.7 31.5-132 0zM0 128c0-35.3 28.7-64 64-64h384c35.3 0 64 28.7 64 64v256c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://iamzhangbinbin.github.io/" target="_blank" rel="noopener" title="iamzhangbinbin.github.io" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M488.6 104.1c16.7 18.1 24.4 39.7 23.3 65.7v202.4c-.4 26.4-9.2 48.1-26.5 65.1-17.2 17-39.1 25.9-65.5 26.7H92.02c-26.45-.8-48.21-9.8-65.28-27.2C9.682 419.4.767 396.5 0 368.2V169.8c.767-26 9.682-47.6 26.74-65.7C43.81 87.75 65.57 78.77 92.02 78h29.38L96.05 52.19c-5.75-5.73-8.63-13-8.63-21.79 0-8.8 2.88-16.06 8.63-21.797C101.8 2.868 109.1 0 117.9 0q13.2 0 21.9 8.603L213.1 78h88l74.5-69.397C381.7 2.868 389.2 0 398 0q13.2 0 21.9 8.603c5.7 5.737 8.6 12.997 8.6 21.797 0 8.79-2.9 16.06-8.6 21.79L394.6 78h29.3c26.4.77 48 9.75 64.7 26.1m-38.8 69.7c-.4-9.6-3.7-17.4-10.7-23.5-5.2-6.1-14-9.4-22.7-9.8H96.05c-9.59.4-17.45 3.7-23.58 9.8-6.14 6.1-9.4 13.9-9.78 23.5v194.4c0 9.2 3.26 17 9.78 23.5s14.38 9.8 23.58 9.8H416.4c9.2 0 17-3.3 23.3-9.8s9.7-14.3 10.1-23.5zm-264.3 42.7c6.3 6.3 9.7 14.1 10.1 23.2V273c-.4 9.2-3.7 16.9-9.8 23.2-6.2 6.3-14 9.5-23.6 9.5s-17.5-3.2-23.6-9.5-9.4-14-9.8-23.2v-33.3c.4-9.1 3.8-16.9 10.1-23.2s13.2-9.6 23.3-10c9.2.4 17 3.7 23.3 10m191.5 0c6.3 6.3 9.7 14.1 10.1 23.2V273c-.4 9.2-3.7 16.9-9.8 23.2s-14 9.5-23.6 9.5-17.4-3.2-23.6-9.5c-7-6.3-9.4-14-9.7-23.2v-33.3c.3-9.1 3.7-16.9 10-23.2s14.1-9.6 23.3-10c9.2.4 17 3.7 23.3 10"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.instant", "navigation.instant.progress", "navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.expand", "navigation.prune", "navigation.indexes", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "search.share", "header.autohide", "announce.dismiss", "content.code.copy", "content.code.annotate", "content.tabs.link", "content.tooltips"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>