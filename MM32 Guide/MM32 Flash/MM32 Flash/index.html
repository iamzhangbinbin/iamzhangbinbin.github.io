
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="张彬彬的个人技术博客">
      
      
        <meta name="author" content="张彬彬">
      
      
        <link rel="canonical" href="https://iamzhangbinbin.github.io/MM32%20Guide/MM32%20Flash/MM32%20Flash/">
      
      
        <link rel="prev" href="../../">
      
      
        <link rel="next" href="../../MM32%20ADC/MM32%20ADC/">
      
      
      <link rel="icon" href="../../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>MM32 Flash - 张彬彬的杂货铺</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#mm32-flash" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="张彬彬的杂货铺" class="md-header__button md-logo" aria-label="张彬彬的杂货铺" data-md-component="logo">
      
  <img src="../../../img/zahuopu.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            张彬彬的杂货铺
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              MM32 Flash
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="indigo"  aria-label="切换至夜间模式"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="切换至夜间模式" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="切换至日间模式"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="切换至日间模式" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="分享" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/iamzhangbinbin/iamzhangbinbin.github.io" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    I'mZhangBinbin
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../MCU%E5%BC%80%E5%8F%91%E6%94%AF%E6%8C%81/" class="md-tabs__link">
          
  
  
    
  
  MCU开发支持

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
    
  
  MM32 Guide

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../Python%E7%AC%94%E8%AE%B0/" class="md-tabs__link">
          
  
  
    
  
  Python笔记

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E5%BC%80%E6%BA%90%E8%BD%AF%E4%BB%B6%E7%A7%BB%E6%A4%8D/" class="md-tabs__link">
          
  
  
    
  
  开源软件移植

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E6%A0%87%E5%87%86%E4%B8%8E%E8%AE%A4%E8%AF%81/" class="md-tabs__link">
          
  
  
    
  
  标准与认证

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../USB%E5%85%A5%E9%97%A8/" class="md-tabs__link">
          
  
  
    
  
  USB入门

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../CAN%E5%85%A5%E9%97%A8/" class="md-tabs__link">
          
  
  
    
  
  CAN入门

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../ENET%E5%85%A5%E9%97%A8/" class="md-tabs__link">
          
  
  
    
  
  ENET入门

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../blog/" class="md-tabs__link">
          
  
  
    
  
  博客

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../.." class="md-tabs__link">
          
  
  
    
  
  About

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="张彬彬的杂货铺" class="md-nav__button md-logo" aria-label="张彬彬的杂货铺" data-md-component="logo">
      
  <img src="../../../img/zahuopu.png" alt="logo">

    </a>
    张彬彬的杂货铺
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/iamzhangbinbin/iamzhangbinbin.github.io" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    I'mZhangBinbin
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../MCU%E5%BC%80%E5%8F%91%E6%94%AF%E6%8C%81/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    MCU开发支持
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    MM32 Guide
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            MM32 Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    MM32 Flash
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    MM32 Flash
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#flash" class="md-nav__link">
    <span class="md-ellipsis">
      Flash 发展史
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      磁盘的组织结构
    </span>
  </a>
  
    <nav class="md-nav" aria-label="磁盘的组织结构">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      盘片与盘面
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      磁道与扇区
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      柱面
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      磁盘的物理地址
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      磁盘块
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      簇
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      块与页的关系
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flash_1" class="md-nav__link">
    <span class="md-ellipsis">
      Flash 中的扇区、页、块
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mm32-flash_1" class="md-nav__link">
    <span class="md-ellipsis">
      MM32 Flash 构成
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mm32-flash_2" class="md-nav__link">
    <span class="md-ellipsis">
      MM32 Flash 基本操作
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MM32 Flash 基本操作">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      解锁
    </span>
  </a>
  
    <nav class="md-nav" aria-label="解锁">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      对闪存块操作限制的解除与使能
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      对选项字节区块操作限制的解除和使能
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      对分块保护区擦除限制的解除与使能
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      擦除
    </span>
  </a>
  
    <nav class="md-nav" aria-label="擦除">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      主闪存块擦除
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      选项字节区擦除
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data" class="md-nav__link">
    <span class="md-ellipsis">
      Data空间擦除
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      编程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="编程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      主闪存块编程
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      选项字节区编程
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data_1" class="md-nav__link">
    <span class="md-ellipsis">
      Data空间编程
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flash_2" class="md-nav__link">
    <span class="md-ellipsis">
      读 Flash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      闪存保护
    </span>
  </a>
  
    <nav class="md-nav" aria-label="闪存保护">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      读保护
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      写保护
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mm32-flash_3" class="md-nav__link">
    <span class="md-ellipsis">
      MM32 Flash 寄存器概览
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MM32%20ADC/MM32%20ADC/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MM32 ADC
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MM32%20MDPWM/MM32%20MDPWM/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MM32 MDPWM
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MM32%20FSMC/MM32%20FSMC/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MM32 FSMC
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MM32%20Timer/MM32%20Timer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MM32 Timer
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../Python%E7%AC%94%E8%AE%B0/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Python笔记
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../%E5%BC%80%E6%BA%90%E8%BD%AF%E4%BB%B6%E7%A7%BB%E6%A4%8D/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    开源软件移植
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../%E6%A0%87%E5%87%86%E4%B8%8E%E8%AE%A4%E8%AF%81/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    标准与认证
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../USB%E5%85%A5%E9%97%A8/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    USB入门
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../CAN%E5%85%A5%E9%97%A8/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    CAN入门
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../ENET%E5%85%A5%E9%97%A8/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    ENET入门
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../blog/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    博客
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../.." class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    About
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="mm32-flash">MM32 Flash 介绍<a class="headerlink" href="#mm32-flash" title="Permanent link">&para;</a></h1>
<h2 id="flash">Flash 发展史<a class="headerlink" href="#flash" title="Permanent link">&para;</a></h2>
<p>相对于许多计算机技术而言，闪存的发展史相对短暂，但它可以说是应巨大且快速变化的存储市场要求而迅速成长的一项技术。起源于60年代末，80年代初提出概念，在过去的数十年发展中已然成熟，现在让我们回溯时光,去探知一段属于闪存（Flash Memory）的辉煌发展史。</p>
<ul>
<li>
<p>1967年：贝尔实验室（Bell Lab）的施敏博士（Simon Sze）和韩裔同事姜大元（Dawon Kahng）休息吃甜点时，用了一层又一层的涂酱，触动了二人的灵感，想到在金属氧化物半导体场效电晶体（MOSFET）中间加入一层金属层，结果发明了浮栅MOSFET。浮栅MOSFET成了后来Flash、EEPROM和EPROM的基础。</p>
</li>
<li>
<p>1970年：英特尔（Intel）工程师Dov Frohman发明第一款成功的浮栅型器件——EPROM，通过照射紫外线光擦除，在存储软件中广受欢迎，对英特尔成功推出微处理器非常重要。英特尔联合创始人戈登·摩尔（Gordon Moore）称这项创新为“与微处理器一样，在计算机行业的发展中同样重要”。</p>
</li>
<li>
<p>1979-81年。Eli Harari，美国闪存存储开发商SanDisk(闪迪)创始人，当时受聘于英特尔，发明了世界上首个电可编程和可擦除存储器——EEPROM，并展望了浮栅的未来愿景——取代磁盘，但提案被当时的英特尔CEO Andy grove否决。</p>
</li>
<li>
<p>1984年。闪存之父Fujio Masuoka博士在东芝时提交了一份关于浮栅新用途的行业白皮书，整个芯片的内容都可以在相机的闪光（flash）的瞬间被擦除。之后Masuoka博士在圣何塞举行的IEEE 1984综合电子设备大会上正式介绍了闪存（Flash Memory）。</p>
</li>
<li>
<p>1986年。英特尔提出闪存卡概念，成立SSD研发部门。</p>
</li>
<li>
<p>1987年，Masuoka博士又再接再厉发明了NAND闪存即2D NAND。</p>
</li>
<li>
<p>1988年。英特尔看到了闪存的巨大潜力，推出了首款商用闪存芯片，成功取代了EPROM产品，主要用于存储计算机软件。同年3月1日，Eli创立Sundisk(后更名为SanDisk闪迪)，致力于让闪存更像一块磁盘用来存储数据。</p>
</li>
<li>
<p>1989年。SunDisk提交了系统闪存专利。M-Systems成立，不久推出闪存磁盘概念，这是闪存SSD的先驱。同年，英特尔发售了512K和1MB NOR Flash。Psion推出了基于闪存的PC。微软与英特尔合作推出了闪存文件系统。西部数据则与SunDisk完全模拟传统的旋转ATA硬盘，推出了基于NOR Flash的SSD。随后三星和东芝各自推出NAND闪存，擦写时间更快，密度更高，比NOR Flash成本更低，并且拥有高于十倍的耐用性。但其的I/O接口只允许顺序访问数据，适用于诸如PC卡和各种存储卡类的大容量存储设备。</p>
</li>
<li>
<p>1990年。东芝完成NAND Flash原型设计；Psion公司推出首台基于闪存的PC机MC600，包括640K内存、1M内置磁盘和256K闪存（含有MS-DOS 3.22）。</p>
</li>
<li>
<p>1991年。SunDisk推出首款基于闪存的ATA SSD，容量为20MB。当时10000台IBM ThinkPad掌上笔记本电脑提供SSD取代磁盘的服务支持。东芝发布全球首个4 MB NAND闪存。柯达以13000美元的价格发售了第一台专业数码相机DSC100，带有200Mb的存储空间，机身重量7公斤。Zenith Poqet和惠普在计算机展销会上展示了使用闪存卡的掌上笔记本电脑。</p>
</li>
<li>
<p>1992年。AMD和富士通推出了首款NOR产品。英特尔推出包括第二代FFS 2，8MB闪存芯片，4MB-20MB线性闪存卡和用于BIOS应用的1MB Boot Block NOR Flash，首次采用内部写状态机管理闪存写算法。SunDisk则推出了PCMCIA闪存卡。自1992年开始，PC开始采用闪存进行BIOS存储。</p>
</li>
<li>
<p>1993年。英特尔推出了16MB和32MB NOR Flash。英特尔和康纳联合开发了5MB/10MB ATA闪存盘。苹果在他们的Newton PDA中开始使用NOR Flash。</p>
</li>
<li>
<p>1994年。SunDisk针对SSD应用推出Compact Flash卡和18MB串行NOR Flash芯片。</p>
</li>
<li>
<p>1995年。SunDisk更名为SanDisk（闪迪）推出了34MB 串行NOR Flash，这是首款面向SSD应用的MLC闪存芯片。</p>
</li>
<li>
<p>1996年。东芝推出了SmartMedia存储卡，也称为固态软盘卡。三星开始发售NAND闪存。SanDisk推出了采用MLC串行NOR技术的第一张闪存卡。</p>
</li>
<li>
<p>1997年。英飞凌（Infineon）和SanDisk共同推出MultiMedia Card（MMC），手机开始配置闪存，消费级闪存市场就此打开；</p>
</li>
<li>
<p>1999年。NOR Flash营收超过40亿美元。东芝和SanDisk合作创建了闪存制造合资企业。美光宣布超过10亿个闪存芯片已发售。</p>
</li>
<li>
<p>2000年。东芝和闪迪合资创立闪存制造企业FlashVision，建设8英寸生产线；</p>
</li>
<li>
<p>2001年。东芝与SanDisk宣布推出1GB MLC NAND。SanDisk自己推出了首款NAND系统闪存产品。日立推出了AG-AND。三星开始批量生产512MB闪存设备。</p>
</li>
<li>
<p>2002年。超微半导体、富士通和赛芬（Saifun）宣布经达成合作、交叉许可专利和技术的协议，并和解三方之间所有尚未结案的诉讼，并共同研发闪存技术MirrorBit，容量为64M。</p>
</li>
<li>
<p>2003年。Fujitsu AMD Semiconductor Limited（FASL）更名飞索（Spansion），推出全球首款采用130/110纳米第二代MirrorBit工艺技术512MbNOR闪存芯片。</p>
</li>
<li>
<p>2004年。NAND的价格首次基于同等密度降至DRAM之下，成本效应让闪存走入计算领域。</p>
</li>
<li>
<p>2005年。苹果公司推出两款基于闪存的iPod——iPod shuffle和iPod nano。微软发布混合硬盘概念。MMCA（多媒体卡协会）推出MMCmicro卡。三星率先采用70nm制程量产NAND闪存。美光也推出了NAND产品。同年超过30亿闪存芯片发售被发货。 NAND总发售容量超过DRAM。</p>
</li>
<li>
<p>2006年。闪存营收超过200亿美元。英特尔推出Robson Cache Memory，现在称为Turbo Memory（迅盘）。微软推出ReadyBoost。SanDisk宣布推出单元存储4比特的NAND技术和microSDHC卡。与此同时，SanDisk还收购了Martix Semiconductor和M-Systems两家公司。三星和希捷展示了首款混合硬盘。美光和英特尔正式合作组建IMFT，用于制造NAND闪存。Spansion推出ORNAND闪存，并宣布开始采用65nm制程工艺生产300mm晶圆。</p>
</li>
<li>
<p>2007年。闪存营收突破220亿美元（NAND 营收145亿美元）。东芝推出eMMC NAND以及首款基于MLC SATA的固态硬盘。 IMFT开始发售50nm NAND闪存。Apple正式推出了初代配置4GB或8GB闪存的iPhone。Fusion-io宣布推出基于 MLC NAND的640 GB ioDrive。BitMicro面向军事应用推出3.5英寸SSD，容量为1.6TB。 Spansion收购了Saifun。戴尔对自身笔记本电脑配置加入了SSD选项，售价低于200美元的上网本加入了闪存存储。希捷推出了第一款混合硬盘——Momentus PSD。</p>
</li>
<li>
<p>2008年。SanDisk推出ABL以实现加速MLC，TLC和X4 NAND。英特尔和美光宣布推出34nm MLC NAND。东芝首次推出了512GB的MLC SATA SSD。IBM首次展示了“百万IOPS”的闪存阵列。 EMC宣布将基于闪存的SSD用于企业SAN应用。苹果推出了两代MacBook Air，分别配备64GB和128GB SSD，没有硬盘选项。美光，三星和Sun Microsystems宣布推出高耐用性闪存。Violin首次推出基于全闪存的存储设备。三星宣布推出150GB 2.5英寸MLC SSD。美光推出首款串行NAND闪存。东芝开发了3D NAND结构BICS。</p>
</li>
<li>
<p>2009年。英特尔和美光推出34nm TLC NAND。三星推出首款配置64GB SSD的全高清摄录一体机。希捷进入SSD市场。SandForce推出了第一款基于数据压缩的SSD控制器。Virident和Schooner针对数据中心推出了第一款基于闪存的应用设备。Plaint推出了首款SAS SSD。 SanDisk发售每单元存储4比特的SDHC和Memory Stick Pro卡。西部数据收购了SiliconSystems进入SSD市场。SanDisk推出了号称数据可保存100年的闪存存储库。</p>
</li>
<li>
<p>2010年。东芝推出基于16核堆栈的128GB SD卡。英特尔和美光公司推出25nm TLC和MLC NAND。同年，Numonyx被美光收购、SST被Microchip收购。三星开始生产64 GB MLC NAND。希捷宣布推出首款自管理混合硬盘——Momentus XT。</p>
</li>
<li>
<p>2011年。是一个收购年。LSI收购SandForce；SanDisk收购IMFT，苹果收购Anobit，Fusion-io收购IO Turbine。希捷推出了第二代Momentus XT混合硬盘，拥有8GB NAND闪存和750GB HDD存储容量。</p>
</li>
<li>
<p>2012年。三星创造了3D NAND，推出第一代3D NAND闪存芯片，也是第一款32层 SLC V-NAND SSD——850 PRO。SanDisk和东芝宣布推出支持128GB芯片的19nm闪存。希捷推出了结合闪存和HDD的SSHD。Elpida推出ReRAM。美光和英特尔推出20nm的128Gb NAND芯片。SK电信收购海力士半导体的控股权，SK海力士成立。Spansion推出了8Gb NOR芯片。SanDisk收购了FlashSoft。OCZ收购了Sanrad。三星收购了NVELO。英特尔收购了Nevex并推出CacheWorks。LSI推出了配置MegaRAID CacheCade缓存软件的Nytro闪存。美光推出了2.5英寸企业级PCIe SSD。</p>
</li>
<li>
<p>2013年。三星宣布推出24层3D V-NAND，并在2013年美国闪存峰会（FMS）上展示了1TB SSD。Diablo Technologies宣布推出内存通道存储技术。SMART Storage Systems将Diablo的设计纳入ULtraDIMM。西部数据和SanDisk采用iSSSD+HDD推出了SSHD。东芝推出了一系列SSHD。Everspin宣布发售STT MRAM。M.2 PCIe接口正式发布NVMe标准，以加速与闪存存储的通信。西部数据先后收购了sTec，Virident和Velobit。SanDisk收购SMART Storage Systems。美光收购了破产的日本芯片制造商尔必达。英特尔推出了英特尔缓存加速软件。</p>
</li>
<li>
<p>2014年。三星，SanDisk和东芝宣布推出3D NAND生产设备。SanDisk推出了4TB企业级SSD，还发布了128GB microSD卡。IBM宣布其eXFlash DIMM采用了SanDisk ULLtraDIMM以及Diablo的内存通道存储技术。三星还开始发售32层 MLC 3D V-NAND——850 EVO。</p>
</li>
<li>
<p>2015年。SanDisk推出InfinitiFlash存储系统。赛普拉斯半导体收购Spansion。东芝和SanDisk宣布推出48层3D NAND。英特尔和美光宣布推出384GB 3D NAND。三星推出首款NVMe m.2固态硬盘和48层 V-NAND。SanDisk推出 200GB microSDXC UHS-I卡。赛普拉斯推出4MB串行FRAM。英特尔和美光宣布推出3D XPoint Memory。英特尔还基于XPoint技术推出了Optane DIMM和SSD。</p>
</li>
<li>
<p>2016年。东芝发售了用于iPhone 7的48层TLC NAND。同年，SK海力士基于36层堆叠技术发售了用于LG V20的UFS系列产品。武汉新芯集成电路制造有限公司（XMC）在中国开设第一家NAND闪存工厂。美光展示了768GB 3D NAND。西部数据以190亿美元的价格收购SanDisk。Everspin在年底前宣布推出256MB MRAM芯片和1 GB芯片。IBM发布TLC PCM存储芯片。英特尔着手向企业级市场发售3D NAND产品，而美光则改道消费级市场发售SSD。</p>
</li>
<li>
<p>2017年，SK海力士发售72层3D NAND。东芝。英特尔发售Optane SSD。HPE（新华三）收购Nimble和Simplivity。三星与东芝/西部数据发售96层3D NAND。美光发售字符串堆栈3D NAND。Everspin发布1GB STT-MRAM芯片样品。同年，2005年成立的闪存阵列老牌厂商Violin Memory破产后被私有化，目前已重回存储舞台。</p>
</li>
<li>
<p>2018年，贝恩资本财团完成对东芝闪存业务的180亿美元收购案。英特尔发布Optane DC（数据中心）持久性内存。三星发布告诉Z-SSD。国家集成电路产业投资基金一期针对国内半导体行业投资1387亿元，共公开投资了23家国内半导体企业。紫光集团旗下长江存储研发32层3D NAND芯片并在年底量产，更计划在2020年跳过96层3D NAND，直接进入128层堆叠。同年，混合闪存初创公司Tintri申请破产，其资产被HPC存储供应商DDN以6000万美元购得。  </p>
</li>
</ul>
<h2 id="_1">磁盘的组织结构<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<h3 id="_2">盘片与盘面<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<p>一个磁盘由多个盘片叠加而成。盘片的表面涂有磁性物质，这些磁性物质用来记录二进制数据。因为正反两面都可涂上磁性物质，故一个盘片可能会有两个盘面。<br />
<img alt="alt text" src="../image.png" /></p>
<h3 id="_3">磁道与扇区<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p>每个盘片被划分为一个个磁道，每个磁道又划分为一个个扇区。通常情况下每个扇区的大小是512字节。（由于不断提高磁盘的大小，部分厂商设定每个扇区的大小是4096字节）。如下图：<br />
<img alt="alt text" src="../%E7%A3%81%E9%81%93%E4%B8%8E%E6%89%87%E5%8C%BA.png" />  </p>
<h3 id="_4">柱面<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<p>每个盘面对应一个磁头。所有的磁头都是连在同一个磁臂上的，因此所有磁头只能“共进退”。
所有盘面中相对位置相同的磁道组成柱面。如下图：<br />
<img alt="alt text" src="../image-1.png" />
<img alt="alt text" src="../image-2.png" />  </p>
<h3 id="_5">磁盘的物理地址<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<p>由上，可用（柱面号，盘面号，扇区号）来定位任意一个“磁盘块”。</p>
<h3 id="_6">磁盘块<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<p>与扇区对应的逻辑层面上的概念是： 磁盘块（虚拟出来的）。 块是操作系统中最小的逻辑存储单位。操作系统与磁盘打交道的最小单位是磁盘块。既然磁盘块是一个虚拟概念。是操作系统自己＂杜撰＂的。软件的概念，不是真实的。所以大小由操作系统决定，操作系统可以配置一个块多大。
一个块大小=一个扇区大小*2的n次方。N是可以修改的。</p>
<h3 id="_7">簇<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<p>通俗的来讲，在Windows下如NTFS等文件系统中叫做簇；在Linux下如Ext4等文件系统中叫做块（block）。每个簇或者块可以包括2、4、8、16、32、64…2的n次方个扇区。</p>
<h3 id="_8">块与页的关系<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h3>
<p>操作系统经常与内存和硬盘这两种存储设备进行通信，类似于“块”的概念，都需要一种虚拟的基本单位。所以，<strong>与内存操作，是虚拟一个页的概念来作为最小单位。与硬盘打交道，就是以块为最小单位。</strong>  </p>
<h2 id="flash_1">Flash 中的扇区、页、块<a class="headerlink" href="#flash_1" title="Permanent link">&para;</a></h2>
<p>Flash 使用了磁盘技术中的扇区、页、块这些概念，只是不同的厂商所定义的扇区、页、块，可能大小并不一样。以下举例说明。</p>
<ul>
<li>
<p>MM32F5370。Flash每页大小为1k字节。<br />
<img alt="alt text" src="../image-3.png" />  </p>
</li>
<li>
<p>S29GL-P MirrorBit® Flash Family。每个扇区128k字节。<br />
<img alt="alt text" src="../image-4.png" /><br />
<strong>提供16字节的页读buffer</strong><br />
<img alt="alt text" src="../image-8.png" /></p>
</li>
<li>
<p>K9F1G08U0E。每页128k字节，每块64页，设备共1024个块。<br />
<img alt="alt text" src="../image-5.png" /></p>
</li>
<li>
<p>W25Q16JV。每个扇区4k字节，每个块16个扇区，设备共32块。<br />
<img alt="alt text" src="../image-6.png" /><br />
<strong>每页256字节</strong><br />
<img alt="alt text" src="../image-7.png" /></p>
</li>
</ul>
<h2 id="mm32-flash_1">MM32 Flash 构成<a class="headerlink" href="#mm32-flash_1" title="Permanent link">&para;</a></h2>
<p>Flash由主存储块以及信息存储块组成。信息存储器可以分为保密空间、Data 空间、系统储存器ISP、选项字节。信息存储块中，除了“系统存储器ISP”区域出厂锁定，用户不可写入外，其余部分在一定条件下可以进行读写操作。<br />
每个系列的闪存实际大小有差异，部分区域大小划分、部分寄存器也存在差异，具体系列的闪存构成和寄存器信息，需查看对应的UM文档。UM中“嵌入式闪存”章节的“闪存构成与说明”小节有专门描述。<br />
以MM32F5370为例，列出Flash各部分的详细组织结构。<br />
<img alt="alt text" src="../image-9.png" />
<img alt="alt text" src="../image-10.png" />
<img alt="alt text" src="../image-11.png" />
<img alt="alt text" src="../image-12.png" /></p>
<h2 id="mm32-flash_2">MM32 Flash 基本操作<a class="headerlink" href="#mm32-flash_2" title="Permanent link">&para;</a></h2>
<h3 id="_9">解锁<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<p>复位后，Flash存储器默认是被保护的状态。FLASH_CR寄存器不允许被改写。若要开启对FLASH_CR寄存器的访问权限，则需要执行特定的序列。主要从闪存块和选项字节两部分进行说明。所有系列的解锁序列保持不变。</p>
<h4 id="_10">对闪存块操作限制的解除与使能<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h4>
<p>先后向FLASH_KEYR寄存器写入0x45670123和0xCDEF89AB。序列正确写入之后，FLASH_CR的LCOK为置0，然后就能对FLASH_CR进行访问。  </p>
<p>解除保护操作代码：
<div class="highlight"><pre><span></span><code>#define  FLASH_KEY1    ((unsigned int)0x45670123)
#define  FLASH_KEY2    ((unsigned int)0xCDEF89AB)

void FLASH_Unlock()
{
    FLASH-&gt;KEYR = FLASH_KEY1;
    FLASH-&gt;KEYR = FLASH_KEY2;
}
</code></pre></div></p>
<p>不符合上述顺序的操作与写入错误的值，将会锁死 FLASH_CR ，并引发一个总线错误，直至下次 复位。</p>
<p>使能保护操作代码：
<div class="highlight"><pre><span></span><code>#define  FLASH_CR_LOCK_Pos     (7)
#define  FLASH_CR_LOCK         (0x01U &lt;&lt; FLASH_CR_LOCK_Pos)

void FLASH_Lock(void)
{
    FLASH-&gt;CR |= FLASH_CR_LOCK;
}
</code></pre></div></p>
<h4 id="_11">对选项字节区块操作限制的解除和使能<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h4>
<p>闪存控制器在复位后，它的选项字节信息块默认是处于写保护的，并且任何时候都是可读的。同样是为了避免对选项字节信息块做块擦除和写值等破坏性操作，复位后， FLASH_CR 寄存器进入锁定状态，FLASH_CR 的 LOCK 位被控制器模块置为 1，而 OPTWRE 位被控制器模块清为 0；因此需先后向FLASH_KEYR 寄存器写入 0x45670123 和 0xCDEF89AB 做解锁闪存操作， FLASH_CR 的 LOCK 位清为 0 后，才做选项字节信息块的解锁。通过向 FLASH_OPTKEYR 寄存器先后写入 0x45670123 和 0xCDEF89AB ，从而使硬件将 FLASH_CR 寄存器的 OPTWRE 位置 1，才能对选项字节信息块执行块擦除，连续编程操作。可将 FLASH_CR 寄存器的 OPTWRE 位清为 0，从而禁止对选项字节信息块执行块擦除，连续编程操作。选项字节信息块包含选项字节区和分块保护配置区，每次只能擦除一块区域。</p>
<p>解除保护操作代码：
<div class="highlight"><pre><span></span><code>#define  FLASH_KEY1    ((unsigned int)0x45670123)
#define  FLASH_KEY2    ((unsigned int)0xCDEF89AB)

void FLASH_Unlock()
{
    FLASH-&gt;KEYR = FLASH_KEY1;
    FLASH-&gt;KEYR = FLASH_KEY2;
}

void FLASH_OPT_Unlock()
{
    FLASH-&gt;OPTKEYR = FLASH_KEY1;
    FLASH-&gt;OPTKEYR = FLASH_KEY2;
}
</code></pre></div></p>
<p>使能保护操作代码：
<div class="highlight"><pre><span></span><code>#define  FLASH_CR_OPTWRE_Pos      (9)
#define  FLASH_CR_OPTWRE          (0x01U &lt;&lt; FLASH_CR_OPTWRE_Pos)

void FLASH_OPT_Lock(void)
{
    FLASH-&gt;CR &amp;= ~FLASH_CR_OPTWRE;
}
</code></pre></div></p>
<h4 id="_12">对分块保护区擦除限制的解除与使能<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h4>
<p>如果配置了分块保护区，闪存控制器复位后，此区域默认是处于擦除保护，这样是为了避免对此区域做误擦除等破坏性操作。复位后， FLASH_CR 寄存器进入锁定状态， FLASH_CR 的 LOCK 位被控制器模块置为 1，而 BPTERE 位被控制器模块清为 0；因此需先后向 FLASH_KEYR 寄存器写入0x45670123 和 0xCDEF89AB 做解锁闪存操作， FLASH_CR 的 LOCK 位清为 0 后，才做分块保护区擦除的解锁。通过向 FLASH_BPTKEYR 寄存器先后写入 0x45670123 和 0xCDEF89AB ，从而使硬件将 FLASH_CR 寄存器的 BPTERE 位置 1，才能对分块保护区执行页擦除操作（整块区域全擦）。可将FLASH_CR 寄存器的 BPTERE 位清为 0，从而禁止对分块保护区执行擦除操作。</p>
<p>解除保护操作代码：
<div class="highlight"><pre><span></span><code>#define  FLASH_KEY1     ((unsigned int)0x45670123)
#define  FLASH_KEY2     ((unsigned int)0xCDEF89AB)

void FLASH_Unlock(void)
{
    FLASH-&gt;KEYR = FLASH_KEY1;
    FLASH-&gt;KEYR = FLASH_KEY2;
}

void FLASH_BPT_Unlock (void)
{
    FLASH-&gt;BPTKEYR = FLASH_KEY1;
    FLASH-&gt;BPTKEYR = FLASH_KEY2;
}
</code></pre></div></p>
<p>对分块保护区擦除保护使能操作代码：
<div class="highlight"><pre><span></span><code>#define  FLASH_CR_BPTERE_Pos     (8)
#define  FLASH_CR_BPTERE         (0x01U &lt;&lt; FLASH_CR_BPTERE_Pos)

void FLASH_BPT_Lock(void)
{
    FLASH-&gt;CR &amp;= ~FLASH_CR_BPTERE;
}
</code></pre></div></p>
<h3 id="_13">擦除<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h3>
<h4 id="_14">主闪存块擦除<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h4>
<p>闪存控制器支持整片擦除主闪存块和以页为单位擦除主闪存中的页。 <br />
整片擦除功能将初始化主闪存块的所有内容，使所有的值为 0xFFFF ，但信息存储块不会受这个命令影响。 <br />
当含有分块保护区域时执行全芯片擦除将会被忽略。 </p>
<p>整片擦除操作的寄存器设置，具体步骤如下：   </p>
<ol>
<li>读 FLASH_CR 的 LOCK 位，确保解除闪存保护</li>
<li>否则执行 Flash Unlock</li>
<li>设置 FLASH_CR 寄存器中的 MER位为 1，使能对主闪存全片擦除功能</li>
<li>设置 FLASH_CR 寄存器中的 STRT 位为 1</li>
<li>开始对主闪存全擦除</li>
<li>检查 FLASH_SR 中的 BSY 位</li>
<li>等待对主闪存全擦除的操作完成</li>
<li>清除 FLASH_CR 寄存器中的 MER位，使该位为 0</li>
<li>可选做 Blank 检查，以确保擦除成功  </li>
</ol>
<p>页擦除操作的寄存器设置，具体步骤如下：</p>
<ol>
<li>读 FLASH_CR 的 LOCK 位，确保解除闪存保护，否则执行 Flash Unlock</li>
<li>设置 FLASH_CR 寄存器中的 PER 位为1，使能页擦除功能</li>
<li>将待擦除页基地址写入 FLASH_AR 寄存器</li>
<li>设置 FLASH_CR 寄存器中的 STRT 位为1，开始页擦除</li>
<li>检查 FLASH_SR 中的 BSY 位</li>
<li>等待页擦除的操作完成</li>
<li>清除 FLASH_CR 寄存器中的 PER 位，使该位为 0</li>
<li>可选对这一页的内容做检查，以确保页擦除成功</li>
<li>连续多页擦除，可以重复 2~7 操作；直到完成所有页面擦除</li>
</ol>
<p><strong>！！！注意页擦除中，页的大小是否为512字节，一般为1024字节。</strong></p>
<h4 id="_15">选项字节区擦除<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h4>
<p>擦除操作的寄存器设置，具体步骤如下：</p>
<ol>
<li>读 FLASH_CR 的 LOCK 位，确保解除闪存保护，否则执行 FlashUnlock</li>
<li>读 FLASH_CR 的 OPTWRE 位，确保解除选项区块保护，否则执行选项区块 Unlock</li>
<li>把待擦除区块基地址写入FLASH_AR 寄存器</li>
<li>设置 FLASH_CR 寄存器中的OPTER 位为 1，使能选项字节信息块擦除功能</li>
<li>设置 FLASH_CR 寄存器中的STRT 位为 1</li>
<li>检查 FLASH_SR 中的 BSY 位</li>
<li>等待选项字节块擦除操作完成</li>
<li>清除 FLASH_CR 寄存器中的OPTER 位，设置值为 0</li>
<li>可选对这一区块的内容做检查，以确保对该区块擦除成功</li>
<li>连续多块擦除，可以重复 3~8 操作；直到完成所有选项信息块擦除</li>
</ol>
<h4 id="data">Data空间擦除<a class="headerlink" href="#data" title="Permanent link">&para;</a></h4>
<p>擦除操作的寄存器设置，具体步骤如下：</p>
<ol>
<li>读 FLASH_CR 的 LOCK 位，确保解除 Flash 保护，否则执行 Flash Unlock</li>
<li>读 FLASH_CR 的 OPTWRE 位，确保解除选项区块保护，否则执行选项区块 Unlock</li>
<li>把待擦除Data区块基地址写入 FLASH_AR 寄存器</li>
<li>设置 FLASH_CR 寄存器中的 OPTER 位为 1，使能选项字节块擦除功能</li>
<li>设置 FLASH_CR 寄存器中的 STRT 位为 1</li>
<li>检查 FLASH_SR 中 BSY 位</li>
<li>等待 Data 区块擦除操作完成</li>
<li>清除 FLASH_CR 寄存器中的 OPTER 位，设置值为0</li>
<li>可选对这一区块的内容做检查，以确保对该区块擦除成功</li>
<li>连续多块擦除，可以重复 3~8 操作；直到完成所有选项区块擦除</li>
</ol>
<p><strong>！！！有的系列，如SPIN0230, 在芯片全擦除时，也会擦除此空间的数据。</strong></p>
<h3 id="_16">编程<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h3>
<h4 id="_17">主闪存块编程<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h4>
<p>不同系列的编程有所差异，请按照对应 UM 进行编程。<br />
主闪存控制器会预读待编程半字或是否为全 1（即是否为 0xFFFF或0xFFFFFFFF），如果不是，这次编程操作会自动取消，并且在 FLASH_SR 寄存器的 PGERR 位上提示编程错误警告。 <br />
如果待编程地址所对应的写保护块在 FLASH_WRPR 中的写保护位有效，同样也不会有编程动作， 同样也会产生编程错误警告，编程动作结束后，FLASH_SR 寄存器中得 EOP 位会给出提示。 因此在编程前需先解除写保护。<br />
注意：当 CPU 进入省电模式时，通过 SWD 接口，对闪存操作将产生错误。避免在主闪存中运行中断程序时进行擦除或编程操作。</p>
<p>A. 主闪存只支持以16位为半字编程 <br />
若以其他位进行编程，则会引起硬件错误中断。当FLASH_CR的PG位为1时，直接对相应的地址写一个半字，就是一次编程。<br />
主闪存块编程操作的寄存器设置，具体步骤如下：  </p>
<ol>
<li>读 FLASH_CR 的 LOCK 位，确保解除 Flash 保护，否则执行 Flash Unlock</li>
<li>设置 FLASH_CR 寄存器中的 PG 位为1，使能半字编程功能</li>
<li>以半字为单位向目标地址写入数据，目标地址需以半字对齐</li>
<li>检查 FLASH_SR 中的 BSY 位</li>
<li>等待半字编程操作完成</li>
<li>清除 FLASH_CR 寄存器中的 PG 位，使该位为 0</li>
<li>可选读目标地址数据，以确保半字编程成功</li>
<li>连续多个半字编程，可以重复 2~6 操作；直到完成所有目标地址的半字编</li>
</ol>
<p>B. 主闪存仅支持以64位编程 <br />
当支持ECC，且ECC开启时，主闪存仅支持以64位编程，64位编程分4次16位半字编程实现、第一次16位半字编程地址必须是64位对齐，其余三次16为半字编程地址必须是在前一次16位半字编程地址基础上加2，用来修改主闪存块内容。如果以32位或8位编程将引起硬件错误中断。当FLASH_CR的PG位为1时，直接对相应的地址写一个半字，就是一次编程。
主闪存块编程操作的寄存器设置，具体步骤如下：  </p>
<ol>
<li>读 FLASH_CR 的 LOCK 位，确保解除 Flash 保护，否则执行 Flash Unlock</li>
<li>设置FLASH_CR寄存器中的 PG 位为 1</li>
<li>以半字为单位向目标地址写入数据，目标地址需以 64 位对齐</li>
<li>以半字为单位向目标地址+2 写入数据</li>
<li>以半字为单位向目标地址+4 写入数据</li>
<li>以半字为单位向目标地址+6 写入数据</li>
<li>检查 FLASH_SR 中的 BSY 位</li>
<li>等待编程操作完成</li>
<li>清除 FLASH_CR 寄存器中的 PG 位，使该位为 0</li>
<li>可选读目标地址数据，以确保编程成功</li>
<li>连续多个编程，可以重复 2~9 操作</li>
</ol>
<p>C. 闪存支持连续编程<br />
通过设置FLASH_CR.PGMD[2:0]为 1/ 2/ 3，主闪存支持以32/64/128为编程。32/64/128位编程分2/4/8次16为半字编程实现，第一次编程地址必须是32/64/128位对齐，其余1/ 3/ 7次16位半字编程地址必须在前一次16位半字编程地址基础上加2用来修改主存储闪存块内容。如果以 32 位整字的长度编程，将引起硬件错误中断。<br />
当支持ECC功能且 FLASH ECC 开启时，FLASH_CR.PGMD[2：0]只能设定为 &#8532;，否则将产生 非法编程操作，FLASH_SR.BSTERR 将被置 1。    <br />
当 FLASH_CR 中的 PG 位为 1 时，直接对相应的地址写 1/ 2/ 4/ 8 个半字（16/32/64/128 位），就是一次编程操作。 连续 16 位半字编程的次数可以通过读取 FLASH_PGCNT 的值来确认（PGMD 设定值较大时此操作可以避免次数的混乱，此功能部分系列支持，需查看具体UM的FLASH具体的寄存器说明）。<br />
FLASH_CR.PGMD[2：0]=2 时，主闪存块编程操作的寄存器设置，具体步骤如下：  </p>
<ol>
<li>读 FLASH_CR 的 LOCK 位，确保解除闪存保护，否则执行 Flash Unlock</li>
<li>设置 FLASH_CR 寄存器中的 PGMD位为 2， PG 位为 1</li>
<li>以半字为单位向目标地址写入数据，目标地址需以 64 位对齐</li>
<li>以半字为单位向目标地址+2 写入数据</li>
<li>以半字为单位向目标地址+4 写入数据</li>
<li>以半字为单位向目标地址+6 写入数据</li>
<li>检查 FLASH_SR 中的 BSY 位</li>
<li>等待编程操作完成</li>
<li>清除 FLASH_CR 寄存器中的 PG位，使该位为 0</li>
<li>可选读目标地址数据，以确保编程成功</li>
<li>连续多个编程，可以重复 2~9 操作</li>
</ol>
<h4 id="_18">选项字节区编程<a class="headerlink" href="#_18" title="Permanent link">&para;</a></h4>
<p>选项字节信息块的编程与主闪存块地址的编程不同，因其写入值复位后加载到配置选项，需要更加严格的保护。解除对闪存控制器的访问限制后，还需要对选项字节信息块解除访问限制。完成该操作后，FLASH_CR 寄存器中的 OPTWRE 位会被置 1，才能允许后续的编程操作。<br />
其中选项字节区内有效数据为低 8 位，而高 8 位为低 8 位的反码，从而组成为 16 位数据。在编程过程中，软件将高 8 位设置为低 8 位的反码，保证选项字节的写入值总是对的，然后依次写入 16 位数据。
当选项字节被改变时，需要系统上电复位使之生效。  </p>
<p>A. 16位编程  </p>
<ol>
<li>读 FLASH_CR 的 LOCK 位，确保解除 Flash 保护，否则执行 Flash Unlock</li>
<li>读 FLASH_CR 的 OPTWER位，确保解除选项字节信息块保护，否则执行 选项字节信息块Unlock</li>
<li>设置 FLASH_CR 寄存器中的 OPTPG 位为1，使能半字编程功能</li>
<li>以半字为单位向目标地址写入数据，目标地址需以半字对齐</li>
<li>检查 FLASH_SR 中的 BSY 位</li>
<li>等待半字编程操作完成</li>
<li>清除FLASH_CR寄存器OPTPG 位，使该位为 0</li>
<li>可选读目标地址数据，以确保半字编程成功</li>
<li>连续多个半字编程，可以重复 3~7 操作；直到完成所有目标地址的半字编程</li>
</ol>
<p>B. 64位编程<br />
当支持ECC，且ECC开启时，仅支持64位编程。</p>
<ol>
<li>读 FLASH_CR 的 LOCK 位，确保解除Flash 保护，否则执行 Flash Unlock</li>
<li>读 FLASH_CR 的 OPTWER位，确保解除选项字节信息块保护，否则执行 选项字节信息块Unlock</li>
<li>设置FLASH_CR寄存器中的 OPTPG 位为 1</li>
<li>以半字为单位向目标地址写入数据，目标地址需以 64 位对齐</li>
<li>以半字为单位向目标地址+2 写入数据</li>
<li>以半字为单位向目标地址+4 写入数据</li>
<li>以半字为单位向目标地址+6 写入数据</li>
<li>检查 FLASH_SR 中的 BSY 位</li>
<li>等待编程操作完成</li>
<li>清除 FLASH_CR 寄存器中的 OPTPG 位，使该位为 0</li>
<li>可选读目标地址数据，以确保编程成功</li>
<li>连续多个编程，可以重复 3~10 操作</li>
</ol>
<p>C. 连续编程<br />
原理同主闪存块编程。步骤根据情况与本节2种方式一致。</p>
<h4 id="data_1">Data空间编程<a class="headerlink" href="#data_1" title="Permanent link">&para;</a></h4>
<p>Data空间编程与主闪存块地址的编程不同，需要按照选项字节的方式进行编程。解除对闪存控制器的访问限制后，还需要对选项字节信息块解除访问限制。完成该操作后，FLASH_CR 寄存器中的 OPTWRE 位会被置 1，才能允许后续的编程操作。</p>
<h3 id="flash_2">读 Flash<a class="headerlink" href="#flash_2" title="Permanent link">&para;</a></h3>
<p>按闪存访问控制寄存器（FLASH_ACR）中的设定的方式，闪存通过 AHB 总线执行取指令或取数据。结合 AHB 时钟，设定相应的访问时延（Latency），使能预取缓冲区后，可提高 CPU 的取指令速度，从而提高 CPU 的运行速度。访问时延（Latency）在 SYSCLK 低于等于 24MHz，可以设定为 0，此后每增加24MHz，需要增加一个时延。<br />
上电复位后，闪存控制器默认设定预取缓冲区是打开的。如需要关闭或重新打开预取缓冲功能，必须设定 SYSCLK 低于 24MHz，并且 AHB 时钟没有经过任何分频的条件下（SYSCLK 必须等于 HCLK）才可以关闭或重新打开预取缓冲功能。<br />
为了保护对闪存的正确读取，必须在闪存访问控制寄存器中的 LATENCY[2： 0] 中指定预取控制器的速度比，这个数值等于每次访问闪存后到下次访问之间所需插入的等待周期的个数。复位后，这个值默认为零，也就是没有插入等待周期的状态，相应的系统时钟也复位为使用内置时钟 HSI=8MHz。复位后如果需要修改系统时钟，必须先配置好安全的 LATENCY[2： 0] 值，而当 AHB 时钟的预分频器大于 1 时，预取缓冲区也需设定相应的访问时延（Latency）。<br />
<img alt="alt text" src="../image-13.png" />  </p>
<h3 id="_19">闪存保护<a class="headerlink" href="#_19" title="Permanent link">&para;</a></h3>
<p>主闪存块使能读写保护可以防范主闪存块的代码被不可信的代码读出，也可以防范在程序跑飞的时候对主闪存块的意外擦除与编程。使能读保护的范围是整个主闪存块，而使能写保护的最小单位是一个写保护块（即 4 页）。</p>
<h4 id="_20">读保护<a class="headerlink" href="#_20" title="Permanent link">&para;</a></h4>
<p>主闪存块使能或解除读保护是通过从内置 SRAM 或 ICP、 ISP 方式设置 RDP 半字，然后系统重新上电复位，加载了新的 RDPs 后起作用。设置读保护，需要执行一次上电复位，而不是系统复位，才能起作用。  </p>
<p>使能读保护：  </p>
<p>按选项字节区半字编程的操作方式，按顺序写 RDP 半字到对应地址。  </p>
<ol>
<li>设置 FLASH AR 地址值为 0x1FFFF800，执行该选项字节区擦除。  </li>
<li>按选项字节区半字编程的操作方式，按顺序写 0x807F 半字到对应地址。  </li>
<li>进行上电复位以重新加载选项字节，此时读保护被使能。  </li>
</ol>
<p>当读保护半字被写入相应的值以后：  </p>
<ol>
<li>只允许从用户代码执行对主闪存存储器的读操作（以非调试方式从主闪存存储器启动）。</li>
<li>读保护后，调试模式下（SRAM boot 和 debug 模式）禁止对闪存进行操作。</li>
<li>MCU 可以通过在主闪存存储器中执行的代码进行编程（实现 IAP 或数据存储等功能），但不允许在调试模式下或从内部 SRAM 启动后执行主闪存块写或页擦除操作（整片擦除除外）。</li>
<li>所有通过 SWD 向内置 SRAM 装载代码并执行代码的功能依然有效，亦可以通过 SWD 从内置SRAM 启动，这个功能可以用来解除读保护。</li>
<li>通过从内置 SRAM 执行代码访问主闪存存储器的操作，通过 DMA、 SWD（串行线调试）对闪存的访问都将被禁止。</li>
</ol>
<p>解除读保护：</p>
<p>从内置 SRAM 或 ICP 方式解除读保护的过程是：</p>
<ol>
<li>设置 FLASH_AR 地址值为 0x1FFFF800，执行该选项字节区擦除。</li>
<li>按选项字节区半字编程的操作方式，按流程写 0x5AA5 半字到对应地址。</li>
<li>进行上电复位以重新加载选项字节，此时读保护被解除。</li>
</ol>
<p>注意：</p>
<ol>
<li>如选项字节区对应的地址值为非 0xFFFF，需先执行擦除选项字节区的动作，执行擦除选项字节区的动作不会导致自动的整片擦除操作，不会改变读保护状态。 </li>
<li>写 0x5AA5 半字到对应地址 0x1FFFF800 时，闪存控制器会自动执行整片擦除。</li>
</ol>
<h4 id="_21">写保护<a class="headerlink" href="#_21" title="Permanent link">&para;</a></h4>
<p>使能写保护：</p>
<p>写保护通过设置选项字节区中的 WRP0~WRP15 中的 WRP 位为 0，来设置写保护，系统复位后将加载新选项字节，使能写保护。如果试图写入或擦除一个受写保护的页，会引起 FLASH_SR 中的WRPRTERR 标志位置位。</p>
<p>解除写保护：</p>
<p>解除写保护有下述 2 种情形： </p>
<p>情形 1：解除写保护，同时解除读保护：  </p>
<ol>
<li>使用闪存控制寄存器（FLASH_CR）的 OPTER 位擦除选项字节区；写 0x5AA5 半字到对应地
址 0x1FFFF800（根据 BPRT_RDP，主闪存被选择执行自动全片擦除）；</li>
<li>进行系统复位，重装载选项字节（包含新的 WRP 字节），写保护被解除。  </li>
</ol>
<p>使用这种方法，将解除全片主闪存模块的写保护同时擦除全片主闪存块。</p>
<p>情形 2：解除写保护，同时保持读保护有效，这种情况常见于用户自己实现在程序中编程的启动
程序中：</p>
<ol>
<li>使用闪存控制寄存器（FLASH_CR）的 OPTER 位擦除选项字节区；</li>
<li>进行系统复位，重装载选项字节（包含新的 WRP 字节），写保护被解除。  </li>
</ol>
<p>使用这种方法，将解除整个主闪存模块的写保护，同时保持读保护有效。</p>
<h3 id="mm32-flash_3">MM32 Flash 寄存器概览<a class="headerlink" href="#mm32-flash_3" title="Permanent link">&para;</a></h3>
<p>以 MM32F5370 为例：<br />
<img alt="alt text" src="../image-14.png" /></p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 ZhangBinbin/All Rights Reserved.
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://iamzhangbinbin.github.io/" target="_blank" rel="noopener" title="Wechat" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M385.2 167.6c6.4 0 12.6.3 18.8 1.1C387.4 90.3 303.3 32 207.7 32 100.5 32 13 104.8 13 197.4c0 53.4 29.3 97.5 77.9 131.6l-19.3 58.6 68-34.1c24.4 4.8 43.8 9.7 68.2 9.7 6.2 0 12.1-.3 18.3-.8-4-12.9-6.2-26.6-6.2-40.8-.1-84.9 72.9-154 165.3-154m-104.5-52.9c14.5 0 24.2 9.7 24.2 24.4 0 14.5-9.7 24.2-24.2 24.2-14.8 0-29.3-9.7-29.3-24.2.1-14.7 14.6-24.4 29.3-24.4m-136.4 48.6c-14.5 0-29.3-9.7-29.3-24.2 0-14.8 14.8-24.4 29.3-24.4 14.8 0 24.4 9.7 24.4 24.4 0 14.6-9.6 24.2-24.4 24.2M563 319.4c0-77.9-77.9-141.3-165.4-141.3-92.7 0-165.4 63.4-165.4 141.3S305 460.7 397.6 460.7c19.3 0 38.9-5.1 58.6-9.9l53.4 29.3-14.8-48.6C534 402.1 563 363.2 563 319.4m-219.1-24.5c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.8 0 24.4 9.7 24.4 19.3 0 10-9.7 19.6-24.4 19.6m107.1 0c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.5 0 24.4 9.7 24.4 19.3.1 10-9.9 19.6-24.4 19.6"/></svg>
    </a>
  
    
    
    
    
    <a href="https://iamzhangbinbin.github.io/" target="_blank" rel="noopener" title="telegram" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M248 8C111.033 8 0 119.033 0 256s111.033 248 248 248 248-111.033 248-248S384.967 8 248 8m114.952 168.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.45 10.45 0 0 1 3.53 6.716 43.8 43.8 0 0 1 .417 9.769"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://iamzhangbinbin.github.io/" target="_blank" rel="noopener" title="iamzhangbinbin.github.io" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8l164.9-188.5L26.8 48h145.6l100.5 132.9zm-24.8 373.8h39.1L151.1 88h-42z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://iamzhangbinbin.github.io/" target="_blank" rel="noopener" title="iamzhangbinbin.github.io" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:<z466302@126.com>" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M64 112c-8.8 0-16 7.2-16 16v22.1l172.5 141.6c20.7 17 50.4 17 71.1 0L464 150.1V128c0-8.8-7.2-16-16-16zM48 212.2V384c0 8.8 7.2 16 16 16h384c8.8 0 16-7.2 16-16V212.2L322 328.8c-38.4 31.5-93.7 31.5-132 0zM0 128c0-35.3 28.7-64 64-64h384c35.3 0 64 28.7 64 64v256c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://iamzhangbinbin.github.io/" target="_blank" rel="noopener" title="iamzhangbinbin.github.io" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M488.6 104.1c16.7 18.1 24.4 39.7 23.3 65.7v202.4c-.4 26.4-9.2 48.1-26.5 65.1-17.2 17-39.1 25.9-65.5 26.7H92.02c-26.45-.8-48.21-9.8-65.28-27.2C9.682 419.4.767 396.5 0 368.2V169.8c.767-26 9.682-47.6 26.74-65.7C43.81 87.75 65.57 78.77 92.02 78h29.38L96.05 52.19c-5.75-5.73-8.63-13-8.63-21.79 0-8.8 2.88-16.06 8.63-21.797C101.8 2.868 109.1 0 117.9 0q13.2 0 21.9 8.603L213.1 78h88l74.5-69.397C381.7 2.868 389.2 0 398 0q13.2 0 21.9 8.603c5.7 5.737 8.6 12.997 8.6 21.797 0 8.79-2.9 16.06-8.6 21.79L394.6 78h29.3c26.4.77 48 9.75 64.7 26.1m-38.8 69.7c-.4-9.6-3.7-17.4-10.7-23.5-5.2-6.1-14-9.4-22.7-9.8H96.05c-9.59.4-17.45 3.7-23.58 9.8-6.14 6.1-9.4 13.9-9.78 23.5v194.4c0 9.2 3.26 17 9.78 23.5s14.38 9.8 23.58 9.8H416.4c9.2 0 17-3.3 23.3-9.8s9.7-14.3 10.1-23.5zm-264.3 42.7c6.3 6.3 9.7 14.1 10.1 23.2V273c-.4 9.2-3.7 16.9-9.8 23.2-6.2 6.3-14 9.5-23.6 9.5s-17.5-3.2-23.6-9.5-9.4-14-9.8-23.2v-33.3c.4-9.1 3.8-16.9 10.1-23.2s13.2-9.6 23.3-10c9.2.4 17 3.7 23.3 10m191.5 0c6.3 6.3 9.7 14.1 10.1 23.2V273c-.4 9.2-3.7 16.9-9.8 23.2s-14 9.5-23.6 9.5-17.4-3.2-23.6-9.5c-7-6.3-9.4-14-9.7-23.2v-33.3c.3-9.1 3.7-16.9 10-23.2s14.1-9.6 23.3-10c9.2.4 17 3.7 23.3 10"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.instant", "navigation.instant.progress", "navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.expand", "navigation.prune", "navigation.indexes", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "search.share", "header.autohide", "announce.dismiss", "content.code.copy", "content.code.annotate", "content.tabs.link", "content.tooltips"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>