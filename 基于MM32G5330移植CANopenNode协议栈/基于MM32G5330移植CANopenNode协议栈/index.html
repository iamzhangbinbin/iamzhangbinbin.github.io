
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="张彬彬的个人技术博客">
      
      
        <meta name="author" content="张彬彬">
      
      
        <link rel="canonical" href="https://iamzhangbinbin.github.io/%E5%9F%BA%E4%BA%8EMM32G5330%E7%A7%BB%E6%A4%8DCANopenNode%E5%8D%8F%E8%AE%AE%E6%A0%88/%E5%9F%BA%E4%BA%8EMM32G5330%E7%A7%BB%E6%A4%8DCANopenNode%E5%8D%8F%E8%AE%AE%E6%A0%88/">
      
      
        <link rel="prev" href="../../%E5%9F%BA%E4%BA%8EMini-F5277-OB%E7%A7%BB%E6%A4%8DTinyUSB%E5%8D%8F%E8%AE%AE%E6%A0%88/%E5%9F%BA%E4%BA%8EMini-F5277-OB%E7%A7%BB%E6%A4%8DTinyUSB%E5%8D%8F%E8%AE%AE%E6%A0%88/">
      
      
        <link rel="next" href="../../LwIP%E7%A7%BB%E6%A4%8D%E7%AC%94%E8%AE%B0/LwIP%E7%A7%BB%E6%A4%8D%E7%AC%94%E8%AE%B0/">
      
      
      <link rel="icon" href="../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>CANopenNode - 张彬彬的杂货铺</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config",""),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#canopennode-mm32g5330" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="张彬彬的杂货铺" class="md-header__button md-logo" aria-label="张彬彬的杂货铺" data-md-component="logo">
      
  <img src="../../img/zahuopu.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            张彬彬的杂货铺
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              CANopenNode
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="indigo"  aria-label="切换至夜间模式"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="切换至夜间模式" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="切换至日间模式"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="切换至日间模式" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="分享" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/iamzhangbinbin/iamzhangbinbin.github.io" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    I'mZhangBinbin
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../MCU%E5%BC%80%E5%8F%91%E6%94%AF%E6%8C%81/%E5%88%B6%E4%BD%9Ckeil%20pack%E5%AE%89%E8%A3%85%E5%8C%85/%E5%88%B6%E4%BD%9Ckeil%20pack%E5%AE%89%E8%A3%85%E5%8C%85/" class="md-tabs__link">
          
  
  
    
  
  MCU开发支持

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../MM32%20Guide/MM32%20Flash/MM32%20Flash/" class="md-tabs__link">
          
  
  
    
  
  MM32 Guide

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Python%E7%AC%94%E8%AE%B0/SXT%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0/SXT%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0/" class="md-tabs__link">
          
  
  
    
  
  Python笔记

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../芯片勘误表4.md" class="md-tabs__link">
        
  
  
    
  
  ClassB入门

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../%E5%9F%BA%E4%BA%8EMini-F5277-OB%E7%A7%BB%E6%A4%8DTinyUSB%E5%8D%8F%E8%AE%AE%E6%A0%88/%E5%9F%BA%E4%BA%8EMini-F5277-OB%E7%A7%BB%E6%A4%8DTinyUSB%E5%8D%8F%E8%AE%AE%E6%A0%88/" class="md-tabs__link">
          
  
  
    
  
  USB入门

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
  
    
  
  CAN入门

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../LwIP%E7%A7%BB%E6%A4%8D%E7%AC%94%E8%AE%B0/LwIP%E7%A7%BB%E6%A4%8D%E7%AC%94%E8%AE%B0/" class="md-tabs__link">
          
  
  
    
  
  ENET入门

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../blog/" class="md-tabs__link">
          
  
  
    
  
  博客

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../.." class="md-tabs__link">
          
  
  
    
  
  About

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="张彬彬的杂货铺" class="md-nav__button md-logo" aria-label="张彬彬的杂货铺" data-md-component="logo">
      
  <img src="../../img/zahuopu.png" alt="logo">

    </a>
    张彬彬的杂货铺
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/iamzhangbinbin/iamzhangbinbin.github.io" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    I'mZhangBinbin
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    MCU开发支持
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            MCU开发支持
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MCU%E5%BC%80%E5%8F%91%E6%94%AF%E6%8C%81/%E5%88%B6%E4%BD%9Ckeil%20pack%E5%AE%89%E8%A3%85%E5%8C%85/%E5%88%B6%E4%BD%9Ckeil%20pack%E5%AE%89%E8%A3%85%E5%8C%85/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    制作keil pack安装包
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MCU%E5%BC%80%E5%8F%91%E6%94%AF%E6%8C%81/%E5%88%B6%E4%BD%9Ckeil%E7%BC%96%E7%A8%8B%E7%AE%97%E6%B3%95%E6%96%87%E4%BB%B6/%E5%88%B6%E4%BD%9Ckeil%E7%BC%96%E7%A8%8B%E7%AE%97%E6%B3%95%E6%96%87%E4%BB%B6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    制作keil编程算法文件
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    MM32 Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            MM32 Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MM32%20Guide/MM32%20Flash/MM32%20Flash/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MM32 Flash
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MM32%20Guide/MM32%20ADC/MM32%20ADC/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MM32 ADC
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MM32%20Guide/MM32%20MDPWM/MM32%20MDPWM/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MM32 MDPWM
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Python笔记
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Python笔记
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Python%E7%AC%94%E8%AE%B0/SXT%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0/SXT%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SXT课堂笔记
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../芯片勘误表4.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ClassB入门
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    USB入门
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            USB入门
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%9F%BA%E4%BA%8EMini-F5277-OB%E7%A7%BB%E6%A4%8DTinyUSB%E5%8D%8F%E8%AE%AE%E6%A0%88/%E5%9F%BA%E4%BA%8EMini-F5277-OB%E7%A7%BB%E6%A4%8DTinyUSB%E5%8D%8F%E8%AE%AE%E6%A0%88/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    TinyUSB
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    CAN入门
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            CAN入门
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    CANopenNode
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    CANopenNode
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      引言
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canopen" class="md-nav__link">
    <span class="md-ellipsis">
      CANopen概述
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CANopen概述">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#canopen_1" class="md-nav__link">
    <span class="md-ellipsis">
      CANopen 的诞生和作用
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#canopencob-id" class="md-nav__link">
    <span class="md-ellipsis">
      CANopen的COB-ID
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#canopen7" class="md-nav__link">
    <span class="md-ellipsis">
      CANopen的7种报文类型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odobject-dictionary" class="md-nav__link">
    <span class="md-ellipsis">
      OD(Object Dictionary，对象字典)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#canopen_2" class="md-nav__link">
    <span class="md-ellipsis">
      CANopen主站和从站
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#canopen_3" class="md-nav__link">
    <span class="md-ellipsis">
      CANopen网络组建
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nmt" class="md-nav__link">
    <span class="md-ellipsis">
      NMT网络管理
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canopennode" class="md-nav__link">
    <span class="md-ellipsis">
      CANopenNode简介
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CANopenNode简介">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#canopennode-vs-can-festival" class="md-nav__link">
    <span class="md-ellipsis">
      CANopenNode vs CAN Festival
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#canopennode_1" class="md-nav__link">
    <span class="md-ellipsis">
      获取CANopenNode源码
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#canopennode_2" class="md-nav__link">
    <span class="md-ellipsis">
      CANopenNode 功能特性
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#canopennode-basic-api-list" class="md-nav__link">
    <span class="md-ellipsis">
      CANopenNode Basic API List
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mm32g5330canopennode" class="md-nav__link">
    <span class="md-ellipsis">
      基于MM32G5330移植CANopenNode
    </span>
  </a>
  
    <nav class="md-nav" aria-label="基于MM32G5330移植CANopenNode">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#canopennode_3" class="md-nav__link">
    <span class="md-ellipsis">
      CANopenNode软件包的源文件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#canopennode_4" class="md-nav__link">
    <span class="md-ellipsis">
      CANopenNode的移植方法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flexcancanopennode" class="md-nav__link">
    <span class="md-ellipsis">
      基于FlexCAN外设移植CANopenNode
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      调试与开发
    </span>
  </a>
  
    <nav class="md-nav" aria-label="调试与开发">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      环境搭建
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      上电调试
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      总结
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      参考文献
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    ENET入门
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            ENET入门
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LwIP%E7%A7%BB%E6%A4%8D%E7%AC%94%E8%AE%B0/LwIP%E7%A7%BB%E6%A4%8D%E7%AC%94%E8%AE%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LwIP移植笔记
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../blog/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    博客
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_8" id="__nav_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            博客
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2" >
        
          
          <label class="md-nav__link" for="__nav_8_2" id="__nav_8_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    归档
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2">
            <span class="md-nav__icon md-icon"></span>
            归档
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../blog/archive/2025/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2025
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../blog/archive/2023/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2023
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_3" >
        
          
          <label class="md-nav__link" for="__nav_8_3" id="__nav_8_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    分类
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_3">
            <span class="md-nav__icon md-icon"></span>
            分类
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../blog/category/holidays/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Holidays
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../blog/category/test/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    test
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_9" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../.." class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    About
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_9" id="__nav_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            About
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../About/MkDocs%E5%85%A5%E9%97%A8/MkDocs%E5%85%A5%E9%97%A8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MkDocs入门
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../About/MaterialForMkDocs%E5%85%A5%E9%97%A8/MaterialForMkDocs%E5%85%A5%E9%97%A8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MaterialForMkDocs入门
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../About/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E5%8D%9A%E5%AE%A2%E6%8F%92%E4%BB%B6/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E5%8D%9A%E5%AE%A2%E6%8F%92%E4%BB%B6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    如何使用博客插件
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/iamzhangbinbin/iamzhangbinbin.github.io/edit/master/docs/基于MM32G5330移植CANopenNode协议栈/基于MM32G5330移植CANopenNode协议栈.md" title="编辑此页" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/iamzhangbinbin/iamzhangbinbin.github.io/raw/master/docs/基于MM32G5330移植CANopenNode协议栈/基于MM32G5330移植CANopenNode协议栈.md" title="查看本页的源代码" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


<h1 id="canopennode-mm32g5330">CANopenNode移植----基于MM32G5330<a class="headerlink" href="#canopennode-mm32g5330" title="Permanent link">&para;</a></h1>
<hr />
<h2 id="_1">引言<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>基本的CAN总线外设驱动程序能够提供基本的操作硬件电路系统的服务，但在具体的应用系统中，更多是基于协议栈开发上层应用，而不是针对某个具体的芯片平台编写定制的应用程序。目前CANopen是工业自动化领域最常用的协议栈标准之一。对应地，有一些实现CANopen协议的开源软件包，例如CANopenNode、CAN Festival等。</p>
<p><img alt="CANopen-intro-basics-guide-dummies-tutorial" src="../image/CANopen-intro-basics-guide-dummies-tutorial.svg" /></p>
<hr />
<h2 id="canopen">CANopen概述<a class="headerlink" href="#canopen" title="Permanent link">&para;</a></h2>
<h3 id="canopen_1">CANopen 的诞生和作用<a class="headerlink" href="#canopen_1" title="Permanent link">&para;</a></h3>
<p>CANopen 协议是在20世纪90年代末，由总部位于德国纽伦堡的<a href="http://www.can-cia.org">CiA(CAN-in-Automation)</a> 组织在CAL(CAN Application Layer)的基础上发展而来。由于CANopen协议的创始人团队也是CAN-bus的创始人团队，此协议充分发挥了CAN-bus所具备的所有优势，特别是 CiA 组织的主席蔡豪格(Holger Zeltwanger)先生对于CANopen协议坚持开放、免费、非盈利的原则。一经推出便在欧洲得到了广泛的认可与应用。虽然CiA组织背后没有强大的财阀支撑，但时至今日已经成为全世界最为流行的CAN应用层协议。</p>
<p>CANopen主要提供了两个服务：第一个是提供了一个基于CAN的通信协议，可以将多个设备连接到一个总线；第二个是提供了一个用于设备管理的标准，可以将多个设备组织成一个系统，以实现远程监控和控制。目前，CANopen作为工业自动化领域最常用的标准之一，被广泛应用于汽车、航空航天、楼宇自动化等行业。 </p>
<p>如图x所示，CNAopen是一个基于CAN总线的上层协议，其中CAN涵盖了OSI模型的前两层：物理层和数据链路层，CANopen涵盖了后五层：网络层（寻址、路由）、传输层（端到端可靠性）、会话层（同步）、表现层（以标准方式编码的数据、数据表现）和应用层。应用层规定了CANopen设备是如何配置、传输和同步。</p>
<p><img alt="OSI_Mode_For_CANopen" src="../image/OSI_Mode_For_CANopen.png" /></p>
<center> 图x </center>

<p>CANopen从应用端到CAN总线的结构如下图x所示：  </p>
<ul>
<li>应用层(Application)<ul>
<li>用于实现各种应用对象</li>
</ul>
</li>
<li>对象字典(Object dictionary)<ul>
<li>用于描述CANopen节点设备的参数</li>
</ul>
</li>
<li>通信接口(Communication interface)<ul>
<li>定义了CANopen协议通信规则以及CAN控制器驱动之间对应关系</li>
</ul>
</li>
</ul>
<p><img alt="CANopen-Network-Model-Object-Dictionary-Communication-Application" src="../image/CANopen-Network-Model-Object-Dictionary-Communication-Application.svg" /></p>
<center> 图 x </center>

<p>在CANopen网络中，通常需要多个设备进行通信，在CANopen网络中用到了如下三种通信模型：</p>
<p><img alt="3ModeOfCANopen" src="../image/3ModeforCANopen.png" /></p>
<center> 图 x </center>

<ul>
<li>主机/从机模型(Master/Salve)<ul>
<li>一个节点(例如控制接口)充当应用程序主机控制器，从机(例如伺服电机)发送/请求数据，一般在诊断或状态管理中使用。</li>
<li>通信样例：NMT主机与NMT从机的通信<ul>
<li>所有节点通信地位平等，运行时允许自行发送报文，但CANopen网络为了稳定可靠可控，都需要设置一个网络管理主机 NMT-Master。</li>
<li>NMT主机一般是CANopen网络中具备监控的PLC或者PC(当然也可以是一般的功能节点)，所以也成为CANopen主站。相对应的其他CANopen节点就是NMT从机(NMT-slaves)。</li>
</ul>
</li>
</ul>
</li>
<li>客户端/服务端模型(Client/Server)<ul>
<li>客户机向服务器发送数据请求，服务器进行响应。例如，当应用程序主机需要来自从机OD的数据时使用。</li>
<li>通信样例：SDO客户端与SDO服务端的通信<ul>
<li>发送节点需要指定接收节点的地址(Node-ID)回应CAN报文来确认已经接收，如果超时没有确认，则发送节点将会重新发送原报文。</li>
</ul>
</li>
</ul>
</li>
<li>生产者/消费者模型(Producer/Consumer)<ul>
<li>生产者节点向网络广播数据，而网络由使用者节点使用。生产者可以根据请求发送此数据，也可以不发送特定请求。</li>
<li>通信样例：心跳生产者与心跳消费者的通信<ul>
<li>单向发送传输，无需接收节点回应CAN报文来确认。</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr />
<h3 id="canopencob-id">CANopen的COB-ID<a class="headerlink" href="#canopencob-id" title="Permanent link">&para;</a></h3>
<ul>
<li>11位CAN ID在CANopen中被称为COB-ID，这11位COB-ID被分为两部分：前4位是功能码，后7位是(节点ID)，且7位的节点ID限制了CANopen网络上的设备数量为127个节点。</li>
</ul>
<p><img alt="CANopen-COB-ID-Message-Format-CAN-Frame_2" src="../image/CANopen-COB-ID-Message-Format-CAN-Frame_2.png" /></p>
<center> 图 x </center>

<h3 id="canopen7">CANopen的7种报文类型<a class="headerlink" href="#canopen7" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>NMT(Network Management)</p>
<ul>
<li>控制CANopen设备状态，用于网络管理。</li>
</ul>
</li>
<li>
<p>SYNC(Synchronization)</p>
<ul>
<li>SYNC 消息用于同步多个 CANopen 设备的输入感应和驱动——通常由应用程序 Master 触发。</li>
</ul>
</li>
<li>
<p>EMCY(Emergency)</p>
<ul>
<li>在设备发生错误(例如传感器故障)时使用的，发送设备内部错误代码。</li>
</ul>
</li>
<li>
<p>TIME</p>
<ul>
<li>用于分配网络时间，议采用广播方式，无需节点应答，CAN-ID 为 100h，数据长度为 6，数据为当前时刻与1984年1月1日0时的时间差。节点将此时间存储在对象字典1012h的索引中。</li>
</ul>
</li>
<li>
<p>PDO(Process Object)</p>
<ul>
<li>PDO服务用于在设备之间传输实时数据，例如测量数据(如位置数据)或命令数据(如扭矩请求)。</li>
</ul>
</li>
<li>
<p>SDO(Sever D Object)</p>
<ul>
<li>用于访问/更改CANopen设备的对象字典中的值——例如，当应用程序主机需要更改CANopen设备的某些配置时。</li>
</ul>
</li>
<li>Heartbeat<ul>
<li>Heartbeat服务有两个用途: 提供“活动”消息和确认NMT命令。</li>
</ul>
</li>
</ul>
<h3 id="odobject-dictionary">OD(Object Dictionary，对象字典)<a class="headerlink" href="#odobject-dictionary" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>什么是对象字典？</p>
<ul>
<li>对象字典是一个标准的数据结构，描述了CANopen节点的不同的对象参数特性。</li>
<li>每个CANopen节点都包含一个对象字典，使用ESD文件来记录节点参数。</li>
<li>Master节点可通过SDO(且只能通过SDO)来访问和配置Slave节点的对象字典。</li>
</ul>
</li>
<li>
<p>对象字典中每个对象的构成</p>
<ul>
<li>Index (索引)：16位对象的基地址，其范围在0x0000到0xFFFF之间。</li>
<li>Sub Index (子索引)：为了避免数据大量时无索引可分配，所以在某些索引下也定义了一个8位的索引值，其范围是0x00到0xFF 之间。</li>
<li>Object name (对象名称): 如：制造商设备名称。</li>
<li>Object type(目标类型):  变量、数组或记录。</li>
<li>Data type (数据类型): 例如 字符串类型, UNSIGNED32类型UNSIGNED16类型。</li>
<li>Access (访问权限)：rw (read/write), ro (read-only), wo (write-only)。</li>
<li>Default Value(默认值): </li>
<li>Category (类型)：指定此参数是否为强制/可选(M/O)。</li>
</ul>
<p><img alt="" src="../image/CANopen-data-structural.png" />
<center> 图 x </center></p>
</li>
<li>
<p>EDS(The Electronic Data Sheet)</p>
<ul>
<li>在实际使用中，配置或管理复杂的 CANopen 网络将使用软件工具来完成，CiA 306标准定义了一个人类可读的且对机器友好的出厂文件格式即EDS格式文件，作为设备OD的“模板”。EDS文件通常由设备供应商提供，包含所有设备对象(但不包含参数值)的信息。简而言之，EDS是由CANopen设备厂商提供的不带参数的设备OD模板。</li>
</ul>
</li>
<li>
<p>对象字典编辑器</p>
<ul>
<li>对象字典编辑器是用于CANopen对象字典、设备信息等的GUI编辑器，可将 EDS 格式文件导入，通过编辑器编辑赋值后导出成 CANopen对象字典的C源代码文件。导出的在两个源代码文件CO_OD.c和CO_OD.h文件就是我们最终在软件开发时需要的对象字典源文件。</li>
</ul>
</li>
</ul>
<hr />
<h3 id="canopen_2">CANopen主站和从站<a class="headerlink" href="#canopen_2" title="Permanent link">&para;</a></h3>
<p>具有网络管理（Network Management：简称NMT）主机功能的设备通常被称为CANopen主站设备，通常也具有服务数据（Service Date Object：简称SDO）客户端功能。反之具有网络管理（NMT）从机功能的设备通常被称为CANopen从站设备，且其必须具备有服务数据服务器功能。这样CANopen主站设备就可以控制从站以及读写CANopen从站设备的对象字典。</p>
<ul>
<li>CANopen从站特性<ul>
<li>CANopen从站在CANopen网络中拥有唯一的节点地址，并且能独立完成特定的功能，例如数据采集、电机控制等等。对实时性要求高的数据，通常通过实时数据过程（Process Data Object：简称PDO）进行传输，因此CANopen从站应当支持一定数量的PDO传输功能。根据CANopen协议DS301 V4.02的定义，每个从站都预定义了4个TPDO（Transmit Process Data Object：简称TPDO）和4个RPDO（Receive Process Data Object），另外从站也应具有节点/寿命保护或心跳报文以及生产紧急报文等功能。每个CANopen从站都应有一个对象字典，描述了从站所具有的应用参数和通信参数。</li>
</ul>
</li>
<li>CANopen主站特性<ul>
<li>CANopen主站在网络所起的作用有别于CANopen从站，通常CANopen主站在网络中负责网络管理、从站参数配置以及从站数据的处理，其并不一定具有特定的功能，但也有自己的对象字典和唯一的节点地址，一般是CANopen网络中具备监控的PLC或者PC(当然也可以是一般的功能节点)。</li>
</ul>
</li>
</ul>
<hr />
<h3 id="canopen_3">CANopen网络组建<a class="headerlink" href="#canopen_3" title="Permanent link">&para;</a></h3>
<p>由于CANopen是基于CAN总线的一种应用层协议，因此其网络组建与CAN总线一致，典型的总线型结构，从站和主站都挂接在该总线上即可，在一个CANopen网络中只能有一个主站设备和若干个从站设备同时工作。CANopen网络布线时选用带屏蔽双绞线，提高总线抗干扰能力。表 x 所示为CAN通信比特率与总线长度的关系。</p>
<p>表 x</p>
<table>
<thead>
<tr>
<th><strong>Bit rate</strong></th>
<th>Bus length</th>
</tr>
</thead>
<tbody>
<tr>
<td>1 Mbit/s</td>
<td>25 m</td>
</tr>
<tr>
<td>800 kbit/s</td>
<td>50 m</td>
</tr>
<tr>
<td>500 kbit/s</td>
<td>100 m</td>
</tr>
<tr>
<td>250 kbit/s</td>
<td>250 m</td>
</tr>
<tr>
<td>125 kbit/s</td>
<td>500 m</td>
</tr>
<tr>
<td>50 kbit/s</td>
<td>1.000 m</td>
</tr>
<tr>
<td>20 kbit/s</td>
<td>2.500 m</td>
</tr>
<tr>
<td>10 kbit/s</td>
<td>5.000 m</td>
</tr>
</tbody>
</table>
<p>注意：</p>
<ul>
<li>总线长度的估计是基于CANopen CiA 301 规范建议的采样点位置。</li>
<li>总线长度的估计是基于5 ns/m的传播延迟。此外，还需要考虑所用的CAN控制器、CAN收发器和光耦合器的延迟时间。</li>
</ul>
<p>如图x所示为CANopen网络的基本结构，在该网络中有一个CANopen主站，负责管理网络中的所有从站，每个设备都有一个独立的节点地址（NodeID）。从站与从站之间也能建立通信，通常需要事先对各个从站进行配置，使各个从站之间能够建立起独立的PDO通信。</p>
<p><img alt="image-20230224143027633" src="../image/CANopen_BasicNetwork.png" /></p>
<center> 图x </center>

<p>图x所示为带有网关设备的CANopen网络，与基本的CANopen网络相比，该网络中增加了一个CANopen网关设备，该网关设备可以是CANopen转DeviceNet、Profibus、Modbus或其它的设备。在CANopen网络中，我们也可把该网关设备作为一个从站设备或者是CANopen主站设备。</p>
<p><img alt="image-20230224144100523" src="../image/CANopen_ComplexesNetwork.png" /></p>
<center> 图x </center>

<hr />
<h3 id="nmt">NMT网络管理<a class="headerlink" href="#nmt" title="Permanent link">&para;</a></h3>
<p>为实现CANopen网络稳定可靠高效运行，需要对CANopen网络进行网络管理，NMT主机通过下发命令，来控制NMT从机进行有序工作，故每个CANopen协议栈中都具有NMT网络管理的功能。</p>
<ul>
<li>CANopen节点设备运行时存在六种状态：<ul>
<li>初始化<ul>
<li>节点上电后对功能部件包括CAN控制器进行初始化。</li>
</ul>
</li>
<li>应用层复位<ul>
<li>节点中的应用程序复位（开始），比如开关量输出、模拟量输出的初始值。</li>
</ul>
</li>
<li>会话层复位<ul>
<li>节点中的CANopen通讯复位（开始），从这个时刻起，此节点就可以进行CANopen通讯了。</li>
</ul>
</li>
<li>预操作状态<ul>
<li>节点的CANopen通讯处于操作就绪状态，此时此节点不能进行PDO通信，而可以进行SDO进行参数配置和NMT网络管理的操作。</li>
</ul>
</li>
<li>操作状态<ul>
<li>节点收到NMT主机发来的启动命令后，CANopen通讯被激活，PDO通信启动后，按照对象字典里面规定的规则进行传输，同样SDO也可以对节点进行数据传输和参数修改。</li>
</ul>
</li>
<li>停止状态<ul>
<li>节点收到NMT主机发来的停止命令后，节点的PDO通信被停止，但SDO和NMT网络管理依然可以对节点进行操作。</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>如下图x所示，上述六种状态中除了初始化状态外，都可以通过NMT主机发送NMT命令让CANopen网络中任意一个节点进行其他5种状态的切换。</p>
<p><img alt="CANopen-status" src="../image/CANopen-status.png" /></p>
<center> 图x </center>

<hr />
<h2 id="canopennode">CANopenNode简介<a class="headerlink" href="#canopennode" title="Permanent link">&para;</a></h2>
<p>CANopenNode是一款免费和开源的CANopen协议栈，使用用ANSI C语言以面向对象的方式编写的。它可以在不同的微控制器上运行，作为独立的应用程序或与RTOS一起运行。</p>
<p>变量（通信、设备、自定义）被收集在CANopen对象字典中，并且可以以两种方式修改：C源代码和CANopen网络。</p>
<p>CANopenNode的主页是位于：<a href="https://github.com/CANopenNode/CANopenNode">https://github.com/CANopenNode/CANopenNode</a></p>
<hr />
<h3 id="canopennode-vs-can-festival">CANopenNode vs CAN Festival<a class="headerlink" href="#canopennode-vs-can-festival" title="Permanent link">&para;</a></h3>
<p>表 x</p>
<table>
<thead>
<tr>
<th>Feature</th>
<th>CANopenNode</th>
<th>CANFestival</th>
</tr>
</thead>
<tbody>
<tr>
<td>License</td>
<td>Apache v2.0</td>
<td>LGPLv2</td>
</tr>
<tr>
<td>NMT master / slave</td>
<td>✓ / ✓</td>
<td>✓ / ✓</td>
</tr>
<tr>
<td>SDO client / server</td>
<td>✓ / ✓</td>
<td>✓ / ✓</td>
</tr>
<tr>
<td>PDO</td>
<td>✓ / ✓</td>
<td>✓ / ✓</td>
</tr>
<tr>
<td>紧急报文</td>
<td>✓ / ✓</td>
<td>✓ / ✓</td>
</tr>
<tr>
<td>LLS</td>
<td>✓</td>
<td>✓</td>
</tr>
<tr>
<td>Non-volatile storage support</td>
<td>×</td>
<td>✓</td>
</tr>
</tbody>
</table>
<p>CANFestival和CANopenNode都是用于在嵌入式系统上实现CANopen协议通信的开源软件协议栈。需要注意的是它们使用了不同的开放程度的开源协议。CANFestival使用LGPLv2开源协议。这意味着CANFestival的源代码是免费提供的，任何人都可以使用、修改和分发，只要任何衍生作品使用相同的GPL许可证。如果一个公司在产品中使用CANFestival，他们也必须按照同样的LGPLv2开源协议提供其产品的源代码。CANopenNode使用 Apache v2.0开源协议。这是一个自由度比LGPLv2更为开发的一个开源协议，允许在使用软件方面有更大的灵活性。任何人都可以使用、修改和发布CANopenNode，甚至用于商业目的，而不需要发布其衍生作品的源代码。</p>
<hr />
<h3 id="canopennode_1">获取CANopenNode源码<a class="headerlink" href="#canopennode_1" title="Permanent link">&para;</a></h3>
<p>选择 CANopenNode v1.3，该版本为CANopenNode官方验证发布版本，获取源码链接如下：<a href="https://github.com/CANopenNode/CANopenNode/releases/tag/v1.3">https://github.com/CANopenNode/CANopenNode/releases/tag/v1.3</a></p>
<hr />
<h3 id="canopennode_2">CANopenNode 功能特性<a class="headerlink" href="#canopennode_2" title="Permanent link">&para;</a></h3>
<ul>
<li>支持启动、停止、重启设备的NMT从机和简单的NMT主机。</li>
<li>支持基于生产者消费者模型的心跳机制用于错误控制。</li>
<li>支持用于快速交换过程变量的PDO链接和动态映射。</li>
<li>支持SDO加速、分段和块状传输，用于对所有参数的服务访问以及SDO主机。</li>
<li>支持紧急报文。</li>
<li>支持基于生产者消费者模型的同步机制。</li>
<li>支持时间协议(生产者消费者模式)。</li>
<li>支持非易失性存储（掉电保存）。</li>
<li>支持LSS主机和从机, LSS 快速扫描。</li>
</ul>
<p>如CANopenNode官方README文档给出的那样，CANopenNode分为三个线程进行运行，分别为：</p>
<ul>
<li>主线程<ul>
<li>负责处理大部分协议栈相关函数。</li>
</ul>
</li>
<li>定时中断线程<ul>
<li>1ms执行一次，负责处理和时间相关的任务。</li>
</ul>
</li>
<li>CAN接收线程<ul>
<li>当接收到CAN帧时进入到这里并处理。</li>
</ul>
</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-0-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-0-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a>                            -----------------------
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>                           |     Program start     |
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>                            -----------------------
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>                                       |
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>                            -----------------------
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>                           |     CANopen init      |
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>                            -----------------------
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>                                       |
<a id="__codelineno-0-9" name="__codelineno-0-9"></a>                            -----------------------
<a id="__codelineno-0-10" name="__codelineno-0-10"></a>                           |     Start threads     |
<a id="__codelineno-0-11" name="__codelineno-0-11"></a>                            -----------------------
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>                                 |     |     |
<a id="__codelineno-0-13" name="__codelineno-0-13"></a>             --------------------      |      --------------------
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>            |                          |                          |
<a id="__codelineno-0-15" name="__codelineno-0-15"></a> -----------------------    -----------------------    -----------------------
<a id="__codelineno-0-16" name="__codelineno-0-16"></a>| CAN receive thread    |  | Timer interval thread |  | Mainline thread       |
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>|                       |  |                       |  |                       |
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>| - Fast response.      |  | - Realtime thread with|  | - Processing of time  |
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>| - Detect CAN ID.      |  |   constant interval,  |  |   consuming tasks     |
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>| - Partially process   |  |   typically 1ms.      |  |   in CANopen objects: |
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>|   messages and copy   |  | - Network synchronized|  |    - SDO server,      |
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>|   data to target      |  | - Copy inputs (RPDOs, |  |    - Emergency,       |
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>|   CANopen objects.    |  |   HW) to Object Dict. |  |    - Network state,   |
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>|                       |  | - May call application|  |    - Heartbeat.       |
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>|                       |  |   for some processing.|  | - May cyclically call |
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>|                       |  | - Copy variables from |  |   application code.   |
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>|                       |  |   Object Dictionary to|  |                       |
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>|                       |  |   outputs (TPDOs, HW).|  |                       |
<a id="__codelineno-0-29" name="__codelineno-0-29"></a> -----------------------    -----------------------    -----------------------
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>              -----------------------
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>             | SDO client (optional) |
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>             |                       |
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>             | - Can be called by    |
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>             |   external application|
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>             | - Can read or write   |
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>             |   any variable from   |
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>             |   Object Dictionary   |
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>             |   from any node in the|
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>             |   CANopen network.    |
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>              -----------------------
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>              -----------------------
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>             | LSS client (optional) |
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>             |                       |
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>             | - Can be called by    |
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>             |   external application|
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>             | - Can do LSS requests |
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>             | - Can request node    |
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>             |   enumeration         |
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>              -----------------------
</code></pre></div></td></tr></table></div>
<hr />
<h3 id="canopennode-basic-api-list">CANopenNode  Basic  API  List<a class="headerlink" href="#canopennode-basic-api-list" title="Permanent link">&para;</a></h3>
<p>initialize CANopen</p>
<ul>
<li>CO_ReturnError_t CO_init(void *CANdriverState, uint8_t nodeId, uint16_t bitRate)<ul>
<li>Initialize CANopen stack. Function must be called in the communication reset section.</li>
</ul>
</li>
</ul>
<p>Start CAN</p>
<ul>
<li>void CO_CANsetNormalMode(CO_CANmodule_t *CANmodule)<ul>
<li>Request CAN normal (opearational) mode</li>
</ul>
</li>
</ul>
<p>CANopen process</p>
<ul>
<li>CO_NMT_reset_cmd_t CO_process(CO_t          *co, uint16_t timeDifference_ms, uint16_t *timerNext_ms)<ul>
<li>Process CANopen objects. Function must be called cyclically. It processes all "asynchronous" CANopen objects.</li>
</ul>
</li>
</ul>
<p>Process Sync</p>
<ul>
<li>bool_t CO_process_SYNC( CO_t          *co, uint32_t         timeDifference_us)<ul>
<li>Process CANopen SYNC objects. Function must be called cyclically from real time thread with constant interval (1ms typically). It processes SYNC CANopen objects.</li>
</ul>
</li>
</ul>
<p>Read inputs</p>
<ul>
<li>void CO_process_RPDO(CO_t          *co, bool_t          syncWas)<ul>
<li>Process CANopen RPDO objects. Function must be called cyclically from real time thread with constant. interval (1ms typically). It processes receive PDO CANopen objects.</li>
</ul>
</li>
</ul>
<p>Write outputs</p>
<ul>
<li>void CO_process_TPDO(CO_t          *co, bool_t          syncWas, uint32_t         timeDifference_us)<ul>
<li>Process CANopen TPDO objects. Function must be called cyclically from real time thread with constant. interval (1ms typically). It processes transmit PDO CANopen objects.</li>
</ul>
</li>
</ul>
<p>CAN interrupt function</p>
<ul>
<li>void CO_CANinterrupt(CO_CANmodule_t *CANmodule)<ul>
<li>Receives and transmits CAN messages. Function must be called directly from high priority CAN interrupt.</li>
</ul>
</li>
</ul>
<hr />
<h2 id="mm32g5330canopennode">基于MM32G5330移植CANopenNode<a class="headerlink" href="#mm32g5330canopennode" title="Permanent link">&para;</a></h2>
<h3 id="canopennode_3">CANopenNode软件包的源文件<a class="headerlink" href="#canopennode_3" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span>
<span class="normal"><a href="#__codelineno-1-15">15</a></span>
<span class="normal"><a href="#__codelineno-1-16">16</a></span>
<span class="normal"><a href="#__codelineno-1-17">17</a></span>
<span class="normal"><a href="#__codelineno-1-18">18</a></span>
<span class="normal"><a href="#__codelineno-1-19">19</a></span>
<span class="normal"><a href="#__codelineno-1-20">20</a></span>
<span class="normal"><a href="#__codelineno-1-21">21</a></span>
<span class="normal"><a href="#__codelineno-1-22">22</a></span>
<span class="normal"><a href="#__codelineno-1-23">23</a></span>
<span class="normal"><a href="#__codelineno-1-24">24</a></span>
<span class="normal"><a href="#__codelineno-1-25">25</a></span>
<span class="normal"><a href="#__codelineno-1-26">26</a></span>
<span class="normal"><a href="#__codelineno-1-27">27</a></span>
<span class="normal"><a href="#__codelineno-1-28">28</a></span>
<span class="normal"><a href="#__codelineno-1-29">29</a></span>
<span class="normal"><a href="#__codelineno-1-30">30</a></span>
<span class="normal"><a href="#__codelineno-1-31">31</a></span>
<span class="normal"><a href="#__codelineno-1-32">32</a></span>
<span class="normal"><a href="#__codelineno-1-33">33</a></span>
<span class="normal"><a href="#__codelineno-1-34">34</a></span>
<span class="normal"><a href="#__codelineno-1-35">35</a></span>
<span class="normal"><a href="#__codelineno-1-36">36</a></span>
<span class="normal"><a href="#__codelineno-1-37">37</a></span>
<span class="normal"><a href="#__codelineno-1-38">38</a></span>
<span class="normal"><a href="#__codelineno-1-39">39</a></span>
<span class="normal"><a href="#__codelineno-1-40">40</a></span>
<span class="normal"><a href="#__codelineno-1-41">41</a></span>
<span class="normal"><a href="#__codelineno-1-42">42</a></span>
<span class="normal"><a href="#__codelineno-1-43">43</a></span>
<span class="normal"><a href="#__codelineno-1-44">44</a></span>
<span class="normal"><a href="#__codelineno-1-45">45</a></span>
<span class="normal"><a href="#__codelineno-1-46">46</a></span>
<span class="normal"><a href="#__codelineno-1-47">47</a></span>
<span class="normal"><a href="#__codelineno-1-48">48</a></span>
<span class="normal"><a href="#__codelineno-1-49">49</a></span>
<span class="normal"><a href="#__codelineno-1-50">50</a></span>
<span class="normal"><a href="#__codelineno-1-51">51</a></span>
<span class="normal"><a href="#__codelineno-1-52">52</a></span>
<span class="normal"><a href="#__codelineno-1-53">53</a></span>
<span class="normal"><a href="#__codelineno-1-54">54</a></span>
<span class="normal"><a href="#__codelineno-1-55">55</a></span>
<span class="normal"><a href="#__codelineno-1-56">56</a></span>
<span class="normal"><a href="#__codelineno-1-57">57</a></span>
<span class="normal"><a href="#__codelineno-1-58">58</a></span>
<span class="normal"><a href="#__codelineno-1-59">59</a></span>
<span class="normal"><a href="#__codelineno-1-60">60</a></span>
<span class="normal"><a href="#__codelineno-1-61">61</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a>CANopenNode-1.3:
<a id="__codelineno-1-2" name="__codelineno-1-2"></a>│  .clang-format
<a id="__codelineno-1-3" name="__codelineno-1-3"></a>│  .gitignore
<a id="__codelineno-1-4" name="__codelineno-1-4"></a>│  CANopen.c
<a id="__codelineno-1-5" name="__codelineno-1-5"></a>│  CANopen.h
<a id="__codelineno-1-6" name="__codelineno-1-6"></a>│  codingStyle
<a id="__codelineno-1-7" name="__codelineno-1-7"></a>│  CO_driver.h
<a id="__codelineno-1-8" name="__codelineno-1-8"></a>│  CO_types.h
<a id="__codelineno-1-9" name="__codelineno-1-9"></a>│  Doxyfile
<a id="__codelineno-1-10" name="__codelineno-1-10"></a>│  LICENSE
<a id="__codelineno-1-11" name="__codelineno-1-11"></a>│  LICENSE.old
<a id="__codelineno-1-12" name="__codelineno-1-12"></a>│  Makefile
<a id="__codelineno-1-13" name="__codelineno-1-13"></a>│  README.md
<a id="__codelineno-1-14" name="__codelineno-1-14"></a>│
<a id="__codelineno-1-15" name="__codelineno-1-15"></a>├─example
<a id="__codelineno-1-16" name="__codelineno-1-16"></a>│  │  application.c
<a id="__codelineno-1-17" name="__codelineno-1-17"></a>│  │  application.h
<a id="__codelineno-1-18" name="__codelineno-1-18"></a>│  │  CO_OD.c
<a id="__codelineno-1-19" name="__codelineno-1-19"></a>│  │  CO_OD.h
<a id="__codelineno-1-20" name="__codelineno-1-20"></a>│  │  IO.eds
<a id="__codelineno-1-21" name="__codelineno-1-21"></a>│  │  IO.html
<a id="__codelineno-1-22" name="__codelineno-1-22"></a>│  │  main.c
<a id="__codelineno-1-23" name="__codelineno-1-23"></a>│  │  _project.html
<a id="__codelineno-1-24" name="__codelineno-1-24"></a>│  │  _project.xml
<a id="__codelineno-1-25" name="__codelineno-1-25"></a>│  │
<a id="__codelineno-1-26" name="__codelineno-1-26"></a>│  └─CO_OD_with_trace
<a id="__codelineno-1-27" name="__codelineno-1-27"></a>│          CO_OD.c
<a id="__codelineno-1-28" name="__codelineno-1-28"></a>│          CO_OD.h
<a id="__codelineno-1-29" name="__codelineno-1-29"></a>│
<a id="__codelineno-1-30" name="__codelineno-1-30"></a>└─stack
<a id="__codelineno-1-31" name="__codelineno-1-31"></a>    │  CO_Emergency.c
<a id="__codelineno-1-32" name="__codelineno-1-32"></a>    │  CO_Emergency.h
<a id="__codelineno-1-33" name="__codelineno-1-33"></a>    │  CO_HBconsumer.c
<a id="__codelineno-1-34" name="__codelineno-1-34"></a>    │  CO_HBconsumer.h
<a id="__codelineno-1-35" name="__codelineno-1-35"></a>    │  CO_LSS.h
<a id="__codelineno-1-36" name="__codelineno-1-36"></a>    │  CO_LSSmaster.c
<a id="__codelineno-1-37" name="__codelineno-1-37"></a>    │  CO_LSSmaster.h
<a id="__codelineno-1-38" name="__codelineno-1-38"></a>    │  CO_LSSslave.c
<a id="__codelineno-1-39" name="__codelineno-1-39"></a>    │  CO_LSSslave.h
<a id="__codelineno-1-40" name="__codelineno-1-40"></a>    │  CO_NMT_Heartbeat.c
<a id="__codelineno-1-41" name="__codelineno-1-41"></a>    │  CO_NMT_Heartbeat.h
<a id="__codelineno-1-42" name="__codelineno-1-42"></a>    │  CO_PDO.c
<a id="__codelineno-1-43" name="__codelineno-1-43"></a>    │  CO_PDO.h
<a id="__codelineno-1-44" name="__codelineno-1-44"></a>    │  CO_SDO.c
<a id="__codelineno-1-45" name="__codelineno-1-45"></a>    │  CO_SDO.h
<a id="__codelineno-1-46" name="__codelineno-1-46"></a>    │  CO_SDOmaster.c
<a id="__codelineno-1-47" name="__codelineno-1-47"></a>    │  CO_SDOmaster.h
<a id="__codelineno-1-48" name="__codelineno-1-48"></a>    │  CO_SYNC.c
<a id="__codelineno-1-49" name="__codelineno-1-49"></a>    │  CO_SYNC.h
<a id="__codelineno-1-50" name="__codelineno-1-50"></a>    │  CO_TIME.c
<a id="__codelineno-1-51" name="__codelineno-1-51"></a>    │  CO_TIME.h
<a id="__codelineno-1-52" name="__codelineno-1-52"></a>    │  CO_trace.c
<a id="__codelineno-1-53" name="__codelineno-1-53"></a>    │  CO_trace.h
<a id="__codelineno-1-54" name="__codelineno-1-54"></a>    │  crc16-ccitt.c
<a id="__codelineno-1-55" name="__codelineno-1-55"></a>    │  crc16-ccitt.h
<a id="__codelineno-1-56" name="__codelineno-1-56"></a>    │
<a id="__codelineno-1-57" name="__codelineno-1-57"></a>    ├─drvTemplate
<a id="__codelineno-1-58" name="__codelineno-1-58"></a>    │      CO_driver.c
<a id="__codelineno-1-59" name="__codelineno-1-59"></a>    │      CO_driver_target.h
<a id="__codelineno-1-60" name="__codelineno-1-60"></a>    │      eeprom.c
<a id="__codelineno-1-61" name="__codelineno-1-61"></a>    │      eeprom.h
</code></pre></div></td></tr></table></div>
<p>注：上述仅包含移植用到的文件。</p>
<hr />
<h3 id="canopennode_4">CANopenNode的移植方法<a class="headerlink" href="#canopennode_4" title="Permanent link">&para;</a></h3>
<p>CANopenNode移植中涉及到三个文件需要修改：</p>
<ul>
<li>CANopenNode-1.3/example/main.c 文件。</li>
<li>CANopenNode-1.3/stack/drvTemplate/CO_driver.c 文件。</li>
<li>CANopenNode-1.3/stack//drvTemplate/CO_driver_target.h 文件。</li>
</ul>
<p>其中：</p>
<ul>
<li>
<p>在 mian.c 文件中实现 tmrTask_thread() 函数</p>
<ul>
<li>通加载进入1ms 定时中断服务函数进行 1ms 定时的信息同步。</li>
</ul>
</li>
<li>
<p>在 CO_driver.c 文件中实现 CO_CANmodule_init() 函数</p>
<ul>
<li>用于对 MCU 中的 CAN 模块进行初始，并配置CAN报文的收发参数以及开启 flexcan 中断。</li>
</ul>
</li>
<li>
<p>在 CO_driver.C 文件中实现 CO_CANinterrupt() 函数</p>
<ul>
<li>用于实现接收和发送CAN信息。该功能从高优先级的CAN中断中直接调用。</li>
</ul>
</li>
<li>
<p>在 CO_driver.C 文件中实现 CO_CANverifyErrorst() 函数</p>
<ul>
<li>用于对 CAN 总线进行错误检测和上报。</li>
</ul>
</li>
</ul>
<hr />
<h3 id="flexcancanopennode">基于FlexCAN外设移植CANopenNode<a class="headerlink" href="#flexcancanopennode" title="Permanent link">&para;</a></h3>
<p>下面我们将以MM32G5330微控制器上集成的FlexCAN为例，实现对CANopenNode v1.3的移植过程。</p>
<p>首先在灵动官网下载基于Mini-G5330开发板的FlexCAN_Interrupt样例工程，并在MM32G5330的根目录文件夹下创建CANopenNode文件夹。将CANopenNode v1.3软件包中包含的下列文件无需修改，原封不动地复制到新建的 CANopenNode 文件夹中。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span></pre></div></td><td class="code"><div><pre><span></span><code>./CANopen.c&amp;h
./CO_types.h
./stack/CO_Emergency.c&amp;h
./stack/CO_HBconsumer.c&amp;h
./stack/CO_LSS.h
./stack/CO_LSSmaster.c&amp;h
./stack/CO_LSSslave.c&amp;h
./stack/CO_NMT_Heartbeat.c&amp;h
./stack/CO_PDO.c&amp;h
./stack/CO_SDO.c&amp;h
./stack/CO_SDOmaster.c&amp;h
./stack/CO_SYNC.c&amp;h
./stack/CO_TIME.c&amp;h
./stack/CO_trace.c&amp;h
./stack/crc16-ccitt.c&amp;h
</code></pre></div></td></tr></table></div>
<p>如下图x所示：</p>
<p><img alt="image-20231213182716874" src="../image/components-canopen.png" /></p>
<center>图 x </center>

<p>接着将CANopenNode源码中提供的example文件夹的结构如下图x所示，其中CO_OD.c/h是 CANopen中使用到的对象字典， 我们将这两个文件复制到 MM32G5330样例工程的board文件夹下。main.c是 CANopenNode的主程序文件，我们将将原有的main.c文件进行替换。</p>
<p><img alt="image-20230130180116311" src="../image/CANopenNode-example.png" /></p>
<center> 图 x </center>

<p>最后将如图x所示的位于CANopenNode-1.3/stack/drvTemplate文件夹下的CO_driver.c及CO_driver_target.h这两个文件复制到样例工程的文件夹下。</p>
<p><img alt="image-20230131094145961" src="../image/CANopenNode-drvTemp.png" /></p>
<center> 图 x </center>

<p>由于本次移植是基于裸机移植，故按照CANopenNode的设计将Mainline线程放入while(1)中，CAN接收线程放入flexcan的中断服务程序中，定时线程放在一个1ms的定时中断服务程序中。</p>
<p><strong>在 <code>main.c</code> 文件中配置定时器</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-2-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-2-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-2-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-2-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-2-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-2-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-2-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-2-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-2-10">10</a></span>
<span class="normal"><a href="#__codelineno-2-11">11</a></span>
<span class="normal"><a href="#__codelineno-2-12">12</a></span>
<span class="normal"><a href="#__codelineno-2-13">13</a></span>
<span class="normal"><a href="#__codelineno-2-14">14</a></span>
<span class="normal"><a href="#__codelineno-2-15">15</a></span>
<span class="normal"><a href="#__codelineno-2-16">16</a></span>
<span class="normal"><a href="#__codelineno-2-17">17</a></span>
<span class="normal"><a href="#__codelineno-2-18">18</a></span>
<span class="normal"><a href="#__codelineno-2-19">19</a></span>
<span class="normal"><a href="#__codelineno-2-20">20</a></span>
<span class="normal"><a href="#__codelineno-2-21">21</a></span>
<span class="normal"><a href="#__codelineno-2-22">22</a></span>
<span class="normal"><a href="#__codelineno-2-23">23</a></span>
<span class="normal"><a href="#__codelineno-2-24">24</a></span>
<span class="normal"><a href="#__codelineno-2-25">25</a></span>
<span class="normal"><a href="#__codelineno-2-26">26</a></span>
<span class="normal"><a href="#__codelineno-2-27">27</a></span>
<span class="normal"><a href="#__codelineno-2-28">28</a></span>
<span class="normal"><a href="#__codelineno-2-29">29</a></span>
<span class="normal"><a href="#__codelineno-2-30">30</a></span>
<span class="normal"><a href="#__codelineno-2-31">31</a></span>
<span class="normal"><a href="#__codelineno-2-32">32</a></span>
<span class="normal"><a href="#__codelineno-2-33">33</a></span>
<span class="normal"><a href="#__codelineno-2-34">34</a></span>
<span class="normal"><a href="#__codelineno-2-35">35</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="cm">/* Setup the timer. */</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="kt">void</span><span class="w"> </span><span class="nf">app_tim_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="p">{</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w">    </span><span class="n">NVIC_InitTypeDef</span><span class="w">        </span><span class="n">NVIC_InitStruct</span><span class="p">;</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="w">    </span><span class="n">TIM_TimeBaseInitTypeDef</span><span class="w"> </span><span class="n">TIM_TimeBaseInitStruct</span><span class="p">;</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="w">    </span><span class="n">RCC_ClocksTypeDef</span><span class="w"> </span><span class="n">RCC_Clocks</span><span class="p">;</span>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="w">    </span><span class="n">RCC_GetClocksFreq</span><span class="p">(</span><span class="o">&amp;</span><span class="n">RCC_Clocks</span><span class="p">);</span>
<a id="__codelineno-2-10" name="__codelineno-2-10"></a>
<a id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="w">    </span><span class="n">RCC_APB2PeriphClockCmd</span><span class="p">(</span><span class="n">RCC_APB2ENR_TIM1</span><span class="p">,</span><span class="w"> </span><span class="n">ENABLE</span><span class="p">);</span>
<a id="__codelineno-2-12" name="__codelineno-2-12"></a>
<a id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="w">    </span><span class="n">TIM_TimeBaseStructInit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">TIM_TimeBaseInitStruct</span><span class="p">);</span>
<a id="__codelineno-2-14" name="__codelineno-2-14"></a><span class="w">    </span><span class="n">TIM_TimeBaseInitStruct</span><span class="p">.</span><span class="n">TIM_Prescaler</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">RCC_Clocks</span><span class="p">.</span><span class="n">PCLK2_Frequency</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">APP_TIM_UPDATE_STEP</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-2-15" name="__codelineno-2-15"></a><span class="w">    </span><span class="n">TIM_TimeBaseInitStruct</span><span class="p">.</span><span class="n">TIM_CounterMode</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">TIM_COUNTERMODE_UP</span><span class="p">;</span>
<a id="__codelineno-2-16" name="__codelineno-2-16"></a><span class="w">    </span><span class="n">TIM_TimeBaseInitStruct</span><span class="p">.</span><span class="n">TIM_Period</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">APP_TIM_UPDATE_PERIOD</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-2-17" name="__codelineno-2-17"></a><span class="w">    </span><span class="n">TIM_TimeBaseInitStruct</span><span class="p">.</span><span class="n">TIM_ClockDivision</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">TIM_CKD_DIV1</span><span class="p">;</span>
<a id="__codelineno-2-18" name="__codelineno-2-18"></a><span class="w">    </span><span class="n">TIM_TimeBaseInitStruct</span><span class="p">.</span><span class="n">TIM_RepetitionCounter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-2-19" name="__codelineno-2-19"></a><span class="w">    </span><span class="n">TIM_TimeBaseInit</span><span class="p">(</span><span class="n">TIM1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">TIM_TimeBaseInitStruct</span><span class="p">);</span>
<a id="__codelineno-2-20" name="__codelineno-2-20"></a>
<a id="__codelineno-2-21" name="__codelineno-2-21"></a><span class="w">    </span><span class="n">TIM_ClearFlag</span><span class="p">(</span><span class="n">TIM1</span><span class="p">,</span><span class="w"> </span><span class="n">TIM_IT_UPDATE</span><span class="p">);</span>
<a id="__codelineno-2-22" name="__codelineno-2-22"></a><span class="w">    </span><span class="n">TIM_ITConfig</span><span class="p">(</span><span class="n">TIM1</span><span class="p">,</span><span class="w"> </span><span class="n">TIM_IT_UPDATE</span><span class="p">,</span><span class="w"> </span><span class="n">ENABLE</span><span class="p">);</span>
<a id="__codelineno-2-23" name="__codelineno-2-23"></a>
<a id="__codelineno-2-24" name="__codelineno-2-24"></a><span class="w">    </span><span class="n">NVIC_InitStruct</span><span class="p">.</span><span class="n">NVIC_IRQChannel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TIM1_UP_IRQn</span><span class="p">;</span>
<a id="__codelineno-2-25" name="__codelineno-2-25"></a><span class="w">    </span><span class="n">NVIC_InitStruct</span><span class="p">.</span><span class="n">NVIC_IRQChannelPreemptionPriority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-2-26" name="__codelineno-2-26"></a><span class="w">    </span><span class="n">NVIC_InitStruct</span><span class="p">.</span><span class="n">NVIC_IRQChannelSubPriority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-2-27" name="__codelineno-2-27"></a><span class="w">    </span><span class="n">NVIC_InitStruct</span><span class="p">.</span><span class="n">NVIC_IRQChannelCmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ENABLE</span><span class="p">;</span>
<a id="__codelineno-2-28" name="__codelineno-2-28"></a><span class="w">    </span><span class="n">NVIC_Init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">NVIC_InitStruct</span><span class="p">);</span>
<a id="__codelineno-2-29" name="__codelineno-2-29"></a><span class="p">}</span>
<a id="__codelineno-2-30" name="__codelineno-2-30"></a>
<a id="__codelineno-2-31" name="__codelineno-2-31"></a><span class="kt">void</span><span class="w"> </span><span class="nf">TIM1_UP_IRQHandler</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<a id="__codelineno-2-32" name="__codelineno-2-32"></a><span class="p">{</span>
<a id="__codelineno-2-33" name="__codelineno-2-33"></a><span class="w">    </span><span class="n">TIM_ClearITPendingBit</span><span class="p">(</span><span class="n">TIM1</span><span class="p">,</span><span class="w"> </span><span class="n">TIM_IT_UPDATE</span><span class="p">);</span>
<a id="__codelineno-2-34" name="__codelineno-2-34"></a><span class="w">    </span><span class="n">tmrTask_thread</span><span class="p">();</span>
<a id="__codelineno-2-35" name="__codelineno-2-35"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>在 <code>main.c</code> 文件中实现定时线程任务处理</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-3-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-3-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-3-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-3-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-3-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-3-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-3-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-3-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-3-10">10</a></span>
<span class="normal"><a href="#__codelineno-3-11">11</a></span>
<span class="normal"><a href="#__codelineno-3-12">12</a></span>
<span class="normal"><a href="#__codelineno-3-13">13</a></span>
<span class="normal"><a href="#__codelineno-3-14">14</a></span>
<span class="normal"><a href="#__codelineno-3-15">15</a></span>
<span class="normal"><a href="#__codelineno-3-16">16</a></span>
<span class="normal"><a href="#__codelineno-3-17">17</a></span>
<span class="normal"><a href="#__codelineno-3-18">18</a></span>
<span class="normal"><a href="#__codelineno-3-19">19</a></span>
<span class="normal"><a href="#__codelineno-3-20">20</a></span>
<span class="normal"><a href="#__codelineno-3-21">21</a></span>
<span class="normal"><a href="#__codelineno-3-22">22</a></span>
<span class="normal"><a href="#__codelineno-3-23">23</a></span>
<span class="normal"><a href="#__codelineno-3-24">24</a></span>
<span class="normal"><a href="#__codelineno-3-25">25</a></span>
<span class="normal"><a href="#__codelineno-3-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="cm">/* timer thread executes in constant intervals ********************************/</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="kt">void</span><span class="w"> </span><span class="nf">tmrTask_thread</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="w">    </span><span class="n">INCREMENT_1MS</span><span class="p">(</span><span class="n">CO_timer1ms</span><span class="p">);</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">CO</span><span class="o">-&gt;</span><span class="n">CANmodule</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">CANnormal</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="w">        </span><span class="n">bool_t</span><span class="w"> </span><span class="n">syncWas</span><span class="p">;</span>
<a id="__codelineno-3-8" name="__codelineno-3-8"></a>
<a id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="w">        </span><span class="cm">/* Process Sync */</span>
<a id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="w">        </span><span class="n">syncWas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CO_process_SYNC</span><span class="p">(</span><span class="n">CO</span><span class="p">,</span><span class="w"> </span><span class="n">TMR_TASK_INTERVAL</span><span class="p">);</span>
<a id="__codelineno-3-11" name="__codelineno-3-11"></a>
<a id="__codelineno-3-12" name="__codelineno-3-12"></a><span class="w">        </span><span class="cm">/* Read inputs */</span>
<a id="__codelineno-3-13" name="__codelineno-3-13"></a><span class="w">        </span><span class="n">CO_process_RPDO</span><span class="p">(</span><span class="n">CO</span><span class="p">,</span><span class="w"> </span><span class="n">syncWas</span><span class="p">);</span>
<a id="__codelineno-3-14" name="__codelineno-3-14"></a>
<a id="__codelineno-3-15" name="__codelineno-3-15"></a><span class="w">        </span><span class="cm">/* Further I/O or nonblocking application code may go here. */</span>
<a id="__codelineno-3-16" name="__codelineno-3-16"></a>
<a id="__codelineno-3-17" name="__codelineno-3-17"></a><span class="w">        </span><span class="cm">/* Write outputs */</span>
<a id="__codelineno-3-18" name="__codelineno-3-18"></a><span class="w">        </span><span class="n">CO_process_TPDO</span><span class="p">(</span><span class="n">CO</span><span class="p">,</span><span class="w"> </span><span class="n">syncWas</span><span class="p">,</span><span class="w"> </span><span class="n">TMR_TASK_INTERVAL</span><span class="p">);</span>
<a id="__codelineno-3-19" name="__codelineno-3-19"></a>
<a id="__codelineno-3-20" name="__codelineno-3-20"></a><span class="w">        </span><span class="cm">/* verify timer overflow */</span>
<a id="__codelineno-3-21" name="__codelineno-3-21"></a><span class="w">        </span><span class="k">if</span><span class="p">((</span><span class="n">TIM_GetITStatus</span><span class="p">(</span><span class="n">TIM1</span><span class="p">,</span><span class="w"> </span><span class="n">TIM_IT_UPDATE</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">TIM_IT_UPDATE</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0u</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-22" name="__codelineno-3-22"></a><span class="w">            </span><span class="n">CO_errorReport</span><span class="p">(</span><span class="n">CO</span><span class="o">-&gt;</span><span class="n">em</span><span class="p">,</span><span class="w"> </span><span class="n">CO_EM_ISR_TIMER_OVERFLOW</span><span class="p">,</span><span class="w"> </span><span class="n">CO_EMC_SOFTWARE_INTERNAL</span><span class="p">,</span><span class="w"> </span><span class="mi">0u</span><span class="p">);</span>
<a id="__codelineno-3-23" name="__codelineno-3-23"></a><span class="w">            </span><span class="n">TIM_ClearITPendingBit</span><span class="p">(</span><span class="n">TIM1</span><span class="p">,</span><span class="w"> </span><span class="n">TIM_IT_UPDATE</span><span class="p">);</span>
<a id="__codelineno-3-24" name="__codelineno-3-24"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-3-25" name="__codelineno-3-25"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-3-26" name="__codelineno-3-26"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>在 <code>main.c</code> 文件中实现 FlexCAN 的中断服务函数</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span>
<span class="normal"><a href="#__codelineno-4-2">2</a></span>
<span class="normal"><a href="#__codelineno-4-3">3</a></span>
<span class="normal"><a href="#__codelineno-4-4">4</a></span>
<span class="normal"><a href="#__codelineno-4-5">5</a></span>
<span class="normal"><a href="#__codelineno-4-6">6</a></span>
<span class="normal"><a href="#__codelineno-4-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="cm">/* CAN interrupt function *****************************************************/</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="kt">void</span><span class="w"> </span><span class="nf">FLEXCAN_IRQHandler</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="p">{</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="w">    </span><span class="n">FLEXCAN_TransferHandleIRQ</span><span class="p">(</span><span class="n">FLEXCAN</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">FlexCAN_Handle</span><span class="p">);</span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="w">    </span><span class="n">CO_CANinterrupt</span><span class="p">(</span><span class="n">CO</span><span class="o">-&gt;</span><span class="n">CANmodule</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="w">    </span><span class="n">__DSB</span><span class="p">();</span>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>在 <code>CO_driver.c</code> 文件中实现FlexCAN模块初始化</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">  1</a></span>
<span class="normal"><a href="#__codelineno-5-2">  2</a></span>
<span class="normal"><a href="#__codelineno-5-3">  3</a></span>
<span class="normal"><a href="#__codelineno-5-4">  4</a></span>
<span class="normal"><a href="#__codelineno-5-5">  5</a></span>
<span class="normal"><a href="#__codelineno-5-6">  6</a></span>
<span class="normal"><a href="#__codelineno-5-7">  7</a></span>
<span class="normal"><a href="#__codelineno-5-8">  8</a></span>
<span class="normal"><a href="#__codelineno-5-9">  9</a></span>
<span class="normal"><a href="#__codelineno-5-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-5-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-5-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-5-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-5-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-5-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-5-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-5-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-5-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-5-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-5-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-5-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-5-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-5-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-5-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-5-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-5-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-5-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-5-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-5-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-5-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-5-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-5-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-5-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-5-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-5-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-5-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-5-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-5-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-5-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-5-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-5-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-5-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-5-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-5-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-5-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-5-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-5-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-5-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-5-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-5-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-5-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-5-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-5-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-5-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-5-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-5-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-5-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-5-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-5-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-5-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-5-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-5-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-5-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-5-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-5-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-5-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-5-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-5-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-5-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-5-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-5-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-5-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-5-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-5-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-5-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-5-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-5-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-5-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-5-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-5-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-5-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-5-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-5-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-5-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-5-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-5-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-5-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-5-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-5-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-5-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-5-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-5-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-5-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-5-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-5-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-5-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-5-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-5-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-5-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-5-100">100</a></span>
<span class="normal"><a href="#__codelineno-5-101">101</a></span>
<span class="normal"><a href="#__codelineno-5-102">102</a></span>
<span class="normal"><a href="#__codelineno-5-103">103</a></span>
<span class="normal"><a href="#__codelineno-5-104">104</a></span>
<span class="normal"><a href="#__codelineno-5-105">105</a></span>
<span class="normal"><a href="#__codelineno-5-106">106</a></span>
<span class="normal"><a href="#__codelineno-5-107">107</a></span>
<span class="normal"><a href="#__codelineno-5-108">108</a></span>
<span class="normal"><a href="#__codelineno-5-109">109</a></span>
<span class="normal"><a href="#__codelineno-5-110">110</a></span>
<span class="normal"><a href="#__codelineno-5-111">111</a></span>
<span class="normal"><a href="#__codelineno-5-112">112</a></span>
<span class="normal"><a href="#__codelineno-5-113">113</a></span>
<span class="normal"><a href="#__codelineno-5-114">114</a></span>
<span class="normal"><a href="#__codelineno-5-115">115</a></span>
<span class="normal"><a href="#__codelineno-5-116">116</a></span>
<span class="normal"><a href="#__codelineno-5-117">117</a></span>
<span class="normal"><a href="#__codelineno-5-118">118</a></span>
<span class="normal"><a href="#__codelineno-5-119">119</a></span>
<span class="normal"><a href="#__codelineno-5-120">120</a></span>
<span class="normal"><a href="#__codelineno-5-121">121</a></span>
<span class="normal"><a href="#__codelineno-5-122">122</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">FlexCAN_Configure</span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">can_bitrate</span><span class="p">)</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="p">{</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="w">    </span><span class="n">GPIO_InitTypeDef</span><span class="w"> </span><span class="n">GPIO_InitStruct</span><span class="p">;</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="w">    </span><span class="n">NVIC_InitTypeDef</span><span class="w"> </span><span class="n">NVIC_InitStruct</span><span class="p">;</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="w">    </span><span class="n">RCC_ClocksTypeDef</span><span class="w"> </span><span class="n">RCC_Clocks</span><span class="p">;</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="w">    </span><span class="n">flexcan_config_t</span><span class="w">       </span><span class="n">FlexCAN_ConfigStruct</span><span class="p">;</span>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="w">    </span><span class="n">flexcan_rx_mb_config_t</span><span class="w"> </span><span class="n">FlexCAN_RxMB_ConfigStruct</span><span class="p">;</span>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="w">    </span><span class="n">RCC_GetClocksFreq</span><span class="p">(</span><span class="o">&amp;</span><span class="n">RCC_Clocks</span><span class="p">);</span>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a>
<a id="__codelineno-5-12" name="__codelineno-5-12"></a><span class="w">    </span><span class="n">RCC_APB1PeriphClockCmd</span><span class="p">(</span><span class="n">RCC_APB1PERIPH_FLEXCAN</span><span class="p">,</span><span class="w"> </span><span class="n">ENABLE</span><span class="p">);</span>
<a id="__codelineno-5-13" name="__codelineno-5-13"></a><span class="w">    </span><span class="n">RCC_AHBPeriphClockCmd</span><span class="p">(</span><span class="n">RCC_AHBENR_GPIOA</span><span class="p">,</span><span class="w"> </span><span class="n">ENABLE</span><span class="p">);</span>
<a id="__codelineno-5-14" name="__codelineno-5-14"></a>
<a id="__codelineno-5-15" name="__codelineno-5-15"></a><span class="w">    </span><span class="n">GPIO_PinAFConfig</span><span class="p">(</span><span class="n">GPIOA</span><span class="p">,</span><span class="w"> </span><span class="n">GPIO_PINSOURCE11</span><span class="p">,</span><span class="w"> </span><span class="n">GPIO_AF_9</span><span class="p">);</span>
<a id="__codelineno-5-16" name="__codelineno-5-16"></a><span class="w">    </span><span class="n">GPIO_PinAFConfig</span><span class="p">(</span><span class="n">GPIOA</span><span class="p">,</span><span class="w"> </span><span class="n">GPIO_PINSOURCE12</span><span class="p">,</span><span class="w"> </span><span class="n">GPIO_AF_9</span><span class="p">);</span>
<a id="__codelineno-5-17" name="__codelineno-5-17"></a>
<a id="__codelineno-5-18" name="__codelineno-5-18"></a><span class="w">    </span><span class="n">GPIO_StructInit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">GPIO_InitStruct</span><span class="p">);</span>
<a id="__codelineno-5-19" name="__codelineno-5-19"></a><span class="w">    </span><span class="n">GPIO_InitStruct</span><span class="p">.</span><span class="n">GPIO_Pin</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">GPIO_PIN_11</span><span class="p">;</span>
<a id="__codelineno-5-20" name="__codelineno-5-20"></a><span class="w">    </span><span class="n">GPIO_InitStruct</span><span class="p">.</span><span class="n">GPIO_Speed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GPIO_SPEED_HIGH</span><span class="p">;</span>
<a id="__codelineno-5-21" name="__codelineno-5-21"></a><span class="w">    </span><span class="n">GPIO_InitStruct</span><span class="p">.</span><span class="n">GPIO_Mode</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">GPIO_MODE_FLOATING</span><span class="p">;</span>
<a id="__codelineno-5-22" name="__codelineno-5-22"></a><span class="w">    </span><span class="n">GPIO_Init</span><span class="p">(</span><span class="n">GPIOA</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">GPIO_InitStruct</span><span class="p">);</span>
<a id="__codelineno-5-23" name="__codelineno-5-23"></a>
<a id="__codelineno-5-24" name="__codelineno-5-24"></a><span class="w">    </span><span class="n">GPIO_StructInit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">GPIO_InitStruct</span><span class="p">);</span>
<a id="__codelineno-5-25" name="__codelineno-5-25"></a><span class="w">    </span><span class="n">GPIO_InitStruct</span><span class="p">.</span><span class="n">GPIO_Pin</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">GPIO_PIN_12</span><span class="p">;</span>
<a id="__codelineno-5-26" name="__codelineno-5-26"></a><span class="w">    </span><span class="n">GPIO_InitStruct</span><span class="p">.</span><span class="n">GPIO_Speed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GPIO_SPEED_HIGH</span><span class="p">;</span>
<a id="__codelineno-5-27" name="__codelineno-5-27"></a><span class="w">    </span><span class="n">GPIO_InitStruct</span><span class="p">.</span><span class="n">GPIO_Mode</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">GPIO_MODE_AF_PP</span><span class="p">;</span>
<a id="__codelineno-5-28" name="__codelineno-5-28"></a><span class="w">    </span><span class="n">GPIO_Init</span><span class="p">(</span><span class="n">GPIOA</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">GPIO_InitStruct</span><span class="p">);</span>
<a id="__codelineno-5-29" name="__codelineno-5-29"></a>
<a id="__codelineno-5-30" name="__codelineno-5-30"></a><span class="w">    </span><span class="n">NVIC_InitStruct</span><span class="p">.</span><span class="n">NVIC_IRQChannel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FLEXCAN_IRQn</span><span class="p">;</span>
<a id="__codelineno-5-31" name="__codelineno-5-31"></a><span class="w">    </span><span class="n">NVIC_InitStruct</span><span class="p">.</span><span class="n">NVIC_IRQChannelPreemptionPriority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-5-32" name="__codelineno-5-32"></a><span class="w">    </span><span class="n">NVIC_InitStruct</span><span class="p">.</span><span class="n">NVIC_IRQChannelSubPriority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-5-33" name="__codelineno-5-33"></a><span class="w">    </span><span class="n">NVIC_InitStruct</span><span class="p">.</span><span class="n">NVIC_IRQChannelCmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ENABLE</span><span class="p">;</span>
<a id="__codelineno-5-34" name="__codelineno-5-34"></a><span class="w">    </span><span class="n">NVIC_Init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">NVIC_InitStruct</span><span class="p">);</span>
<a id="__codelineno-5-35" name="__codelineno-5-35"></a>
<a id="__codelineno-5-36" name="__codelineno-5-36"></a><span class="w">    </span><span class="n">FLEXCAN_GetDefaultConfig</span><span class="p">(</span><span class="o">&amp;</span><span class="n">FlexCAN_ConfigStruct</span><span class="p">);</span>
<a id="__codelineno-5-37" name="__codelineno-5-37"></a><span class="w">    </span><span class="n">FlexCAN_ConfigStruct</span><span class="p">.</span><span class="n">baudRate</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="n">can_bitrate</span><span class="o">*</span><span class="mi">1000</span><span class="p">;</span>
<a id="__codelineno-5-38" name="__codelineno-5-38"></a><span class="w">    </span><span class="n">FlexCAN_ConfigStruct</span><span class="p">.</span><span class="n">clkSrc</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="n">Enum_Flexcan_ClkSrc1</span><span class="p">;</span>
<a id="__codelineno-5-39" name="__codelineno-5-39"></a><span class="w">    </span><span class="n">FlexCAN_ConfigStruct</span><span class="p">.</span><span class="n">enableLoopBack</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a id="__codelineno-5-40" name="__codelineno-5-40"></a><span class="w">    </span><span class="n">FlexCAN_ConfigStruct</span><span class="p">.</span><span class="n">disableSelfReception</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-5-41" name="__codelineno-5-41"></a><span class="w">    </span><span class="n">FlexCAN_ConfigStruct</span><span class="p">.</span><span class="n">enableIndividMask</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-5-42" name="__codelineno-5-42"></a>
<a id="__codelineno-5-43" name="__codelineno-5-43"></a><span class="w">    </span><span class="cp">#if 1    </span><span class="cm">/* Baudrate calculate by automatically */</span>
<a id="__codelineno-5-44" name="__codelineno-5-44"></a><span class="w">    </span><span class="n">FLEXCAN_CalculateImprovedTimingValues</span><span class="p">(</span><span class="n">FlexCAN_ConfigStruct</span><span class="p">.</span><span class="n">baudRate</span><span class="p">,</span><span class="w"> </span><span class="n">RCC_Clocks</span><span class="p">.</span><span class="n">PCLK1_Frequency</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">FlexCAN_ConfigStruct</span><span class="p">.</span><span class="n">timingConfig</span><span class="p">);</span>
<a id="__codelineno-5-45" name="__codelineno-5-45"></a><span class="cp">#else  </span><span class="cm">/* You can modify the parameters yourself */</span>
<a id="__codelineno-5-46" name="__codelineno-5-46"></a><span class="w">    </span><span class="n">FlexCAN_ConfigStruct</span><span class="p">.</span><span class="n">timingConfig</span><span class="p">.</span><span class="n">preDivider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">23</span><span class="p">;</span>
<a id="__codelineno-5-47" name="__codelineno-5-47"></a><span class="w">    </span><span class="n">FlexCAN_ConfigStruct</span><span class="p">.</span><span class="n">timingConfig</span><span class="p">.</span><span class="n">propSeg</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span>
<a id="__codelineno-5-48" name="__codelineno-5-48"></a><span class="w">    </span><span class="n">FlexCAN_ConfigStruct</span><span class="p">.</span><span class="n">timingConfig</span><span class="p">.</span><span class="n">phaseSeg1</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<a id="__codelineno-5-49" name="__codelineno-5-49"></a><span class="w">    </span><span class="n">FlexCAN_ConfigStruct</span><span class="p">.</span><span class="n">timingConfig</span><span class="p">.</span><span class="n">phaseSeg2</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w">    </span>
<a id="__codelineno-5-50" name="__codelineno-5-50"></a><span class="w">    </span><span class="n">FlexCAN_ConfigStruct</span><span class="p">.</span><span class="n">timingConfig</span><span class="p">.</span><span class="n">rJumpwidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-5-51" name="__codelineno-5-51"></a><span class="cp">#endif</span>
<a id="__codelineno-5-52" name="__codelineno-5-52"></a>
<a id="__codelineno-5-53" name="__codelineno-5-53"></a><span class="w">    </span><span class="n">FLEXCAN_Init</span><span class="p">(</span><span class="n">FLEXCAN</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">FlexCAN_ConfigStruct</span><span class="p">);</span>
<a id="__codelineno-5-54" name="__codelineno-5-54"></a>
<a id="__codelineno-5-55" name="__codelineno-5-55"></a><span class="w">    </span><span class="cm">/* Set Tx MB_2. */</span>
<a id="__codelineno-5-56" name="__codelineno-5-56"></a><span class="w">    </span><span class="n">FLEXCAN_TxMbConfig</span><span class="p">(</span><span class="n">FLEXCAN</span><span class="p">,</span><span class="w"> </span><span class="n">BOARD_FLEXCAN_TX_MB_CH</span><span class="p">,</span><span class="w"> </span><span class="n">ENABLE</span><span class="p">);</span>
<a id="__codelineno-5-57" name="__codelineno-5-57"></a><span class="w">    </span><span class="n">FLEXCAN_TransferCreateHandle</span><span class="p">(</span><span class="n">FLEXCAN</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">FlexCAN_Handle</span><span class="p">,</span><span class="w"> </span><span class="n">FlexCAN_Transfer_Callback</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<a id="__codelineno-5-58" name="__codelineno-5-58"></a>
<a id="__codelineno-5-59" name="__codelineno-5-59"></a><span class="w">    </span><span class="cm">/* Set Rx MB_0. */</span>
<a id="__codelineno-5-60" name="__codelineno-5-60"></a><span class="w">    </span><span class="n">FlexCAN_RxMB_ConfigStruct</span><span class="p">.</span><span class="n">id</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">FLEXCAN_ID_STD</span><span class="p">(</span><span class="mh">0x222</span><span class="p">);</span>
<a id="__codelineno-5-61" name="__codelineno-5-61"></a><span class="w">    </span><span class="n">FlexCAN_RxMB_ConfigStruct</span><span class="p">.</span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Enum_Flexcan_FrameFormatStandard</span><span class="p">;</span>
<a id="__codelineno-5-62" name="__codelineno-5-62"></a><span class="w">    </span><span class="n">FlexCAN_RxMB_ConfigStruct</span><span class="p">.</span><span class="n">type</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">Enum_Flexcan_FrameTypeData</span><span class="p">;</span>
<a id="__codelineno-5-63" name="__codelineno-5-63"></a><span class="w">    </span><span class="n">FLEXCAN_RxMbConfig</span><span class="p">(</span><span class="n">FLEXCAN</span><span class="p">,</span><span class="w"> </span><span class="n">BOARD_FLEXCAN_RX_MB_CH</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">FlexCAN_RxMB_ConfigStruct</span><span class="p">,</span><span class="w"> </span><span class="n">ENABLE</span><span class="p">);</span>
<a id="__codelineno-5-64" name="__codelineno-5-64"></a>
<a id="__codelineno-5-65" name="__codelineno-5-65"></a><span class="w">    </span><span class="cm">/* Set Rx Individual Mask. */</span>
<a id="__codelineno-5-66" name="__codelineno-5-66"></a><span class="w">    </span><span class="n">FLEXCAN_SetRxIndividualMask</span><span class="p">(</span><span class="n">FLEXCAN</span><span class="p">,</span><span class="w"> </span><span class="n">BOARD_FLEXCAN_RX_MB_CH</span><span class="p">,</span><span class="w"> </span><span class="n">FLEXCAN_RX_MB_STD_MASK</span><span class="p">(</span><span class="mh">0x000</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">));</span>
<a id="__codelineno-5-67" name="__codelineno-5-67"></a>
<a id="__codelineno-5-68" name="__codelineno-5-68"></a><span class="w">    </span><span class="n">FlexCAN_MB0_FrameStruct</span><span class="p">.</span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8_t</span><span class="p">)(</span><span class="mi">8</span><span class="p">);</span>
<a id="__codelineno-5-69" name="__codelineno-5-69"></a><span class="w">    </span><span class="n">FlexCAN_MB0_FrameStruct</span><span class="p">.</span><span class="n">type</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8_t</span><span class="p">)</span><span class="n">Enum_Flexcan_FrameTypeData</span><span class="p">;</span>
<a id="__codelineno-5-70" name="__codelineno-5-70"></a><span class="w">    </span><span class="n">FlexCAN_MB0_FrameStruct</span><span class="p">.</span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8_t</span><span class="p">)</span><span class="n">Enum_Flexcan_FrameFormatStandard</span><span class="p">;</span>
<a id="__codelineno-5-71" name="__codelineno-5-71"></a><span class="w">    </span><span class="n">FlexCAN_MB0_FrameStruct</span><span class="p">.</span><span class="n">id</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">FLEXCAN_ID_STD</span><span class="p">(</span><span class="mh">0x222</span><span class="p">);</span>
<a id="__codelineno-5-72" name="__codelineno-5-72"></a>
<a id="__codelineno-5-73" name="__codelineno-5-73"></a><span class="w">    </span><span class="n">FlexCAN_MB0_TransferStruct</span><span class="p">.</span><span class="n">mbIdx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BOARD_FLEXCAN_RX_MB_CH</span><span class="p">;</span>
<a id="__codelineno-5-74" name="__codelineno-5-74"></a><span class="w">    </span><span class="n">FlexCAN_MB0_TransferStruct</span><span class="p">.</span><span class="n">frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">FlexCAN_MB0_FrameStruct</span><span class="p">;</span>
<a id="__codelineno-5-75" name="__codelineno-5-75"></a><span class="w">    </span><span class="n">FLEXCAN_TransferReceiveNonBlocking</span><span class="p">(</span><span class="n">FLEXCAN</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">FlexCAN_Handle</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">FlexCAN_MB0_TransferStruct</span><span class="p">);</span>
<a id="__codelineno-5-76" name="__codelineno-5-76"></a><span class="p">}</span>
<a id="__codelineno-5-77" name="__codelineno-5-77"></a>
<a id="__codelineno-5-78" name="__codelineno-5-78"></a><span class="cm">/******************************************************************************/</span>
<a id="__codelineno-5-79" name="__codelineno-5-79"></a><span class="n">CO_ReturnError_t</span><span class="w"> </span><span class="nf">CO_CANmodule_init</span><span class="p">(</span>
<a id="__codelineno-5-80" name="__codelineno-5-80"></a><span class="w">        </span><span class="n">CO_CANmodule_t</span><span class="w">         </span><span class="o">*</span><span class="n">CANmodule</span><span class="p">,</span>
<a id="__codelineno-5-81" name="__codelineno-5-81"></a><span class="w">        </span><span class="kt">void</span><span class="w">                   </span><span class="o">*</span><span class="n">CANdriverState</span><span class="p">,</span>
<a id="__codelineno-5-82" name="__codelineno-5-82"></a><span class="w">        </span><span class="n">CO_CANrx_t</span><span class="w">              </span><span class="n">rxArray</span><span class="p">[],</span>
<a id="__codelineno-5-83" name="__codelineno-5-83"></a><span class="w">        </span><span class="kt">uint16_t</span><span class="w">                </span><span class="n">rxSize</span><span class="p">,</span>
<a id="__codelineno-5-84" name="__codelineno-5-84"></a><span class="w">        </span><span class="n">CO_CANtx_t</span><span class="w">              </span><span class="n">txArray</span><span class="p">[],</span>
<a id="__codelineno-5-85" name="__codelineno-5-85"></a><span class="w">        </span><span class="kt">uint16_t</span><span class="w">                </span><span class="n">txSize</span><span class="p">,</span>
<a id="__codelineno-5-86" name="__codelineno-5-86"></a><span class="w">        </span><span class="kt">uint16_t</span><span class="w">                </span><span class="n">CANbitRate</span><span class="p">)</span>
<a id="__codelineno-5-87" name="__codelineno-5-87"></a><span class="p">{</span>
<a id="__codelineno-5-88" name="__codelineno-5-88"></a><span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<a id="__codelineno-5-89" name="__codelineno-5-89"></a>
<a id="__codelineno-5-90" name="__codelineno-5-90"></a><span class="w">    </span><span class="cm">/* verify arguments */</span>
<a id="__codelineno-5-91" name="__codelineno-5-91"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">CANmodule</span><span class="o">==</span><span class="nb">NULL</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">rxArray</span><span class="o">==</span><span class="nb">NULL</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">txArray</span><span class="o">==</span><span class="nb">NULL</span><span class="p">){</span>
<a id="__codelineno-5-92" name="__codelineno-5-92"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">CO_ERROR_ILLEGAL_ARGUMENT</span><span class="p">;</span>
<a id="__codelineno-5-93" name="__codelineno-5-93"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-5-94" name="__codelineno-5-94"></a>
<a id="__codelineno-5-95" name="__codelineno-5-95"></a><span class="w">    </span><span class="cm">/* Configure object variables */</span>
<a id="__codelineno-5-96" name="__codelineno-5-96"></a><span class="w">    </span><span class="n">CANmodule</span><span class="o">-&gt;</span><span class="n">CANdriverState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CANdriverState</span><span class="p">;</span>
<a id="__codelineno-5-97" name="__codelineno-5-97"></a><span class="w">    </span><span class="n">CANmodule</span><span class="o">-&gt;</span><span class="n">rxArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rxArray</span><span class="p">;</span>
<a id="__codelineno-5-98" name="__codelineno-5-98"></a><span class="w">    </span><span class="n">CANmodule</span><span class="o">-&gt;</span><span class="n">rxSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rxSize</span><span class="p">;</span>
<a id="__codelineno-5-99" name="__codelineno-5-99"></a><span class="w">    </span><span class="n">CANmodule</span><span class="o">-&gt;</span><span class="n">txArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">txArray</span><span class="p">;</span>
<a id="__codelineno-5-100" name="__codelineno-5-100"></a><span class="w">    </span><span class="n">CANmodule</span><span class="o">-&gt;</span><span class="n">txSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">txSize</span><span class="p">;</span>
<a id="__codelineno-5-101" name="__codelineno-5-101"></a><span class="w">    </span><span class="n">CANmodule</span><span class="o">-&gt;</span><span class="n">CANnormal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a id="__codelineno-5-102" name="__codelineno-5-102"></a><span class="w">    </span><span class="n">CANmodule</span><span class="o">-&gt;</span><span class="n">useCANrxFilters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="cm">/* microcontroller dependent */</span>
<a id="__codelineno-5-103" name="__codelineno-5-103"></a><span class="w">    </span><span class="n">CANmodule</span><span class="o">-&gt;</span><span class="n">bufferInhibitFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a id="__codelineno-5-104" name="__codelineno-5-104"></a><span class="w">    </span><span class="n">CANmodule</span><span class="o">-&gt;</span><span class="n">firstCANtxMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-5-105" name="__codelineno-5-105"></a><span class="w">    </span><span class="n">CANmodule</span><span class="o">-&gt;</span><span class="n">CANtxCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0U</span><span class="p">;</span>
<a id="__codelineno-5-106" name="__codelineno-5-106"></a><span class="w">    </span><span class="n">CANmodule</span><span class="o">-&gt;</span><span class="n">errOld</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0U</span><span class="p">;</span>
<a id="__codelineno-5-107" name="__codelineno-5-107"></a><span class="w">    </span><span class="n">CANmodule</span><span class="o">-&gt;</span><span class="n">em</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="__codelineno-5-108" name="__codelineno-5-108"></a>
<a id="__codelineno-5-109" name="__codelineno-5-109"></a><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0U</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">rxSize</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<a id="__codelineno-5-110" name="__codelineno-5-110"></a><span class="w">        </span><span class="n">rxArray</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">ident</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0U</span><span class="p">;</span>
<a id="__codelineno-5-111" name="__codelineno-5-111"></a><span class="w">        </span><span class="n">rxArray</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xFFFFU</span><span class="p">;</span>
<a id="__codelineno-5-112" name="__codelineno-5-112"></a><span class="w">        </span><span class="n">rxArray</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">object</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="__codelineno-5-113" name="__codelineno-5-113"></a><span class="w">        </span><span class="n">rxArray</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pFunct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="__codelineno-5-114" name="__codelineno-5-114"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-5-115" name="__codelineno-5-115"></a><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0U</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">txSize</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<a id="__codelineno-5-116" name="__codelineno-5-116"></a><span class="w">        </span><span class="n">txArray</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">bufferFull</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a id="__codelineno-5-117" name="__codelineno-5-117"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-5-118" name="__codelineno-5-118"></a>
<a id="__codelineno-5-119" name="__codelineno-5-119"></a><span class="w">    </span><span class="n">FlexCAN_Configure</span><span class="p">(</span><span class="n">CANbitRate</span><span class="p">);</span>
<a id="__codelineno-5-120" name="__codelineno-5-120"></a>
<a id="__codelineno-5-121" name="__codelineno-5-121"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">CO_ERROR_NO</span><span class="p">;</span>
<a id="__codelineno-5-122" name="__codelineno-5-122"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>在 <code>CO_driver.c</code> 文件中实现FlexCAN的报文收发</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span>
<span class="normal"><a href="#__codelineno-6-11">11</a></span>
<span class="normal"><a href="#__codelineno-6-12">12</a></span>
<span class="normal"><a href="#__codelineno-6-13">13</a></span>
<span class="normal"><a href="#__codelineno-6-14">14</a></span>
<span class="normal"><a href="#__codelineno-6-15">15</a></span>
<span class="normal"><a href="#__codelineno-6-16">16</a></span>
<span class="normal"><a href="#__codelineno-6-17">17</a></span>
<span class="normal"><a href="#__codelineno-6-18">18</a></span>
<span class="normal"><a href="#__codelineno-6-19">19</a></span>
<span class="normal"><a href="#__codelineno-6-20">20</a></span>
<span class="normal"><a href="#__codelineno-6-21">21</a></span>
<span class="normal"><a href="#__codelineno-6-22">22</a></span>
<span class="normal"><a href="#__codelineno-6-23">23</a></span>
<span class="normal"><a href="#__codelineno-6-24">24</a></span>
<span class="normal"><a href="#__codelineno-6-25">25</a></span>
<span class="normal"><a href="#__codelineno-6-26">26</a></span>
<span class="normal"><a href="#__codelineno-6-27">27</a></span>
<span class="normal"><a href="#__codelineno-6-28">28</a></span>
<span class="normal"><a href="#__codelineno-6-29">29</a></span>
<span class="normal"><a href="#__codelineno-6-30">30</a></span>
<span class="normal"><a href="#__codelineno-6-31">31</a></span>
<span class="normal"><a href="#__codelineno-6-32">32</a></span>
<span class="normal"><a href="#__codelineno-6-33">33</a></span>
<span class="normal"><a href="#__codelineno-6-34">34</a></span>
<span class="normal"><a href="#__codelineno-6-35">35</a></span>
<span class="normal"><a href="#__codelineno-6-36">36</a></span>
<span class="normal"><a href="#__codelineno-6-37">37</a></span>
<span class="normal"><a href="#__codelineno-6-38">38</a></span>
<span class="normal"><a href="#__codelineno-6-39">39</a></span>
<span class="normal"><a href="#__codelineno-6-40">40</a></span>
<span class="normal"><a href="#__codelineno-6-41">41</a></span>
<span class="normal"><a href="#__codelineno-6-42">42</a></span>
<span class="normal"><a href="#__codelineno-6-43">43</a></span>
<span class="normal"><a href="#__codelineno-6-44">44</a></span>
<span class="normal"><a href="#__codelineno-6-45">45</a></span>
<span class="normal"><a href="#__codelineno-6-46">46</a></span>
<span class="normal"><a href="#__codelineno-6-47">47</a></span>
<span class="normal"><a href="#__codelineno-6-48">48</a></span>
<span class="normal"><a href="#__codelineno-6-49">49</a></span>
<span class="normal"><a href="#__codelineno-6-50">50</a></span>
<span class="normal"><a href="#__codelineno-6-51">51</a></span>
<span class="normal"><a href="#__codelineno-6-52">52</a></span>
<span class="normal"><a href="#__codelineno-6-53">53</a></span>
<span class="normal"><a href="#__codelineno-6-54">54</a></span>
<span class="normal"><a href="#__codelineno-6-55">55</a></span>
<span class="normal"><a href="#__codelineno-6-56">56</a></span>
<span class="normal"><a href="#__codelineno-6-57">57</a></span>
<span class="normal"><a href="#__codelineno-6-58">58</a></span>
<span class="normal"><a href="#__codelineno-6-59">59</a></span>
<span class="normal"><a href="#__codelineno-6-60">60</a></span>
<span class="normal"><a href="#__codelineno-6-61">61</a></span>
<span class="normal"><a href="#__codelineno-6-62">62</a></span>
<span class="normal"><a href="#__codelineno-6-63">63</a></span>
<span class="normal"><a href="#__codelineno-6-64">64</a></span>
<span class="normal"><a href="#__codelineno-6-65">65</a></span>
<span class="normal"><a href="#__codelineno-6-66">66</a></span>
<span class="normal"><a href="#__codelineno-6-67">67</a></span>
<span class="normal"><a href="#__codelineno-6-68">68</a></span>
<span class="normal"><a href="#__codelineno-6-69">69</a></span>
<span class="normal"><a href="#__codelineno-6-70">70</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="cm">/* Send a message frame. */</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="kt">bool</span><span class="w"> </span><span class="nf">flexcan_tx</span><span class="p">(</span><span class="n">CO_CANtx_t</span><span class="w"> </span><span class="o">*</span><span class="n">buffer</span><span class="p">)</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="p">{</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="w">    </span><span class="n">flexcan_frame_t</span><span class="w">       </span><span class="n">FlexCAN_FrameStruct</span><span class="p">;</span>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="w">    </span><span class="n">flexcan_mb_transfer_t</span><span class="w"> </span><span class="n">FlexCAN_MB_TransferStruct</span><span class="p">;</span>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a>
<a id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">buffer</span><span class="o">-&gt;</span><span class="n">rtr</span><span class="p">)</span>
<a id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="w">        </span><span class="n">FlexCAN_FrameStruct</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8_t</span><span class="p">)</span><span class="n">Enum_Flexcan_FrameTypeData</span><span class="p">;</span><span class="w"> </span><span class="cm">/* Data frame type. */</span>
<a id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-13" name="__codelineno-6-13"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-6-14" name="__codelineno-6-14"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-6-15" name="__codelineno-6-15"></a><span class="w">        </span><span class="n">FlexCAN_FrameStruct</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8_t</span><span class="p">)</span><span class="n">Enum_Flexcan_FrameTypeRemote</span><span class="p">;</span><span class="w"> </span><span class="cm">/* Remote frame type. */</span>
<a id="__codelineno-6-16" name="__codelineno-6-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-17" name="__codelineno-6-17"></a>
<a id="__codelineno-6-18" name="__codelineno-6-18"></a><span class="w">    </span><span class="n">FlexCAN_FrameStruct</span><span class="p">.</span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8_t</span><span class="p">)</span><span class="n">buffer</span><span class="o">-&gt;</span><span class="n">DLC</span><span class="p">;</span>
<a id="__codelineno-6-19" name="__codelineno-6-19"></a><span class="w">    </span><span class="n">FlexCAN_FrameStruct</span><span class="p">.</span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8_t</span><span class="p">)</span><span class="n">Enum_Flexcan_FrameFormatStandard</span><span class="p">;</span>
<a id="__codelineno-6-20" name="__codelineno-6-20"></a><span class="w">    </span><span class="n">FlexCAN_FrameStruct</span><span class="p">.</span><span class="n">id</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">FLEXCAN_ID_STD</span><span class="p">(</span><span class="n">buffer</span><span class="o">-&gt;</span><span class="n">ident</span><span class="p">);</span><span class="w"> </span><span class="cm">/* Indicated ID number. */</span>
<a id="__codelineno-6-21" name="__codelineno-6-21"></a>
<a id="__codelineno-6-22" name="__codelineno-6-22"></a><span class="w">    </span><span class="n">FlexCAN_FrameStruct</span><span class="p">.</span><span class="n">dataByte0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<a id="__codelineno-6-23" name="__codelineno-6-23"></a><span class="w">    </span><span class="n">FlexCAN_FrameStruct</span><span class="p">.</span><span class="n">dataByte1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-6-24" name="__codelineno-6-24"></a><span class="w">    </span><span class="n">FlexCAN_FrameStruct</span><span class="p">.</span><span class="n">dataByte2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<a id="__codelineno-6-25" name="__codelineno-6-25"></a><span class="w">    </span><span class="n">FlexCAN_FrameStruct</span><span class="p">.</span><span class="n">dataByte3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<a id="__codelineno-6-26" name="__codelineno-6-26"></a><span class="w">    </span><span class="n">FlexCAN_FrameStruct</span><span class="p">.</span><span class="n">dataByte4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<a id="__codelineno-6-27" name="__codelineno-6-27"></a><span class="w">    </span><span class="n">FlexCAN_FrameStruct</span><span class="p">.</span><span class="n">dataByte5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
<a id="__codelineno-6-28" name="__codelineno-6-28"></a><span class="w">    </span><span class="n">FlexCAN_FrameStruct</span><span class="p">.</span><span class="n">dataByte6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
<a id="__codelineno-6-29" name="__codelineno-6-29"></a><span class="w">    </span><span class="n">FlexCAN_FrameStruct</span><span class="p">.</span><span class="n">dataByte7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
<a id="__codelineno-6-30" name="__codelineno-6-30"></a>
<a id="__codelineno-6-31" name="__codelineno-6-31"></a><span class="w">    </span><span class="n">FlexCAN_MB_TransferStruct</span><span class="p">.</span><span class="n">mbIdx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<a id="__codelineno-6-32" name="__codelineno-6-32"></a><span class="w">    </span><span class="n">FlexCAN_MB_TransferStruct</span><span class="p">.</span><span class="n">frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">FlexCAN_FrameStruct</span><span class="p">;</span>
<a id="__codelineno-6-33" name="__codelineno-6-33"></a>
<a id="__codelineno-6-34" name="__codelineno-6-34"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Status_Flexcan_Success</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">FLEXCAN_TransferSendNonBlocking</span><span class="p">(</span><span class="n">FLEXCAN</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">FlexCAN_Handle</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">FlexCAN_MB_TransferStruct</span><span class="p">))</span>
<a id="__codelineno-6-35" name="__codelineno-6-35"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-6-36" name="__codelineno-6-36"></a><span class="w">        </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-6-37" name="__codelineno-6-37"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-38" name="__codelineno-6-38"></a>
<a id="__codelineno-6-39" name="__codelineno-6-39"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">status</span><span class="p">;</span>
<a id="__codelineno-6-40" name="__codelineno-6-40"></a><span class="p">}</span>
<a id="__codelineno-6-41" name="__codelineno-6-41"></a>
<a id="__codelineno-6-42" name="__codelineno-6-42"></a>
<a id="__codelineno-6-43" name="__codelineno-6-43"></a><span class="cm">/******************************************************************************/</span>
<a id="__codelineno-6-44" name="__codelineno-6-44"></a><span class="n">CO_ReturnError_t</span><span class="w"> </span><span class="nf">CO_CANsend</span><span class="p">(</span><span class="n">CO_CANmodule_t</span><span class="w"> </span><span class="o">*</span><span class="n">CANmodule</span><span class="p">,</span><span class="w"> </span><span class="n">CO_CANtx_t</span><span class="w"> </span><span class="o">*</span><span class="n">buffer</span><span class="p">){</span>
<a id="__codelineno-6-45" name="__codelineno-6-45"></a><span class="w">    </span><span class="n">CO_ReturnError_t</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CO_ERROR_NO</span><span class="p">;</span>
<a id="__codelineno-6-46" name="__codelineno-6-46"></a>
<a id="__codelineno-6-47" name="__codelineno-6-47"></a><span class="w">    </span><span class="cm">/* Verify overflow */</span>
<a id="__codelineno-6-48" name="__codelineno-6-48"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">buffer</span><span class="o">-&gt;</span><span class="n">bufferFull</span><span class="p">){</span>
<a id="__codelineno-6-49" name="__codelineno-6-49"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">CANmodule</span><span class="o">-&gt;</span><span class="n">firstCANtxMessage</span><span class="p">){</span>
<a id="__codelineno-6-50" name="__codelineno-6-50"></a><span class="w">            </span><span class="cm">/* don&#39;t set error, if bootup message is still on buffers */</span>
<a id="__codelineno-6-51" name="__codelineno-6-51"></a><span class="w">            </span><span class="n">CO_errorReport</span><span class="p">((</span><span class="n">CO_EM_t</span><span class="o">*</span><span class="p">)</span><span class="n">CANmodule</span><span class="o">-&gt;</span><span class="n">em</span><span class="p">,</span><span class="w"> </span><span class="n">CO_EM_CAN_TX_OVERFLOW</span><span class="p">,</span><span class="w"> </span><span class="n">CO_EMC_CAN_OVERRUN</span><span class="p">,</span><span class="w"> </span><span class="n">buffer</span><span class="o">-&gt;</span><span class="n">ident</span><span class="p">);</span>
<a id="__codelineno-6-52" name="__codelineno-6-52"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-6-53" name="__codelineno-6-53"></a><span class="w">        </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CO_ERROR_TX_OVERFLOW</span><span class="p">;</span>
<a id="__codelineno-6-54" name="__codelineno-6-54"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-55" name="__codelineno-6-55"></a>
<a id="__codelineno-6-56" name="__codelineno-6-56"></a><span class="w">    </span><span class="n">CO_LOCK_CAN_SEND</span><span class="p">();</span>
<a id="__codelineno-6-57" name="__codelineno-6-57"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">tx_mb_status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">flexcan_tx</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
<a id="__codelineno-6-58" name="__codelineno-6-58"></a>
<a id="__codelineno-6-59" name="__codelineno-6-59"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">tx_mb_status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">true</span><span class="p">){</span>
<a id="__codelineno-6-60" name="__codelineno-6-60"></a><span class="w">        </span><span class="n">CANmodule</span><span class="o">-&gt;</span><span class="n">bufferInhibitFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer</span><span class="o">-&gt;</span><span class="n">syncFlag</span><span class="p">;</span>
<a id="__codelineno-6-61" name="__codelineno-6-61"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-62" name="__codelineno-6-62"></a><span class="w">    </span><span class="cm">/* if no buffer is free, message will be sent by interrupt */</span>
<a id="__codelineno-6-63" name="__codelineno-6-63"></a><span class="w">    </span><span class="k">else</span><span class="p">{</span>
<a id="__codelineno-6-64" name="__codelineno-6-64"></a><span class="w">        </span><span class="n">buffer</span><span class="o">-&gt;</span><span class="n">bufferFull</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-6-65" name="__codelineno-6-65"></a><span class="w">        </span><span class="n">CANmodule</span><span class="o">-&gt;</span><span class="n">CANtxCount</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-6-66" name="__codelineno-6-66"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-67" name="__codelineno-6-67"></a><span class="w">    </span><span class="n">CO_UNLOCK_CAN_SEND</span><span class="p">();</span>
<a id="__codelineno-6-68" name="__codelineno-6-68"></a>
<a id="__codelineno-6-69" name="__codelineno-6-69"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">err</span><span class="p">;</span>
<a id="__codelineno-6-70" name="__codelineno-6-70"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span>
<span class="normal"><a href="#__codelineno-7-11">11</a></span>
<span class="normal"><a href="#__codelineno-7-12">12</a></span>
<span class="normal"><a href="#__codelineno-7-13">13</a></span>
<span class="normal"><a href="#__codelineno-7-14">14</a></span>
<span class="normal"><a href="#__codelineno-7-15">15</a></span>
<span class="normal"><a href="#__codelineno-7-16">16</a></span>
<span class="normal"><a href="#__codelineno-7-17">17</a></span>
<span class="normal"><a href="#__codelineno-7-18">18</a></span>
<span class="normal"><a href="#__codelineno-7-19">19</a></span>
<span class="normal"><a href="#__codelineno-7-20">20</a></span>
<span class="normal"><a href="#__codelineno-7-21">21</a></span>
<span class="normal"><a href="#__codelineno-7-22">22</a></span>
<span class="normal"><a href="#__codelineno-7-23">23</a></span>
<span class="normal"><a href="#__codelineno-7-24">24</a></span>
<span class="normal"><a href="#__codelineno-7-25">25</a></span>
<span class="normal"><a href="#__codelineno-7-26">26</a></span>
<span class="normal"><a href="#__codelineno-7-27">27</a></span>
<span class="normal"><a href="#__codelineno-7-28">28</a></span>
<span class="normal"><a href="#__codelineno-7-29">29</a></span>
<span class="normal"><a href="#__codelineno-7-30">30</a></span>
<span class="normal"><a href="#__codelineno-7-31">31</a></span>
<span class="normal"><a href="#__codelineno-7-32">32</a></span>
<span class="normal"><a href="#__codelineno-7-33">33</a></span>
<span class="normal"><a href="#__codelineno-7-34">34</a></span>
<span class="normal"><a href="#__codelineno-7-35">35</a></span>
<span class="normal"><a href="#__codelineno-7-36">36</a></span>
<span class="normal"><a href="#__codelineno-7-37">37</a></span>
<span class="normal"><a href="#__codelineno-7-38">38</a></span>
<span class="normal"><a href="#__codelineno-7-39">39</a></span>
<span class="normal"><a href="#__codelineno-7-40">40</a></span>
<span class="normal"><a href="#__codelineno-7-41">41</a></span>
<span class="normal"><a href="#__codelineno-7-42">42</a></span>
<span class="normal"><a href="#__codelineno-7-43">43</a></span>
<span class="normal"><a href="#__codelineno-7-44">44</a></span>
<span class="normal"><a href="#__codelineno-7-45">45</a></span>
<span class="normal"><a href="#__codelineno-7-46">46</a></span>
<span class="normal"><a href="#__codelineno-7-47">47</a></span>
<span class="normal"><a href="#__codelineno-7-48">48</a></span>
<span class="normal"><a href="#__codelineno-7-49">49</a></span>
<span class="normal"><a href="#__codelineno-7-50">50</a></span>
<span class="normal"><a href="#__codelineno-7-51">51</a></span>
<span class="normal"><a href="#__codelineno-7-52">52</a></span>
<span class="normal"><a href="#__codelineno-7-53">53</a></span>
<span class="normal"><a href="#__codelineno-7-54">54</a></span>
<span class="normal"><a href="#__codelineno-7-55">55</a></span>
<span class="normal"><a href="#__codelineno-7-56">56</a></span>
<span class="normal"><a href="#__codelineno-7-57">57</a></span>
<span class="normal"><a href="#__codelineno-7-58">58</a></span>
<span class="normal"><a href="#__codelineno-7-59">59</a></span>
<span class="normal"><a href="#__codelineno-7-60">60</a></span>
<span class="normal"><a href="#__codelineno-7-61">61</a></span>
<span class="normal"><a href="#__codelineno-7-62">62</a></span>
<span class="normal"><a href="#__codelineno-7-63">63</a></span>
<span class="normal"><a href="#__codelineno-7-64">64</a></span>
<span class="normal"><a href="#__codelineno-7-65">65</a></span>
<span class="normal"><a href="#__codelineno-7-66">66</a></span>
<span class="normal"><a href="#__codelineno-7-67">67</a></span>
<span class="normal"><a href="#__codelineno-7-68">68</a></span>
<span class="normal"><a href="#__codelineno-7-69">69</a></span>
<span class="normal"><a href="#__codelineno-7-70">70</a></span>
<span class="normal"><a href="#__codelineno-7-71">71</a></span>
<span class="normal"><a href="#__codelineno-7-72">72</a></span>
<span class="normal"><a href="#__codelineno-7-73">73</a></span>
<span class="normal"><a href="#__codelineno-7-74">74</a></span>
<span class="normal"><a href="#__codelineno-7-75">75</a></span>
<span class="normal"><a href="#__codelineno-7-76">76</a></span>
<span class="normal"><a href="#__codelineno-7-77">77</a></span>
<span class="normal"><a href="#__codelineno-7-78">78</a></span>
<span class="normal"><a href="#__codelineno-7-79">79</a></span>
<span class="normal"><a href="#__codelineno-7-80">80</a></span>
<span class="normal"><a href="#__codelineno-7-81">81</a></span>
<span class="normal"><a href="#__codelineno-7-82">82</a></span>
<span class="normal"><a href="#__codelineno-7-83">83</a></span>
<span class="normal"><a href="#__codelineno-7-84">84</a></span>
<span class="normal"><a href="#__codelineno-7-85">85</a></span>
<span class="normal"><a href="#__codelineno-7-86">86</a></span>
<span class="normal"><a href="#__codelineno-7-87">87</a></span>
<span class="normal"><a href="#__codelineno-7-88">88</a></span>
<span class="normal"><a href="#__codelineno-7-89">89</a></span>
<span class="normal"><a href="#__codelineno-7-90">90</a></span>
<span class="normal"><a href="#__codelineno-7-91">91</a></span>
<span class="normal"><a href="#__codelineno-7-92">92</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">CO_CANinterrupt</span><span class="p">(</span><span class="n">CO_CANmodule_t</span><span class="w"> </span><span class="o">*</span><span class="n">CANmodule</span><span class="p">){</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FLEXCAN</span><span class="o">-&gt;</span><span class="n">IFLAG1</span><span class="p">;</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">BOARD_FLEXCAN_RX_MB_STATUS</span><span class="p">))</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">FlexCAN_MB0_RxCompleteFlag</span><span class="p">))</span>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="w">        </span><span class="cm">/* receive interrupt */</span>
<a id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="w">        </span><span class="n">CO_CANrxMsg_t</span><span class="w"> </span><span class="o">*</span><span class="n">rcvMsg</span><span class="p">;</span><span class="w">      </span><span class="cm">/* pointer to received message in CAN module */</span>
<a id="__codelineno-7-9" name="__codelineno-7-9"></a><span class="w">        </span><span class="n">CO_CANrxMsg_t</span><span class="w"> </span><span class="n">rcvMsgBuff</span><span class="p">;</span>
<a id="__codelineno-7-10" name="__codelineno-7-10"></a>
<a id="__codelineno-7-11" name="__codelineno-7-11"></a><span class="w">        </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">index</span><span class="p">;</span><span class="w">             </span><span class="cm">/* index of received message */</span>
<a id="__codelineno-7-12" name="__codelineno-7-12"></a><span class="w">        </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">rcvMsgIdent</span><span class="p">;</span><span class="w">       </span><span class="cm">/* identifier of the received message */</span>
<a id="__codelineno-7-13" name="__codelineno-7-13"></a><span class="w">        </span><span class="n">CO_CANrx_t</span><span class="w"> </span><span class="o">*</span><span class="n">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span><span class="w">  </span><span class="cm">/* receive message buffer from CO_CANmodule_t object. */</span>
<a id="__codelineno-7-14" name="__codelineno-7-14"></a><span class="w">        </span><span class="n">bool_t</span><span class="w"> </span><span class="n">msgMatched</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a id="__codelineno-7-15" name="__codelineno-7-15"></a>
<a id="__codelineno-7-16" name="__codelineno-7-16"></a><span class="w">        </span><span class="cm">/* get message from module here */</span>
<a id="__codelineno-7-17" name="__codelineno-7-17"></a><span class="w">        </span><span class="n">rcvMsg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">rcvMsgBuff</span><span class="p">;</span>
<a id="__codelineno-7-18" name="__codelineno-7-18"></a>
<a id="__codelineno-7-19" name="__codelineno-7-19"></a><span class="w">        </span><span class="n">rcvMsg</span><span class="o">-&gt;</span><span class="n">ident</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">FlexCAN_MBTemp_FrameStruct</span><span class="p">.</span><span class="n">id</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">CAN_ID_STD_SHIFT</span><span class="p">)</span><span class="o">&amp;</span><span class="mh">0x7FF</span><span class="p">;</span>
<a id="__codelineno-7-20" name="__codelineno-7-20"></a><span class="w">        </span><span class="n">rcvMsg</span><span class="o">-&gt;</span><span class="n">DLC</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">FlexCAN_MBTemp_FrameStruct</span><span class="p">.</span><span class="n">length</span><span class="p">;</span>
<a id="__codelineno-7-21" name="__codelineno-7-21"></a><span class="w">        </span><span class="n">rcvMsg</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FlexCAN_MBTemp_FrameStruct</span><span class="p">.</span><span class="n">dataByte0</span><span class="p">;</span>
<a id="__codelineno-7-22" name="__codelineno-7-22"></a><span class="w">        </span><span class="n">rcvMsg</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FlexCAN_MBTemp_FrameStruct</span><span class="p">.</span><span class="n">dataByte1</span><span class="p">;</span>
<a id="__codelineno-7-23" name="__codelineno-7-23"></a><span class="w">        </span><span class="n">rcvMsg</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FlexCAN_MBTemp_FrameStruct</span><span class="p">.</span><span class="n">dataByte2</span><span class="p">;</span>
<a id="__codelineno-7-24" name="__codelineno-7-24"></a><span class="w">        </span><span class="n">rcvMsg</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FlexCAN_MBTemp_FrameStruct</span><span class="p">.</span><span class="n">dataByte3</span><span class="p">;</span>
<a id="__codelineno-7-25" name="__codelineno-7-25"></a><span class="w">        </span><span class="n">rcvMsg</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FlexCAN_MBTemp_FrameStruct</span><span class="p">.</span><span class="n">dataByte4</span><span class="p">;</span>
<a id="__codelineno-7-26" name="__codelineno-7-26"></a><span class="w">        </span><span class="n">rcvMsg</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FlexCAN_MBTemp_FrameStruct</span><span class="p">.</span><span class="n">dataByte5</span><span class="p">;</span>
<a id="__codelineno-7-27" name="__codelineno-7-27"></a><span class="w">        </span><span class="n">rcvMsg</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FlexCAN_MBTemp_FrameStruct</span><span class="p">.</span><span class="n">dataByte6</span><span class="p">;</span>
<a id="__codelineno-7-28" name="__codelineno-7-28"></a><span class="w">        </span><span class="n">rcvMsg</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FlexCAN_MBTemp_FrameStruct</span><span class="p">.</span><span class="n">dataByte7</span><span class="p">;</span>
<a id="__codelineno-7-29" name="__codelineno-7-29"></a>
<a id="__codelineno-7-30" name="__codelineno-7-30"></a><span class="w">        </span><span class="n">rcvMsgIdent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rcvMsg</span><span class="o">-&gt;</span><span class="n">ident</span><span class="p">;</span>
<a id="__codelineno-7-31" name="__codelineno-7-31"></a>
<a id="__codelineno-7-32" name="__codelineno-7-32"></a><span class="w">        </span><span class="n">FlexCAN_MB0_RxCompleteFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-7-33" name="__codelineno-7-33"></a>
<a id="__codelineno-7-34" name="__codelineno-7-34"></a><span class="w">        </span><span class="cm">/* CAN module filters are not used, message with any standard 11-bit identifier */</span>
<a id="__codelineno-7-35" name="__codelineno-7-35"></a><span class="w">        </span><span class="cm">/* has been received. Search rxArray form CANmodule for the same CAN-ID. */</span>
<a id="__codelineno-7-36" name="__codelineno-7-36"></a><span class="w">        </span><span class="n">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">CANmodule</span><span class="o">-&gt;</span><span class="n">rxArray</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<a id="__codelineno-7-37" name="__codelineno-7-37"></a><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CANmodule</span><span class="o">-&gt;</span><span class="n">rxSize</span><span class="p">;</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0U</span><span class="p">;</span><span class="w"> </span><span class="n">index</span><span class="o">--</span><span class="p">){</span>
<a id="__codelineno-7-38" name="__codelineno-7-38"></a><span class="w">            </span><span class="k">if</span><span class="p">(((</span><span class="n">rcvMsgIdent</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="n">buffer</span><span class="o">-&gt;</span><span class="n">ident</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">buffer</span><span class="o">-&gt;</span><span class="n">mask</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0U</span><span class="p">){</span>
<a id="__codelineno-7-39" name="__codelineno-7-39"></a><span class="w">                </span><span class="n">msgMatched</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-7-40" name="__codelineno-7-40"></a><span class="w">                </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-7-41" name="__codelineno-7-41"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-7-42" name="__codelineno-7-42"></a><span class="w">            </span><span class="n">buffer</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-7-43" name="__codelineno-7-43"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-7-44" name="__codelineno-7-44"></a>
<a id="__codelineno-7-45" name="__codelineno-7-45"></a><span class="w">        </span><span class="cm">/* Call specific function, which will process the message */</span>
<a id="__codelineno-7-46" name="__codelineno-7-46"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">msgMatched</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">buffer</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">buffer</span><span class="o">-&gt;</span><span class="n">pFunct</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)){</span>
<a id="__codelineno-7-47" name="__codelineno-7-47"></a><span class="w">            </span><span class="n">buffer</span><span class="o">-&gt;</span><span class="n">pFunct</span><span class="p">(</span><span class="n">buffer</span><span class="o">-&gt;</span><span class="n">object</span><span class="p">,</span><span class="w"> </span><span class="n">rcvMsg</span><span class="p">);</span>
<a id="__codelineno-7-48" name="__codelineno-7-48"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-7-49" name="__codelineno-7-49"></a>
<a id="__codelineno-7-50" name="__codelineno-7-50"></a><span class="w">        </span><span class="cm">/* Clear interrupt flag */</span>
<a id="__codelineno-7-51" name="__codelineno-7-51"></a><span class="w">        </span><span class="n">FLEXCAN_ClearMbStatusFlags</span><span class="p">(</span><span class="n">FLEXCAN</span><span class="p">,</span><span class="w"> </span><span class="n">BOARD_FLEXCAN_RX_MB_STATUS</span><span class="p">);</span>
<a id="__codelineno-7-52" name="__codelineno-7-52"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-7-53" name="__codelineno-7-53"></a><span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">BOARD_FLEXCAN_TX_MB_STATUS</span><span class="p">))</span>
<a id="__codelineno-7-54" name="__codelineno-7-54"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-7-55" name="__codelineno-7-55"></a><span class="w">        </span><span class="cm">/* Clear interrupt flag */</span>
<a id="__codelineno-7-56" name="__codelineno-7-56"></a><span class="w">        </span><span class="n">FLEXCAN_ClearMbStatusFlags</span><span class="p">(</span><span class="n">FLEXCAN</span><span class="p">,</span><span class="w"> </span><span class="n">BOARD_FLEXCAN_TX_MB_STATUS</span><span class="p">);</span>
<a id="__codelineno-7-57" name="__codelineno-7-57"></a>
<a id="__codelineno-7-58" name="__codelineno-7-58"></a><span class="w">        </span><span class="cm">/* First CAN message (bootup) was sent successfully */</span>
<a id="__codelineno-7-59" name="__codelineno-7-59"></a><span class="w">        </span><span class="n">CANmodule</span><span class="o">-&gt;</span><span class="n">firstCANtxMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a id="__codelineno-7-60" name="__codelineno-7-60"></a><span class="w">        </span><span class="cm">/* clear flag from previous message */</span>
<a id="__codelineno-7-61" name="__codelineno-7-61"></a><span class="w">        </span><span class="n">CANmodule</span><span class="o">-&gt;</span><span class="n">bufferInhibitFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a id="__codelineno-7-62" name="__codelineno-7-62"></a><span class="w">        </span><span class="cm">/* Are there any new messages waiting to be send */</span>
<a id="__codelineno-7-63" name="__codelineno-7-63"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">CANmodule</span><span class="o">-&gt;</span><span class="n">CANtxCount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0U</span><span class="p">){</span>
<a id="__codelineno-7-64" name="__codelineno-7-64"></a><span class="w">            </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w">             </span><span class="cm">/* index of transmitting message */</span>
<a id="__codelineno-7-65" name="__codelineno-7-65"></a>
<a id="__codelineno-7-66" name="__codelineno-7-66"></a><span class="w">            </span><span class="cm">/* first buffer */</span>
<a id="__codelineno-7-67" name="__codelineno-7-67"></a><span class="w">            </span><span class="n">CO_CANtx_t</span><span class="w"> </span><span class="o">*</span><span class="n">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">CANmodule</span><span class="o">-&gt;</span><span class="n">txArray</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<a id="__codelineno-7-68" name="__codelineno-7-68"></a><span class="w">            </span><span class="cm">/* search through whole array of pointers to transmit message buffers. */</span>
<a id="__codelineno-7-69" name="__codelineno-7-69"></a><span class="w">            </span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CANmodule</span><span class="o">-&gt;</span><span class="n">txSize</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0U</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">--</span><span class="p">){</span>
<a id="__codelineno-7-70" name="__codelineno-7-70"></a><span class="w">                </span><span class="cm">/* if message buffer is full, send it. */</span>
<a id="__codelineno-7-71" name="__codelineno-7-71"></a><span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">buffer</span><span class="o">-&gt;</span><span class="n">bufferFull</span><span class="p">){</span>
<a id="__codelineno-7-72" name="__codelineno-7-72"></a><span class="w">                    </span><span class="n">buffer</span><span class="o">-&gt;</span><span class="n">bufferFull</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a id="__codelineno-7-73" name="__codelineno-7-73"></a><span class="w">                    </span><span class="n">CANmodule</span><span class="o">-&gt;</span><span class="n">CANtxCount</span><span class="o">--</span><span class="p">;</span>
<a id="__codelineno-7-74" name="__codelineno-7-74"></a>
<a id="__codelineno-7-75" name="__codelineno-7-75"></a><span class="w">                    </span><span class="cm">/* Copy message to CAN buffer */</span>
<a id="__codelineno-7-76" name="__codelineno-7-76"></a><span class="w">                    </span><span class="n">CANmodule</span><span class="o">-&gt;</span><span class="n">bufferInhibitFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer</span><span class="o">-&gt;</span><span class="n">syncFlag</span><span class="p">;</span>
<a id="__codelineno-7-77" name="__codelineno-7-77"></a><span class="w">                    </span><span class="n">CO_CANsend</span><span class="p">(</span><span class="n">CANmodule</span><span class="p">,</span><span class="w"> </span><span class="n">buffer</span><span class="p">);</span>
<a id="__codelineno-7-78" name="__codelineno-7-78"></a><span class="w">                    </span><span class="k">break</span><span class="p">;</span><span class="w">                      </span><span class="cm">/* exit for loop */</span>
<a id="__codelineno-7-79" name="__codelineno-7-79"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-7-80" name="__codelineno-7-80"></a><span class="w">                </span><span class="n">buffer</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-7-81" name="__codelineno-7-81"></a><span class="w">            </span><span class="p">}</span><span class="cm">/* end of for loop */</span>
<a id="__codelineno-7-82" name="__codelineno-7-82"></a>
<a id="__codelineno-7-83" name="__codelineno-7-83"></a><span class="w">            </span><span class="cm">/* Clear counter if no more messages */</span>
<a id="__codelineno-7-84" name="__codelineno-7-84"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0U</span><span class="p">){</span>
<a id="__codelineno-7-85" name="__codelineno-7-85"></a><span class="w">                </span><span class="n">CANmodule</span><span class="o">-&gt;</span><span class="n">CANtxCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0U</span><span class="p">;</span>
<a id="__codelineno-7-86" name="__codelineno-7-86"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-7-87" name="__codelineno-7-87"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-7-88" name="__codelineno-7-88"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-7-89" name="__codelineno-7-89"></a><span class="w">    </span><span class="k">else</span><span class="p">{</span>
<a id="__codelineno-7-90" name="__codelineno-7-90"></a><span class="w">        </span><span class="cm">/* some other interrupt reason */</span>
<a id="__codelineno-7-91" name="__codelineno-7-91"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-7-92" name="__codelineno-7-92"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>在 <code>CO_driver.c</code> 文件中实现CAN总线错误检测</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-8-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-8-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-8-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-8-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-8-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-8-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-8-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-8-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-8-10">10</a></span>
<span class="normal"><a href="#__codelineno-8-11">11</a></span>
<span class="normal"><a href="#__codelineno-8-12">12</a></span>
<span class="normal"><a href="#__codelineno-8-13">13</a></span>
<span class="normal"><a href="#__codelineno-8-14">14</a></span>
<span class="normal"><a href="#__codelineno-8-15">15</a></span>
<span class="normal"><a href="#__codelineno-8-16">16</a></span>
<span class="normal"><a href="#__codelineno-8-17">17</a></span>
<span class="normal"><a href="#__codelineno-8-18">18</a></span>
<span class="normal"><a href="#__codelineno-8-19">19</a></span>
<span class="normal"><a href="#__codelineno-8-20">20</a></span>
<span class="normal"><a href="#__codelineno-8-21">21</a></span>
<span class="normal"><a href="#__codelineno-8-22">22</a></span>
<span class="normal"><a href="#__codelineno-8-23">23</a></span>
<span class="normal"><a href="#__codelineno-8-24">24</a></span>
<span class="normal"><a href="#__codelineno-8-25">25</a></span>
<span class="normal"><a href="#__codelineno-8-26">26</a></span>
<span class="normal"><a href="#__codelineno-8-27">27</a></span>
<span class="normal"><a href="#__codelineno-8-28">28</a></span>
<span class="normal"><a href="#__codelineno-8-29">29</a></span>
<span class="normal"><a href="#__codelineno-8-30">30</a></span>
<span class="normal"><a href="#__codelineno-8-31">31</a></span>
<span class="normal"><a href="#__codelineno-8-32">32</a></span>
<span class="normal"><a href="#__codelineno-8-33">33</a></span>
<span class="normal"><a href="#__codelineno-8-34">34</a></span>
<span class="normal"><a href="#__codelineno-8-35">35</a></span>
<span class="normal"><a href="#__codelineno-8-36">36</a></span>
<span class="normal"><a href="#__codelineno-8-37">37</a></span>
<span class="normal"><a href="#__codelineno-8-38">38</a></span>
<span class="normal"><a href="#__codelineno-8-39">39</a></span>
<span class="normal"><a href="#__codelineno-8-40">40</a></span>
<span class="normal"><a href="#__codelineno-8-41">41</a></span>
<span class="normal"><a href="#__codelineno-8-42">42</a></span>
<span class="normal"><a href="#__codelineno-8-43">43</a></span>
<span class="normal"><a href="#__codelineno-8-44">44</a></span>
<span class="normal"><a href="#__codelineno-8-45">45</a></span>
<span class="normal"><a href="#__codelineno-8-46">46</a></span>
<span class="normal"><a href="#__codelineno-8-47">47</a></span>
<span class="normal"><a href="#__codelineno-8-48">48</a></span>
<span class="normal"><a href="#__codelineno-8-49">49</a></span>
<span class="normal"><a href="#__codelineno-8-50">50</a></span>
<span class="normal"><a href="#__codelineno-8-51">51</a></span>
<span class="normal"><a href="#__codelineno-8-52">52</a></span>
<span class="normal"><a href="#__codelineno-8-53">53</a></span>
<span class="normal"><a href="#__codelineno-8-54">54</a></span>
<span class="normal"><a href="#__codelineno-8-55">55</a></span>
<span class="normal"><a href="#__codelineno-8-56">56</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">CO_CANverifyErrors</span><span class="p">(</span><span class="n">CO_CANmodule_t</span><span class="w"> </span><span class="o">*</span><span class="n">CANmodule</span><span class="p">){</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">rxErrors</span><span class="p">,</span><span class="w"> </span><span class="n">txErrors</span><span class="p">,</span><span class="w"> </span><span class="n">overflow</span><span class="p">;</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="w">    </span><span class="n">CO_EM_t</span><span class="o">*</span><span class="w"> </span><span class="n">em</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">CO_EM_t</span><span class="o">*</span><span class="p">)</span><span class="n">CANmodule</span><span class="o">-&gt;</span><span class="n">em</span><span class="p">;</span>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">err</span><span class="p">;</span>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="w">    </span><span class="cm">/* get error counters from module. Id possible, function may use different way to</span>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="cm">     * determine errors. */</span>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="w">    </span><span class="n">rxErrors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">uint16_t</span><span class="p">)</span><span class="w"> </span><span class="p">((</span><span class="n">FLEXCAN</span><span class="o">-&gt;</span><span class="n">ECR</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">CAN_ECR_RXERRCNT_MASK</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">CAN_ECR_RXERRCNT_SHIFT</span><span class="p">);</span>
<a id="__codelineno-8-9" name="__codelineno-8-9"></a><span class="w">    </span><span class="n">txErrors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">uint16_t</span><span class="p">)</span><span class="w"> </span><span class="p">((</span><span class="n">FLEXCAN</span><span class="o">-&gt;</span><span class="n">ECR</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">CAN_ECR_TXERRCNT_MASK</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">CAN_ECR_TXERRCNT_SHIFT</span><span class="p">);</span>
<a id="__codelineno-8-10" name="__codelineno-8-10"></a><span class="w">    </span><span class="n">overflow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">uint16_t</span><span class="p">)</span><span class="w"> </span><span class="p">((</span><span class="n">FLEXCAN</span><span class="o">-&gt;</span><span class="n">ESR1</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">CAN_ESR1_ERROVR_MASK</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">CAN_ESR1_ERROVR_SHIFT</span><span class="p">);</span>
<a id="__codelineno-8-11" name="__codelineno-8-11"></a>
<a id="__codelineno-8-12" name="__codelineno-8-12"></a><span class="w">    </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="kt">uint32_t</span><span class="p">)</span><span class="n">txErrors</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">((</span><span class="kt">uint32_t</span><span class="p">)</span><span class="n">rxErrors</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">overflow</span><span class="p">;</span>
<a id="__codelineno-8-13" name="__codelineno-8-13"></a>
<a id="__codelineno-8-14" name="__codelineno-8-14"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">CANmodule</span><span class="o">-&gt;</span><span class="n">errOld</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">err</span><span class="p">){</span>
<a id="__codelineno-8-15" name="__codelineno-8-15"></a><span class="w">        </span><span class="n">CANmodule</span><span class="o">-&gt;</span><span class="n">errOld</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">err</span><span class="p">;</span>
<a id="__codelineno-8-16" name="__codelineno-8-16"></a>
<a id="__codelineno-8-17" name="__codelineno-8-17"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">txErrors</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">256U</span><span class="p">){</span><span class="w">                               </span><span class="cm">/* bus off */</span>
<a id="__codelineno-8-18" name="__codelineno-8-18"></a><span class="w">            </span><span class="n">CO_errorReport</span><span class="p">(</span><span class="n">em</span><span class="p">,</span><span class="w"> </span><span class="n">CO_EM_CAN_TX_BUS_OFF</span><span class="p">,</span><span class="w"> </span><span class="n">CO_EMC_BUS_OFF_RECOVERED</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">);</span>
<a id="__codelineno-8-19" name="__codelineno-8-19"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-8-20" name="__codelineno-8-20"></a><span class="w">        </span><span class="k">else</span><span class="p">{</span><span class="w">                                               </span><span class="cm">/* not bus off */</span>
<a id="__codelineno-8-21" name="__codelineno-8-21"></a><span class="w">            </span><span class="n">CO_errorReset</span><span class="p">(</span><span class="n">em</span><span class="p">,</span><span class="w"> </span><span class="n">CO_EM_CAN_TX_BUS_OFF</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">);</span>
<a id="__codelineno-8-22" name="__codelineno-8-22"></a>
<a id="__codelineno-8-23" name="__codelineno-8-23"></a><span class="w">            </span><span class="k">if</span><span class="p">((</span><span class="n">rxErrors</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">96U</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">txErrors</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">96U</span><span class="p">)){</span><span class="w">     </span><span class="cm">/* bus warning */</span>
<a id="__codelineno-8-24" name="__codelineno-8-24"></a><span class="w">                </span><span class="n">CO_errorReport</span><span class="p">(</span><span class="n">em</span><span class="p">,</span><span class="w"> </span><span class="n">CO_EM_CAN_BUS_WARNING</span><span class="p">,</span><span class="w"> </span><span class="n">CO_EMC_NO_ERROR</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">);</span>
<a id="__codelineno-8-25" name="__codelineno-8-25"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-8-26" name="__codelineno-8-26"></a>
<a id="__codelineno-8-27" name="__codelineno-8-27"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">rxErrors</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">128U</span><span class="p">){</span><span class="w">                           </span><span class="cm">/* RX bus passive */</span>
<a id="__codelineno-8-28" name="__codelineno-8-28"></a><span class="w">                </span><span class="n">CO_errorReport</span><span class="p">(</span><span class="n">em</span><span class="p">,</span><span class="w"> </span><span class="n">CO_EM_CAN_RX_BUS_PASSIVE</span><span class="p">,</span><span class="w"> </span><span class="n">CO_EMC_CAN_PASSIVE</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">);</span>
<a id="__codelineno-8-29" name="__codelineno-8-29"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-8-30" name="__codelineno-8-30"></a><span class="w">            </span><span class="k">else</span><span class="p">{</span>
<a id="__codelineno-8-31" name="__codelineno-8-31"></a><span class="w">                </span><span class="n">CO_errorReset</span><span class="p">(</span><span class="n">em</span><span class="p">,</span><span class="w"> </span><span class="n">CO_EM_CAN_RX_BUS_PASSIVE</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">);</span>
<a id="__codelineno-8-32" name="__codelineno-8-32"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-8-33" name="__codelineno-8-33"></a>
<a id="__codelineno-8-34" name="__codelineno-8-34"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">txErrors</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">128U</span><span class="p">){</span><span class="w">                           </span><span class="cm">/* TX bus passive */</span>
<a id="__codelineno-8-35" name="__codelineno-8-35"></a><span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">CANmodule</span><span class="o">-&gt;</span><span class="n">firstCANtxMessage</span><span class="p">){</span>
<a id="__codelineno-8-36" name="__codelineno-8-36"></a><span class="w">                    </span><span class="n">CO_errorReport</span><span class="p">(</span><span class="n">em</span><span class="p">,</span><span class="w"> </span><span class="n">CO_EM_CAN_TX_BUS_PASSIVE</span><span class="p">,</span><span class="w"> </span><span class="n">CO_EMC_CAN_PASSIVE</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">);</span>
<a id="__codelineno-8-37" name="__codelineno-8-37"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-8-38" name="__codelineno-8-38"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-8-39" name="__codelineno-8-39"></a><span class="w">            </span><span class="k">else</span><span class="p">{</span>
<a id="__codelineno-8-40" name="__codelineno-8-40"></a><span class="w">                </span><span class="n">bool_t</span><span class="w"> </span><span class="n">isError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CO_isError</span><span class="p">(</span><span class="n">em</span><span class="p">,</span><span class="w"> </span><span class="n">CO_EM_CAN_TX_BUS_PASSIVE</span><span class="p">);</span>
<a id="__codelineno-8-41" name="__codelineno-8-41"></a><span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">isError</span><span class="p">){</span>
<a id="__codelineno-8-42" name="__codelineno-8-42"></a><span class="w">                    </span><span class="n">CO_errorReset</span><span class="p">(</span><span class="n">em</span><span class="p">,</span><span class="w"> </span><span class="n">CO_EM_CAN_TX_BUS_PASSIVE</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">);</span>
<a id="__codelineno-8-43" name="__codelineno-8-43"></a><span class="w">                    </span><span class="n">CO_errorReset</span><span class="p">(</span><span class="n">em</span><span class="p">,</span><span class="w"> </span><span class="n">CO_EM_CAN_TX_OVERFLOW</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">);</span>
<a id="__codelineno-8-44" name="__codelineno-8-44"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-8-45" name="__codelineno-8-45"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-8-46" name="__codelineno-8-46"></a>
<a id="__codelineno-8-47" name="__codelineno-8-47"></a><span class="w">            </span><span class="k">if</span><span class="p">((</span><span class="n">rxErrors</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">96U</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">txErrors</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">96U</span><span class="p">)){</span><span class="w">       </span><span class="cm">/* no error */</span>
<a id="__codelineno-8-48" name="__codelineno-8-48"></a><span class="w">                </span><span class="n">CO_errorReset</span><span class="p">(</span><span class="n">em</span><span class="p">,</span><span class="w"> </span><span class="n">CO_EM_CAN_BUS_WARNING</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">);</span>
<a id="__codelineno-8-49" name="__codelineno-8-49"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-8-50" name="__codelineno-8-50"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-8-51" name="__codelineno-8-51"></a>
<a id="__codelineno-8-52" name="__codelineno-8-52"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">overflow</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0U</span><span class="p">){</span><span class="w">                                 </span><span class="cm">/* CAN RX bus overflow */</span>
<a id="__codelineno-8-53" name="__codelineno-8-53"></a><span class="w">            </span><span class="n">CO_errorReport</span><span class="p">(</span><span class="n">em</span><span class="p">,</span><span class="w"> </span><span class="n">CO_EM_CAN_RXB_OVERFLOW</span><span class="p">,</span><span class="w"> </span><span class="n">CO_EMC_CAN_OVERRUN</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">);</span>
<a id="__codelineno-8-54" name="__codelineno-8-54"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-8-55" name="__codelineno-8-55"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-8-56" name="__codelineno-8-56"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>将上述文件复制到对应的工程样例文件路径下，并将这些文件添加进工程编译文件列表中后，编译下载程序，CANopen节点上线向CAN网络发送CANopen节点上线报文，上位机收到一条如下报文：</p>
<p>表x:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">CAN-ID(hex)</th>
<th style="text-align: left;">Length</th>
<th style="text-align: left;">Data(hex)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">70A</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">00</td>
</tr>
</tbody>
</table>
<p>之后该CANopen节点以 1000ms 的时间间隔向CAN网络发送节点心跳报文，上位机以1000ms的时间间隔收到如下报文：</p>
<p>表x:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">CAN-ID(hex)</th>
<th style="text-align: left;">Length</th>
<th style="text-align: left;">Data(hex)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">70A</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">05</td>
</tr>
</tbody>
</table>
<p>如图x所示。</p>
<p><img alt="image-20230220110237610" src="../image/PCAN-View.png" /></p>
<center>图x </center>

<p>至此，可验证该CANopen节点设备成功启动并开始正常运行。</p>
<p>同时在灵动提供的样例中，也提供了一些移植好的CANopenNode样例工程，供大家验证测试：</p>
<ul>
<li>CANopen_Basic样例<ul>
<li>演示了CANopenNode的基本样例功能。</li>
</ul>
</li>
<li>CANopen_PDO_TPDO&amp;CANopen_PDO_RPDO样例<ul>
<li>演示了CANopen的TPDO与RPDO之间通信的样例。</li>
</ul>
</li>
<li>CANopen_SDO_Server&amp;CANopen_SDO_Client样例<ul>
<li>演示了CANopen的SDO Server与SDO Client之间通信的样例。</li>
</ul>
</li>
</ul>
<hr />
<h2 id="_2">调试与开发<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<h3 id="_3">环境搭建<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p>使用搭载了MM32G5330 MCU的开发板Mini-G5330 ，以CANopen_Basic样例工程为例，将开发板上的CAN收发器与PCAN相连接，并将PCAN与PC机通过USB相连接，在PC端（基于Win10操作系统）使用PCAN-View上位机进行CAN通信，如图x所示。 </p>
<p><img alt="image-20221229200614147" src="../image/image-mcu%26pc.png" /></p>
<center>图x MCU与PC机交互示意图 </center>

<p>这里我们使用了PCAN-USB，并使用了其官方的配套上位机PCAN-View。其PCAN-USB驱动下载链接为：<a href="https://peak-system.com.cn/driver/">https://peak-system.com.cn/driver/</a>；PCAN-View 安装包下载链接为: <a href="https://peak-system.com.cn/wp-content/uploads/2022/06/pcanview.zip">https://peak-system.com.cn/wp-content/uploads/2022/06/pcanview.zip</a>；PCAN-View使用说明见如下链接: <a href="https://peak-system.com.cn/software/apsoftware/pcan-view/">https://peak-system.com.cn/software/apsoftware/pcan-view/</a></p>
<hr />
<h3 id="_4">上电调试<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<p>将上述环境搭建好后，将MCU上电并复位，并通过PC端上位机PCAN-View测试如下指令，观察CANopen节点其对指令的响应，来判断该CANopen节点是否处于正常运行状态。</p>
<ul>
<li>将NODE-ID为0x0A的节点设置为 Stop 模式，上位机PCAN-View发送如下指令：</li>
</ul>
<p>表x</p>
<table>
<thead>
<tr>
<th style="text-align: left;">CAN-ID(hex)</th>
<th style="text-align: left;">Length</th>
<th style="text-align: left;">Data(hex)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">000</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">02 0A</td>
</tr>
</tbody>
</table>
<p>如下图x所示，可接收到如下报文：</p>
<p><img alt="image-20230220172938551" src="../image/Stop-the-Node.png" /></p>
<center> 图 x </center>

<ul>
<li>将NODE-ID为0x0A的节点设置为 Start 模式，上位机PCAN-View发送如下指令：</li>
</ul>
<p>表x</p>
<table>
<thead>
<tr>
<th style="text-align: left;">CAN-ID(hex)</th>
<th style="text-align: left;">Length</th>
<th style="text-align: left;">Data(hex)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">000</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">01 0A</td>
</tr>
</tbody>
</table>
<p>如下图x所示，可接收到如下报文：</p>
<p><img alt="image-20230220181043270" src="../image/Start-the-Node.png" /></p>
<center> 图x </center>

<ul>
<li>将NODE-ID为0x0A的节点设置为Pre-operation模式，上位机PCAN-View发送如下指令：</li>
</ul>
<p>表x</p>
<table>
<thead>
<tr>
<th>CAN-ID(hex)</th>
<th style="text-align: left;">Length</th>
<th style="text-align: left;">Data(hex)</th>
</tr>
</thead>
<tbody>
<tr>
<td>70A</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">80 0A</td>
</tr>
</tbody>
</table>
<p>如下图x所示，该节点进入Pre-operation模式，可接收到如下报文：</p>
<p><img alt="image-20230220173143412" src="../image/Preoperaion-the-Node.png" /></p>
<center> 图 x </center>

<ul>
<li>将NODE-ID为0x0A节点复位，上位机PCAN-View发送如下指令：</li>
</ul>
<p>表x</p>
<table>
<thead>
<tr>
<th style="text-align: left;">CAN-ID(hex)</th>
<th style="text-align: left;">Length</th>
<th style="text-align: left;">Data(hex)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">70A</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">81 0A</td>
</tr>
</tbody>
</table>
<p>如下图x所示，该节点被复位：</p>
<p><img alt="image-20230220173338692" src="../image/Reset--the-Node.png" /></p>
<center> 图 x </center>

<ul>
<li>将NODE-ID为0x0A节点的通信层复位，上位机PCAN-View发送如下指令：</li>
</ul>
<p>表x</p>
<table>
<thead>
<tr>
<th style="text-align: left;">CAN-ID(hex)</th>
<th style="text-align: left;">Length</th>
<th style="text-align: left;">Data(hex)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">70A</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">82 0A</td>
</tr>
</tbody>
</table>
<p>如下图x所示，该节点通信层被复位，重新上线：</p>
<p><img alt="image-20230220181246407" src="../image/Reset-commu-the-Node.png" /></p>
<center> 图 x </center>

<ul>
<li>获取NODE-ID为0x0A节点的心跳发送间隔时间，上位机PCAN-View发送如下指令：</li>
</ul>
<p>表x</p>
<table>
<thead>
<tr>
<th style="text-align: left;">CAN-ID(hex)</th>
<th style="text-align: left;">Length</th>
<th style="text-align: left;">Data(hex)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">60A</td>
<td style="text-align: left;">8</td>
<td style="text-align: left;">40 17 10 00 00 00 00 00</td>
</tr>
</tbody>
</table>
<p>如下图x所示，返回该节点当前心跳发送间隔时间为1000(0x03E8)ms：</p>
<p><img alt="image-20230220174859554" src="../image/Get-heartbeat.png" /></p>
<center> 图 x </center>

<ul>
<li>设置NODE-ID为0x0A节点的心跳发送间隔时间为500(0x01F4)ms，上位机PCAN-View发送如下指令：</li>
</ul>
<p>表x</p>
<table>
<thead>
<tr>
<th style="text-align: left;">CAN-ID(hex)</th>
<th style="text-align: left;">Length</th>
<th style="text-align: left;">Data(hex)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">60A</td>
<td style="text-align: left;">8</td>
<td style="text-align: left;">2B 17 10 00 F4 01 00 00</td>
</tr>
</tbody>
</table>
<p>如下图x所示，该节点当前心跳发送间隔时间变为500ms：</p>
<p><img alt="image-20230220175604643" src="../image/Set-heartbeat.png" /></p>
<center> 图 x </center>

<hr />
<h2 id="_5">总结<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h2>
<p>本章节讲解了CANopen的基本概念，并对CANopenNode开源协议栈进行了介绍，讲解了如何基于MM32G5330 MCU对CANopenNode协议栈进行移植，以及对移植后的CANopen_Basic样例进行基本指令响应功能的验证。</p>
<hr />
<h2 id="_6">参考文献<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h2>
<p>[CiA - CANopen] <a href="https://www.can-cia.org/canopen/">https://www.can-cia.org/canopen/</a></p>
<p>[CANopenNode] <a href="https://github.com/CANopenNode/CANopenNode">https://github.com/CANopenNode/CANopenNode</a></p>
<p>[CANopen_easy_begin] <a href="https://www.zlg.cn/data/upload/software/Can/CANopen_easy_begin.pdf">https://www.zlg.cn/data/upload/software/Can/CANopen_easy_begin.pdf</a></p>
<p>[CANopen Explained - A Simple Intro] <a href="https://www.csselectronics.com/pages/canopen-tutorial-simple-intro">https://www.csselectronics.com/pages/canopen-tutorial-simple-intro</a></p>
<p>[CANopen: The Ultimate Guide (2023) (autopi.io)] <a href="https://www.autopi.io/blog/canopen-simple-introduction-explained/">https://www.autopi.io/blog/canopen-simple-introduction-explained/</a></p>
<hr />









  




                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 ZhangBinbin/All Rights Reserved.
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://iamzhangbinbin.github.io/" target="_blank" rel="noopener" title="Wechat" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M385.2 167.6c6.4 0 12.6.3 18.8 1.1C387.4 90.3 303.3 32 207.7 32 100.5 32 13 104.8 13 197.4c0 53.4 29.3 97.5 77.9 131.6l-19.3 58.6 68-34.1c24.4 4.8 43.8 9.7 68.2 9.7 6.2 0 12.1-.3 18.3-.8-4-12.9-6.2-26.6-6.2-40.8-.1-84.9 72.9-154 165.3-154m-104.5-52.9c14.5 0 24.2 9.7 24.2 24.4 0 14.5-9.7 24.2-24.2 24.2-14.8 0-29.3-9.7-29.3-24.2.1-14.7 14.6-24.4 29.3-24.4m-136.4 48.6c-14.5 0-29.3-9.7-29.3-24.2 0-14.8 14.8-24.4 29.3-24.4 14.8 0 24.4 9.7 24.4 24.4 0 14.6-9.6 24.2-24.4 24.2M563 319.4c0-77.9-77.9-141.3-165.4-141.3-92.7 0-165.4 63.4-165.4 141.3S305 460.7 397.6 460.7c19.3 0 38.9-5.1 58.6-9.9l53.4 29.3-14.8-48.6C534 402.1 563 363.2 563 319.4m-219.1-24.5c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.8 0 24.4 9.7 24.4 19.3 0 10-9.7 19.6-24.4 19.6m107.1 0c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.5 0 24.4 9.7 24.4 19.3.1 10-9.9 19.6-24.4 19.6"/></svg>
    </a>
  
    
    
    
    
    <a href="https://iamzhangbinbin.github.io/" target="_blank" rel="noopener" title="telegram" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M248 8C111.033 8 0 119.033 0 256s111.033 248 248 248 248-111.033 248-248S384.967 8 248 8m114.952 168.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.45 10.45 0 0 1 3.53 6.716 43.8 43.8 0 0 1 .417 9.769"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://iamzhangbinbin.github.io/" target="_blank" rel="noopener" title="iamzhangbinbin.github.io" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8l164.9-188.5L26.8 48h145.6l100.5 132.9zm-24.8 373.8h39.1L151.1 88h-42z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://iamzhangbinbin.github.io/" target="_blank" rel="noopener" title="iamzhangbinbin.github.io" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:<z466302@126.com>" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M64 112c-8.8 0-16 7.2-16 16v22.1l172.5 141.6c20.7 17 50.4 17 71.1 0L464 150.1V128c0-8.8-7.2-16-16-16zM48 212.2V384c0 8.8 7.2 16 16 16h384c8.8 0 16-7.2 16-16V212.2L322 328.8c-38.4 31.5-93.7 31.5-132 0zM0 128c0-35.3 28.7-64 64-64h384c35.3 0 64 28.7 64 64v256c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://iamzhangbinbin.github.io/" target="_blank" rel="noopener" title="iamzhangbinbin.github.io" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M488.6 104.1c16.7 18.1 24.4 39.7 23.3 65.7v202.4c-.4 26.4-9.2 48.1-26.5 65.1-17.2 17-39.1 25.9-65.5 26.7H92.02c-26.45-.8-48.21-9.8-65.28-27.2C9.682 419.4.767 396.5 0 368.2V169.8c.767-26 9.682-47.6 26.74-65.7C43.81 87.75 65.57 78.77 92.02 78h29.38L96.05 52.19c-5.75-5.73-8.63-13-8.63-21.79 0-8.8 2.88-16.06 8.63-21.797C101.8 2.868 109.1 0 117.9 0q13.2 0 21.9 8.603L213.1 78h88l74.5-69.397C381.7 2.868 389.2 0 398 0q13.2 0 21.9 8.603c5.7 5.737 8.6 12.997 8.6 21.797 0 8.79-2.9 16.06-8.6 21.79L394.6 78h29.3c26.4.77 48 9.75 64.7 26.1m-38.8 69.7c-.4-9.6-3.7-17.4-10.7-23.5-5.2-6.1-14-9.4-22.7-9.8H96.05c-9.59.4-17.45 3.7-23.58 9.8-6.14 6.1-9.4 13.9-9.78 23.5v194.4c0 9.2 3.26 17 9.78 23.5s14.38 9.8 23.58 9.8H416.4c9.2 0 17-3.3 23.3-9.8s9.7-14.3 10.1-23.5zm-264.3 42.7c6.3 6.3 9.7 14.1 10.1 23.2V273c-.4 9.2-3.7 16.9-9.8 23.2-6.2 6.3-14 9.5-23.6 9.5s-17.5-3.2-23.6-9.5-9.4-14-9.8-23.2v-33.3c.4-9.1 3.8-16.9 10.1-23.2s13.2-9.6 23.3-10c9.2.4 17 3.7 23.3 10m191.5 0c6.3 6.3 9.7 14.1 10.1 23.2V273c-.4 9.2-3.7 16.9-9.8 23.2s-14 9.5-23.6 9.5-17.4-3.2-23.6-9.5c-7-6.3-9.4-14-9.7-23.2v-33.3c.3-9.1 3.7-16.9 10-23.2s14.1-9.6 23.3-10c9.2.4 17 3.7 23.3 10"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.indexes", "toc.integrate", "announce.dismiss", "navigation.instant", "header.autohide", "navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.top", "search.suggest", "search.highlight", "search.share", "navigation.expand", "content.tabs.link", "content.tooltips", "content.code.copy", "content.action.edit", "content.action.view", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>